(FILECREATED "10-SEP-74 03:49:59" DRIBBLE.;3 9216   

     changes to:  DRIBBLEFNS DRIBBLEPRINT DRIBBLEPRIN2 DRIBBLEREAD 
DRIBBLERATOM DRIBBLERSTRING DRIBBLELIST DRIBBLEBLOCKS DRIBBLEERRORM 
DRIBBLE

     previous date: "17-JUN-74 14:02:12" <LISP>DRIBBLE.;1)


  (LISPXPRINT (QUOTE DRIBBLECOMS)
	      T)
  (RPAQQ
    DRIBBLECOMS
    ((FNS * DRIBBLEFNS)
     DRIBBLELIST
     [VARS
       (DRIBBLEFILE)
       (DRIBCH)
       (DRIBBLERELINKFLG T)
       (ERRMSGTBL
	 (CAR (VAG (IPLUS 4 (LOC (CDR (GETD (QUOTE ERRORM]
     [DECLARE: DONTCOPY DOEVAL@COMPILE (PROP MACRO ISOUTPUTTTY 
					     ISINPUTTTY CHECKDRIBCH)
	       (PROP MACRO * (MAPCAR (CDR DRIBBLELIST)
				     (FUNCTION CADDR]
     (BLOCKS * DRIBBLEBLOCKS)))
  (RPAQQ DRIBBLEFNS
	 (DRIBBLE DRIBBLETERPRI DRIBBLEPRINT DRIBBLESPACES DRIBBLEPRIN1 
		  DRIBBLEPRIN2 DRIBBLEREAD DRIBBLEREADC DRIBBLERATOM 
		  DRIBBLERSTRING DRIBBLEERRORM DRIBBLECLOSEALL))
(DEFINEQ

(DRIBBLE
  [LAMBDA (FILE APPENDFLG THAWEDFLG)
    [DECLARE
      (MAPC (QUOTE (SPACES OUTPUT READ PRIN2 LASTC READC RATOM PRIN1 
			   INPUT RATEST ERRORM TERPRI PRINT RSTRING))
	    (FUNCTION (LAMBDA (X)
		(EVAL (PRINT [LIST (QUOTE PUT)
				   (KWOTE X)
				   (QUOTE (QUOTE COREVAL))
				   (LIST (QUOTE LOC)
					 (LIST (QUOTE CDR)
					       (LIST (QUOTE GETD)
						     (KWOTE X]
			     LCFIL]
    (PROG1
      DRIBBLEFILE
      [COND
	((OR (NULL FILE)
	     (EQ FILE T))
	  (COND
	    (DRIBBLEFILE
	      [COND
		(DRIBBLERELINKFLG
		  [RESETVAR FILEPKGFLG NIL
		    (MAPC DRIBBLELIST (FUNCTION (LAMBDA (X)
			      (AND (SUBRP (CADDR X))
				   (MOVD (CADDR X)
					 (CAR X]
		  (RESETVAR NOLINKMESS T (RELINK (QUOTE WORLD]
	      (CLOSEF DRIBBLEFILE)))
	  (SETQ DRIBBLEFILE NIL))
	(T (AND DRIBBLEFILE (CLOSEF DRIBBLEFILE))
	   [SETQ DRIBBLEFILE (OR (OPENP FILE)
				 (OPENF FILE (LOGOR 7516225536
						    (COND
						      (APPENDFLG 8192)
						      (T 0))
						    (COND
						      (THAWEDFLG 1024)
						      (T 0]
	   (COND
	     (DRIBBLERELINKFLG
	       [RESETVAR FILEPKGFLG NIL
		 (MAPC DRIBBLELIST (FUNCTION (LAMBDA (X)
			   (COND
			     ((SUBRP (CAR X))
			       (MOVD (CAR X)
				     (CADDR X))
			       (MOVD (CADR X)
				     (CAR X]
	       (SETQ DRIBBLERELINKFLG NIL)
	       (RESETVAR NOLINKMESS T (RELINK (QUOTE WORLD]
      (SETQ DRIBCH NIL])

(DRIBBLETERPRI
  [LAMBDA (U)
    (OLDLISPTERPRI U)
    (COND
      ((AND DRIBBLEFILE (ISOUTPUTTTY U))
	(CHECKDRIBCH)
	(OLDLISPTERPRI DRIBBLEFILE)))
    NIL])

(DRIBBLEPRINT
  [LAMBDA (U V W)
    (OLDLISPPRINT U V W)
    (COND
      ((AND DRIBBLEFILE (ISOUTPUTTTY V))
	(CHECKDRIBCH)
	(OLDLISPPRINT U DRIBBLEFILE W)))
    U])

(DRIBBLESPACES
  [LAMBDA (U V)
    (OLDLISPSPACES U V)
    (COND
      ((AND DRIBBLEFILE (ISOUTPUTTTY V))
	(CHECKDRIBCH)
	(OLDLISPSPACES U DRIBBLEFILE)))
    NIL])

(DRIBBLEPRIN1
  [LAMBDA (U V)
    (OLDLISPPRIN1 U V)
    (COND
      ((AND DRIBBLEFILE (ISOUTPUTTTY V))
	(CHECKDRIBCH)
	(OLDLISPPRIN1 U DRIBBLEFILE)))
    U])

(DRIBBLEPRIN2
  [LAMBDA (U V W)
    (OLDLISPPRIN2 U V W)
    (COND
      ((AND DRIBBLEFILE (ISOUTPUTTTY V))
	(CHECKDRIBCH)
	(OLDLISPPRIN2 U DRIBBLEFILE W)))
    U])

(DRIBBLEREAD
  [LAMBDA (U V W)
    (PROG (DRIBY (DRIBX (OLDLISPREAD U V W)))
          [COND
	    ((AND DRIBBLEFILE (ISINPUTTTY U))
	      (COND
		[(LISTP DRIBX)
		  (SETQ DRIBCH NIL)
		  (COND
		    (W (OLDLISPPRIN2 DRIBX DRIBBLEFILE V))
		    (T (OLDLISPPRINT DRIBX DRIBBLEFILE V]
		(T (AND DRIBCH (ASSEMBLE NIL    (* (RATEST T))
				         (CQ T)
				         (FASTCALL RATEST))
			(OLDLISPPRIN1 DRIBCH DRIBBLEFILE))
		   (COND
		     ((AND (NULL DRIBX)
			   (SELECTQ (SETQ DRIBY (ASSEMBLE NIL
                                                (* (LASTC T))
						          (CQ T)
						          (FASTCALL
							    LASTC)))
				    ((%) %])
				      T)
				    NIL))
		       (SETQ DRIBCH NIL)
		       (OLDLISPPRIN1 DRIBY DRIBBLEFILE)
		       (OLDLISPTERPRI DRIBBLEFILE))
		     ((AND DRIBX (ASSEMBLE NIL
                                                (* (RATEST))
				           (CQ NIL)
				           (FASTCALL RATEST)))
		       (OLDLISPPRIN1 DRIBX DRIBBLEFILE)
		       (SETQ DRIBCH NIL))
		     (T (OLDLISPPRIN2 DRIBX DRIBBLEFILE V)
			(SETQ DRIBCH (PEEKC T]
          (RETURN DRIBX])

(DRIBBLEREADC
  [LAMBDA (U)
    (PROG ((CH (OLDLISPREADC U)))
          (COND
	    ((AND DRIBBLEFILE (ISINPUTTTY U))
	      (SETQ DRIBCH NIL)
	      (OLDLISPPRIN1 CH DRIBBLEFILE)))
          (RETURN CH])

(DRIBBLERATOM
  [LAMBDA (U V)
    (PROG ((DRIBX (OLDLISPRATOM U V)))
          [COND
	    ((AND DRIBBLEFILE (ISINPUTTTY U))
	      (AND DRIBCH (ASSEMBLE NIL         (* (RATEST T))
				    (CQ T)
				    (FASTCALL RATEST))
		   (OLDLISPPRIN1 DRIBCH DRIBBLEFILE))
	      (COND
		((ASSEMBLE NIL                  (* (RATEST))
		           (CQ NIL)
		           (FASTCALL RATEST))
		  (SETQ DRIBCH NIL)
		  (OLDLISPPRIN1 DRIBX DRIBBLEFILE))
		(T (OLDLISPPRIN2 DRIBX DRIBBLEFILE V)
		   (SETQ DRIBCH (PEEKC T]
          (RETURN DRIBX])

(DRIBBLERSTRING
  [LAMBDA (U V)
    (PROG ((STR (OLDLISPRSTRING U V)))
          [COND
	    ((AND DRIBBLEFILE (ISINPUTTTY U))
	      (OLDLISPPRIN2 STR DRIBBLEFILE V)
	      (SETQ DRIBCH (PEEKC T]
          (RETURN STR])

(DRIBBLEERRORM
  [LAMBDA (U)
    (OLDLISPERRORM U)
    (COND
      (DRIBBLEFILE (CHECKDRIBCH)
		   (OLDLISPTERPRI DRIBBLEFILE)
		   (ASSEMBLE NIL
			     [CQ (VAG (FIX (OPNJFN DRIBBLEFILE]
			     (PUSHN)
			     (VAR (HRRZ 4 , ERRMSGTBL))
			     [CQ (VAG (FIX (CAR U]
			     (ADD 4 , 1)
			     (MOVE 4 , 0 (4))
			     (HRLI 4 , 440600Q)
			     (POPN)
			 LOOP(ILDB 2 , 4)
			     (ADDI 2 , 40Q)
			     (CAIN 2 , 57Q)
			     (JRST OUT)
			     (JSYS 51Q)         (* BOUT)
			     (JRST LOOP)
			 OUT)
		   (OLDLISPTERPRI DRIBBLEFILE)
		   (OLDLISPPRINT (CADR U)
				 (PROG1 DRIBBLEFILE (SETQ DRIBBLEFILE T)
					)
				 DRIBBLEFILE)))
    (CADR U])

(DRIBBLECLOSEALL
  [LAMBDA NIL
    (PROG [(FILES (DREMOVE DRIBBLEFILE (OPENP]
          (MAPC FILES (FUNCTION CLOSEF))
          (RETURN FILES])
)
  (RPAQQ DRIBBLELIST ((CLOSEALL DRIBBLECLOSEALL OLDLISPCLOSEALL)
	  (TERPRI DRIBBLETERPRI OLDLISPTERPRI)
	  (PRINT DRIBBLEPRINT OLDLISPPRINT)
	  (SPACES DRIBBLESPACES OLDLISPSPACES)
	  (PRIN1 DRIBBLEPRIN1 OLDLISPPRIN1)
	  (PRIN2 DRIBBLEPRIN2 OLDLISPPRIN2)
	  (READ DRIBBLEREAD OLDLISPREAD)
	  (READC DRIBBLEREADC OLDLISPREADC)
	  (RATOM DRIBBLERATOM OLDLISPRATOM)
	  (RSTRING DRIBBLERSTRING OLDLISPRSTRING)
	  (ERRORM DRIBBLEERRORM OLDLISPERRORM)))
  (RPAQ DRIBBLEFILE)
  (RPAQ DRIBCH)
  (RPAQ DRIBBLERELINKFLG T)
  [RPAQ ERRMSGTBL
	(CAR (VAG (IPLUS 4 (LOC (CDR (GETD (QUOTE ERRORM]
[DECLARE: DONTCOPY DOEVAL@COMPILE 
(DEFLIST(QUOTE(
  (ISOUTPUTTTY ((FILE)
		(EQ (OR FILE (ASSEMBLE NIL (* (OUTPUT))
				       (CQ NIL)
				       (FASTCALL OUTPUT)))
		    T)))
  (ISINPUTTTY ((FILE)
	       (EQ (OR FILE (ASSEMBLE NIL (* (INPUT))
				      (CQ NIL)
				      (FASTCALL INPUT)))
		   T)))
  [CHECKDRIBCH (NIL (COND (DRIBCH (COND ((ASSEMBLE NIL (* GET THE LINE 
							  BUFFER FLAG)
						   (CQ NIL)
						   (TLNE 0 , 2)
						   (* TLNE F,LBFLG)
						   (CQ T))
					 (OLDLISPPRIN1 DRIBCH 
						       DRIBBLEFILE))
					(T (OLDLISPTERPRI DRIBBLEFILE)))
				  (SETQ DRIBCH NIL]
))(QUOTE MACRO))

(DEFLIST(QUOTE(
  [OLDLISPTERPRI ((U)
		  (ASSEMBLE NIL (CQ U)
			    (FASTCALL TERPRI]
  [OLDLISPPRINT ((U V W)
		 (ASSEMBLE NIL (CQ U)
			   (E (CEXP2 (QUOTE V)))
			   (VAR (HRRZ 3 , W))
			   (FASTCALL PRINT]
  [OLDLISPSPACES ((U V)
		  (ASSEMBLE NIL (CQ U)
			    (E (CEXP2 (QUOTE V)))
			    (FASTCALL SPACES]
  [OLDLISPPRIN1 ((U V)
		 (ASSEMBLE NIL (CQ U)
			   (E (CEXP2 (QUOTE V)))
			   (FASTCALL PRIN1]
  [OLDLISPPRIN2 ((U V W)
		 (ASSEMBLE NIL (CQ U)
			   (E (CEXP2 (QUOTE V)))
			   (VAR (HRRZ 3 , W))
			   (FASTCALL PRIN2]
  [OLDLISPREAD ((U V W)
		(ASSEMBLE NIL (CQ U)
			  (E (CEXP2 (QUOTE V)))
			  (VAR (HRRZ 3 , W))
			  (FASTCALL READ]
  [OLDLISPREADC ((U)
		 (ASSEMBLE NIL (CQ U)
			   (FASTCALL READC]
  [OLDLISPRATOM ((U V)
		 (ASSEMBLE NIL (CQ U)
			   (E (CEXP2 (QUOTE V)))
			   (FASTCALL RATOM]
  [OLDLISPRSTRING ((U V)
		   (ASSEMBLE NIL (CQ U)
			     (E (CEXP2 (QUOTE V)))
			     (FASTCALL RSTRING]
  [OLDLISPERRORM ((U)
		  (ASSEMBLE NIL (CQ U)
			    (FASTCALL ERRORM]
))(QUOTE MACRO))
]
  [RPAQQ DRIBBLEBLOCKS
	 ((NIL DRIBBLE DRIBBLETERPRI DRIBBLEPRINT DRIBBLESPACES 
	       DRIBBLEPRIN1 DRIBBLEPRIN2 DRIBBLEREAD DRIBBLEREADC 
	       DRIBBLERATOM DRIBBLERSTRING DRIBBLEERRORM 
	       DRIBBLECLOSEALL (LINKFNS . T)
	       (GLOBALVARS DRIBBLEFILE DRIBBLELIST DRIBCH 
			   DRIBBLERELINKFLG ERRMSGTBL]
[DECLARE: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY
  (BLOCK: NIL DRIBBLE DRIBBLETERPRI DRIBBLEPRINT DRIBBLESPACES 
	  DRIBBLEPRIN1 DRIBBLEPRIN2 DRIBBLEREAD DRIBBLEREADC 
	  DRIBBLERATOM DRIBBLERSTRING DRIBBLEERRORM DRIBBLECLOSEALL
	  (LINKFNS . T)
	  (GLOBALVARS DRIBBLEFILE DRIBBLELIST DRIBCH DRIBBLERELINKFLG 
		      ERRMSGTBL))
]
(DECLARE: DONTCOPY
  (FILEMAP (NIL (944 6224 (DRIBBLE 956 . 2388) (DRIBBLETERPRI 2392 .
2556) (DRIBBLEPRINT 2560 . 2731) (DRIBBLESPACES 2735 . 2905) (
DRIBBLEPRIN1 2909 . 3074) (DRIBBLEPRIN2 3078 . 3249) (DRIBBLEREAD
3253 . 4390) (DRIBBLEREADC 4394 . 4604) (DRIBBLERATOM 4608 . 5154)
(DRIBBLERSTRING 5158 . 5384) (DRIBBLEERRORM 5388 . 6069) (
DRIBBLECLOSEALL 6073 . 6221)))))
STOP
