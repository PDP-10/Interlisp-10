(FILECREATED "25-JAN-83 23:50:03" <LISPUSERS>SMARTARG.;27 8153   

      changes to:  (FNS SMARTARGLIST)

      previous date: "22-JAN-83 12:51:14" <LISPUSERS>SMARTARG.;26)


(* Copyright (c) 1981, 1982, 1983 by Xerox Corporation)

(PRETTYCOMPRINT SMARTARGCOMS)

(RPAQQ SMARTARGCOMS ((FNS SMARTARGLIST)
		     (FILEVARS SMARTARGLIST)
		     (FILES (SYSLOAD FROM VALUEOF LISPUSERSDIRECTORIES)
			    SWAPHASH)
		     [P (OR (BOUNDP (QUOTE SMARTARGARRAY))
			    (PROG ((ARR (SHARRAY 512)))
				  [MAPC SMARTARGLIST (FUNCTION (LAMBDA
								 (X)
								 (MAPC (CDR X)
								       (FUNCTION
									 (LAMBDA (F)
										 (SPUTHASH
										   F
										   (CAR X)
										   ARR]
				  (RPAQ SMARTARGARRAY ARR]
		     (LOCALVARS . T)))
(DEFINEQ

(SMARTARGLIST
  [LAMBDA (FN EXPLAINFLG TAIL)     (* lmm "25-JAN-83 23:46")
    (PROG (TEM DEF)
          [COND
	    ((NOT (LITATOM FN))
	      (RETURN (ARGLIST FN]
      RETRY
          [COND
	    ([SETQ TEM (GETLIS FN (QUOTE (ARGNAMES]

          (* gives user an override. also provides a way of ensuring that argument names stay around even if helpsys data base
	  goes away. for example, if user wanted to advise a system subr and was worried.)


	      (RETURN (COND
			((OR (NLISTP (SETQ TEM (CADR TEM)))
			     (CAR TEM))

          (* ARGNAMES is used for two purposes, one to provide an overrirde, the other to ave a lookup.
	  therefore for nospread functions, we must store both the arglist to be used for explaining, and the one to be used 
	  for breaking and advising. this situation is indicated by having the value of ARGNAMES be a dotted pair of the two 
	  arglists. (note thatthe first one will always be a list, hence this nlistp check to distinguish the two cases.))


			  TEM)
			(EXPLAINFLG (CADR TEM))
			(T (CDDR TEM]
          [COND
	    ([SETQ DEF (OR (GETD FN)
			   (CADR (GETLIS FN (QUOTE (EXPR CODE]
	      [COND
		([AND (NOT (SUBRP DEF))
		      (OR (NOT EXPLAINFLG)
			  (NOT (FMEMB (ARGTYPE DEF)
				      (QUOTE (2 3]

          (* Can use ARGLIST if function is defined. Want to try harder for subrs in interlisp-10, maybe.
	  Want to try harder if "EXPLAINING" rather than advising)


		  (RETURN (ARGLIST DEF]
	      (COND
		((AND (GETD (QUOTE HELPSYS))
		      [NLSETQ (SETQ TEM (HELPSYS FN (QUOTE ARGS]
		      TEM)
		  (COND
		    ((NULL (CAR TEM))
                                   (* helpsys stores arglists of NIL as (NIL))
		      (SETQ TEM NIL)))
		  [COND
		    ((NEQ (NARGS DEF)
			  (LENGTH TEM))
                                   (* DIFERENT NUMBER THAN IN MANUAL)
		      (SETQ TEM (ARGLIST DEF]
		  [/PUT FN (QUOTE ARGNAMES)
			(COND
			  ((SUBRP DEF)
                                   (* vanilla subr)
			    TEM)
			  (T (CONS NIL (CONS TEM (ARGLIST DEF]
		  (RETURN TEM]
          (RETURN (COND
		    [(AND EXPLAINFLG (SETQ TEM (GETMACROPROP FN COMPILERMACROPROPS)))
		      (SELECTQ (CAR TEM)
			       ([LAMBDA NLAMBDA OPENLAMBDA]
				 (CADR TEM))
			       (= (SMARTARGLIST (CDR TEM)
						EXPLAINFLG))
			       (NIL NIL)
			       (COND
				 ((LISTP (CAR TEM))
				   (RETURN (COND
					     [(CDR (LAST (CAR TEM)))
					       (APPEND (CAR TEM)
						       (LIST (QUOTE ...)
							     (CDR (LAST (CAR TEM]
					     (T (CAR TEM]
		    ((AND SMARTARGARRAY (SETQ TEM (SGETHASH FN SMARTARGARRAY)))
		      [PROG [(L (QUOTE (X Y Z P D Q]
			    (FRPTQ (IDIFFERENCE (NARGS FN)
						(LENGTH TEM))
				   (NCONC1 TEM (pop L]
		      TEM)
		    ([AND MSHASHFILENAME (SETQ TEM (GETTABLE FN (CADR MSARGTABLE]
		      (AND (NEQ TEM T)
			   TEM))
		    ((SETQ DEF (GETDEF FN (QUOTE FNS)
				       NIL 1))
		      (RETURN (ARGLIST DEF)))
		    ((SETQ TEM (FNCHECK FN T NIL T TAIL))
		      (SETQ FN TEM)
		      (GO RETRY))
		    (T (ARGLIST FN])
)

(RPAQQ SMARTARGLIST (((A)
		      OPENR ARRAYBEG)
		     ((A N)
		      ELT ELTD CLOSER)
		     ((ADDRESS N)
		      RELBLK)
		     ((ATM)
		      GETTOPVAL GETATOMVAL)
		     ((ATM VAL)
		      SETTOPVAL SETATOMVAL)
		     ((ATOM POS)
		      FRAMESCAN)
		     ((BLIPTYP IPOS)
		      BLIPSCAN)
		     ((BLIPTYP IPOS FLG)
		      BLIPVAL)
		     ((BLIPTYP IPOS N VAL)
		      SETBLIPVAL)
		     ((CARN CDRN)
		      PRINTLEVEL)
		     ((DATUM)
		      NTYP TYPENAME)
		     ((FILE FLG)
		      CLEARBUF READP)
		     ((FILE ADR)
		      SETFILEPTR)
		     ((FILE RDTBL FLG)
		      READ)
		     ((FILE RDTBL)
		      PEEKC)
		     ((FILE ACCESS)
		      OPENP OPNJFN)
		     ((FILE N)
		      POSITION)
		     ((FILE)
		      GETEOFPTR OUTFILEP GETFILEPTR INFILEP IOFILE INPUT SYSIN LASTC TERPRI INFILE 
		      OUTPUT READC OUTFILE)
		     ((FILE OPENFBITS GTJFNBITS)
		      OPENF)
		     ((FILE RDTBL)
		      RATOM RSTRING)
		     ((FLG TTBL)
		      RAISE ECHOMODE)
		     ((FLG)
		      SETREADMACROFLG READMACROS ESCAPE CLEARSTK LINBUF SYSBUF)
		     ((FLG RDTBL)
		      CONTROL)
		     ((FN)
		      SUBRP CCODEP MAPATOMS ARGTYPE EXPRP SCODEP)
		     ((FN ARGS APOS CPOS AFLG CFLG)
		      ENVAPPLY)
		     ((FN ARGS -)
		      APPLY BLKAPPLY)
		     ((FN DEF)
		      PUTD)
		     ((FORM APOS CPOS AFLG CFLG)
		      ENVEVAL)
		     ((FORM FLG -)
		      ERRORSET)
		     ((FORMATBITS)
		      DATE)
		     ((FRAMENAME N IPOS OPOS)
		      STKPOS)
		     ((FROMPTR TOPTR VAL)
		      RESUME)
		     ((HARRAY)
		      CLRHASH)
		     ((IPOS EPOS FLAGS FILE PRINTFN)
		      BACKTRACE)
		     ((ITEM VAL HARRAY)
		      PUTHASH)
		     ((ITEM HARRAY)
		      GETHASH)
		     ((LST FLG RDTBL)
		      SETSEPR SETBRK)
		     ((MESSAGE# STRING)
		      GCMESS)
		     ((MODE RDTBL)
		      CONTROL)
		     ((N AC1 AC2 AC3 RESULTAC)
		      JSYS)
		     ((N POS VALUE)
		      SETSTKARG)
		     ((N POS)
		      STKNTHNAME)
		     ((N P V)
		      ARRAY SWPARRAY)
		     ((N M)
		      IEQP LLSH LSH)
		     ((N POS NAME)
		      SETSTKARGNAME)
		     ((N FILE)
		      SPACES)
		     ((N POS)
		      STKARG STKARGNAME)
		     ((N)
		      SETSBSIZE GCTRP CONSCOUNT CLOCK GETBLK RADIX CHARACTER LINELENGTH ERRORSTRING 
		      FCHARACTER HARRAY)
		     ((N IPOS OPOS)
		      STKNTH)
		     ((NUM MESS)
		      SETERRORN)
		     ((OLDAR NEWAR)
		      REHASH)
		     ((POS VAL FLG)
		      RETTO RETFROM)
		     ((POS)
		      STKNAME RELSTK STKNARGS)
		     ((POS NAME)
		      SETSTKNAME)
		     ((POS1 POS2)
		      COPYSTK)
		     ((RDTBL FROM)
		      RESETREADTABLE)
		     ((RDTBL FLG)
		      SETREADTABLE)
		     ((RDTBL)
		      GETBRK READTABLEP COPYREADTABLE GETSEPR GETREADTABLE)
		     ((STRING)
		      HERALD)
		     ((TTBL FROM)
		      RESETTERMTABLE)
		     ((TTBL)
		      COPYTERMTABLE SETTERMTABLE GETTERMTABLE TERMTABLEP)
		     ((TYPE N)
		      BOXCOUNT)
		     ((VAR M)
		      ARG)
		     ((VAR M X)
		      SETARG)
		     ((VAR IPOS OPOS)
		      STKSCAN)
		     ((VAR X)
		      SETN)
		     ((X N Y)
		      RPLSTRING)
		     ((X N FLG RDTBL)
		      NTHCHAR)
		     ((X A)
		      EVALA)
		     ((X FILE RDTBL)
		      PRIN4 PRIN2 PRINT)
		     ((X FLG RDTBL)
		      NCHARS CHCON UNPACK)
		     ((X POS)
		      EVALV)
		     ((X FILE)
		      PRIN3 PRIN1)
		     ((X N M OLDPTR)
		      SUBSTRING)
		     ((X -)
		      EVAL)
		     ((X)
		      GO DECLARE PACK*)
		     ((VARLST E1 E2 ... En)
		      PROG RESETVARS)
		     ((FN ARG1 ARG2 ... ARGn)
		      APPLY* BLKAPPLY*)
		     ((C1 C2 ... Cn)
		      COND)))
(FILESLOAD (SYSLOAD FROM VALUEOF LISPUSERSDIRECTORIES)
	   SWAPHASH)
(OR (BOUNDP (QUOTE SMARTARGARRAY))
    (PROG ((ARR (SHARRAY 512)))
	  [MAPC SMARTARGLIST (FUNCTION (LAMBDA (X)
					       (MAPC (CDR X)
						     (FUNCTION (LAMBDA (F)
								       (SPUTHASH F (CAR X)
										 ARR]
	  (RPAQ SMARTARGARRAY ARR)))
(DECLARE: DOEVAL@COMPILE DONTCOPY

(LOCALVARS . T)
)
(PUTPROPS SMARTARG COPYRIGHT ("Xerox Corporation" 1981 1982 1983))
(DECLARE: DONTCOPY
  (FILEMAP (NIL (782 3954 (SMARTARGLIST 794 . 3951)))))
STOP
