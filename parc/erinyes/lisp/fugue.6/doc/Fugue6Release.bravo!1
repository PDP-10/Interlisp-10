filed on [rose]<lisp>fugue6>doc>fugue6release.bravo (635)\f1i51f0Ic\f5bc\f5bFugue.6 Release NotesMarch 9, 1984c\f5b24f0B13f5bThis document describes the Fugue.6 release of Interlisp-D.  This version substantially improves the performance and reliability of key system components and fixes many bugs reported in earlier releases of Fugue.   We invite you to send  comments, suggestions and bug reports to 1100Support@PARC-MAXC or to Xerox Special Information Systems, MS 2-143, 250 N. Halstead Street, Pasadena, CA 91107. The following are the most salient aspects of the Fugue.6 Release. <1>  Improved floppy disk system for the 1108.<2>  Improved RS232 support including low-cost graphics printer support.  <3>  Various new window/display facilities:	-- Menu	-- New GETREGION and GETBOXREGION	-- New DOWINDOWCOM	-- Window with CARET does not need to be on top	-- Minimum sizes for windows	-- CREATEREGION	-- CHANGEBACKGROUNDBORDER	-- VIDEOCOLOR<4>  New 1108 and 1132 microcode.<5>  New case-insensitive string manipulation facilities. <6>  New stream-dependent property handling end-of-line conventions.<7>  System level support for load-time constants.<8>  New/Improved LispLibrary and LispUsers packages:  <9>  Memory management handles large reference counts.  <10>  Sysouts may be installed directly from the 1108's rigid disk.<11>  Miscellaneous	-- STORAGE function takes two optional arguments	-- EDITPREFIXCHAR now defaults to NIL	-- GENSYM generalized     -- ATOMHASH#PROBES (new function)============================================<1>  1108 Floppy Disk System.One can use Interlisp-D on the 1108 to read, write, and otherwise interact with files on formatted floppy disks through standard Interlisp input/output functions.  Relibability has been substantially improved.  The {FLOPPY} device is now monitor-locked, so multiple processes can successfully access the disk simultaneously.  There is better protection against Control-B and Control-D.  And it is no longer possible for Lisp to die with 0510 or 0580-0584 maintenance panel errors.Further documentation is available in the Xerox 1108 Users Guide.<2>  RS232 SupportReflecting improvements in low-level IO processor code for the 1108, Interlisp-D RS232 performance is considerably improved: it will "Chat" and "Ftp" at 1200 baud now, and there are no more "Transmitter Wedged" errors. FXPRINTER is a  Lisp Library package which drives an Epson FX-80 printer using a serial (RS232) interface. See the discussion under new LispUsers packages. For the following items, see the full discussion (especially for limitations)  in the section  of this document entitled Revised Lisp Library  Packages.Some new functions available since the Fugue.4 release:  RS232MODEMCONTROL -- one arg, to set the modem control lines  RS232MODIFYMODEMCONTROL -- changes only the specified modem control lines  RS232MODEMSTATUSP -- reads the modem status lines  RS232READSTRING -- essentially a block input function; especially useful 		for time-critical applications  RS232BACKGROUND -- cause the keyboard scanning interrupt to poll the		RS232 Uart; may permit asynchronous operation at up to 600 baud.RS232CHAT will pay attention to the DSPSCROLL setting of the chat window, and will attempt to do "roll mode" rather than "wrap around" mode when the screen is full.  Also, new menu selections in the RS232 chat window permit one to specify whether the remote host sends CR or LF for "newline", and whether typing the RETURN key should send a CR/LF or just CR.The {RS232} device is created by RS232INIT, and one can obtain a stream interface to the RS232 port by (OPENSTREAM '{RS232} 'INPUT).<3>  Window/Display Changes.* Menu changes: submenus, item boxing, menu title fonts, and popup menus that don't tie up the mouse.  Items in a menu can now have subitems associated with them.  An item with a submenu is marked in the menu by a grey, right pointing triangle.  If the user drags the cursor out the right side of such an item, the submenu pops up.  If the user selects one of the items from the submenu, the selected item is handled as if it were selected from the main menu. If the user rolls out of the submenu to the left, the submenu is taken down and selection resumes from the main menu.Menus now have a new field SUBITEMFN which determines if a menu item has subitems.  The SUBITEMFN is called with two arguments -- a menu and an item  in that menu -- and should return a list of items (from which a submenu would be constructed) or NIL.  The SUBITEMFN is called once to compute the menu image and again each time the user rolls out of the item box, so the SUBITEMFN should be moderately efficient.  The default SUBITEMFN (named DEFAULTSUBITEMFN) checks to see if the item is a list whose fourth element is a list whose CAR is 'SUBITEMS and if so, returns the CDR of it.  The standard interpretation of items that are LISTP is that the first element is the label, the second the form to be evaluated and returned and the third the help string.  The rest of the list has been advertised as available for other uses, and we hope that no other use developed so far involves a list whose car is 'SUBITEMS.Submenus are computed the first time they are needed and cached in the menu.  This means that changes to subitems will not be noticed unless the item did not already have a submenu. Other changes to the menu package:The menu package now marks the item the cursor is over with a box when the button is not down.  This is the way Dedit's menu works now.  MENU contains a new field MENUTITLEFONT which indicates the font to be used for the title of the menu.  It should be either a font, NIL or T.  NIL will cause the window title font to be used (the standard now). T means use the same font as the menu items.MENU now takes an argument, RELEASECONTROLFLG, which allows the mouse to be used for other things while the popup menu is in place.  For example, the user may need to look around for information needed to determine the selection to make in this menu or reposition the menu before selecting from it.  If MENU is called in this way, clicking outside the menu (which is the standard way of indicating "no choice" to normal popup menus) will not return NIL .  This effect can be had by closing the menu (which causes NIL to be returned from MENU).  Programmers are encouraged to provide a menu item such as "cancel" or "abort" which gives users a positive way of indicating "no choice".* Changes to GETREGION and GETBOXREGION.  When passed a minimal region (as in shaping a window), they prompt with the minimal region.  They also prompt from the lower right corner and won't let the user specify a region that is off the screen.* DOWINDOWCOM now checks for the window property DOWINDOWCOMFN and if non-NIL applies it to the window.  * The window containing the CARET no longer jumps on top in order to flash the CARET. When the CARET is completely obscured it does not flash at all.* The system supports the notion of a minimum size for a window.  The new function MINIMUMWINDOWSIZE returns a dotted pair whose CAR is the minimum width and whose CDR is the minimum height.  The window property MINSIZE allows the user to set the minimum size of a window and should be a dotted pair or a function which when APPLYed to the window returns a dotted pair.  SHAPEW will not shape a window smaller than its minimum.* (CREATEREGION Left Bottom Width Height) is defined to return the same thing as (CREATE REGION LEFT _ Left BOTTOM _ Bottom WIDTH _ Width HEIGHT _ Height).* (CHANGEBACKGROUNDBORDER Shade), where shade is a texture 8 bits wide by 2 bits high, sets the 1108 display border.  CHANGEBACKGROUNDBORDER is a no-op on the 1100 and 1132.* VIDEOCOLOR now works on the 1108.<4>  New microcode.  * New 1108 Lisp microcode.  Some operations previously in 1108 Lisp microcode have been moved into the initial microcode, and replaced by other opcodes.* New 1108 initial microcode.  The process of installing Fugue.6 with the Installation Utility floppy will load new initial microcode into your 1108.  Note that while the new initial microcode is compatible with all Fugue sysouts, the Fugue.6 version of Interlisp-D will only run with the new initial microcode.  In addition, the new initial microcode depends on up-to-date PROMs: if Fugue.4 worked on your 1108, but the new initial microcode and new sysouts do not, contact 1100Support.* New 1132 microcode.  A number of improvements, especially for "creation" of datatypes and for numerical operations.  <5>  Case-insensitive string manipulation facilities.UPPERCASEARRAY 				 [Variable]  A casearray suitable for FFILEPOS et al, in which every lowercase character is mapped into the corresponding uppercase character.  Useful for searching text files.Extension to ALPHORDER:(ALPHORDER A B CASEARRAY)		  [Function]  ALPHORDER now takes a casearray argument: characters of A and B are translated through CASEARAY before being compared.  In addition, the value returned in the "true" case, i.e., when A and B are in lexicographic order, is now either EQUAL or LESSP to discriminate the cases of A and B being equal or unequal strings/atoms (according to CASEARRAY).New function:(UALPHORDER A B)				  [Function]  Defined as (ALPHORDER A B UPPERCASEARRAY).  Suitable as the comparefn argument of SORT.<6>  Stream-dependent property for handling end-of-line conventions: Fugue.6 supports end-of-line convention as a stream-dependent property.  The EOL convention of a stream (CR, CRLF, or LF) determines what sequence of characters on a file will be read (by READC, READ, etc) as the single internal end-of-line character CR.  The EOL convention for a stream is defaulted to the usual value for the particular host or device (e.g. CR for IFS files, CRLF for TOPS-20 leaf files).  It can be set explicitly by including for example (EOL CRLF) in the parameters argument to OPENFILE or OPENSTREAM, or by using the EOL attribute to SETFILEINFO.  The EOL convention for an open stream can be obtained via GETFILEINFO.<7>  SYSTEM LEVEL SUPPORT FOR LOAD-TIME CONSTANTS as provided in Interlisp-10 by the LOADTIMECONSTANTS Lispusers package.   A side-effect of this is that ^Y is now a readmacro in the CODERDTBL.  This means that files compiled under Fugue.4, or earlier versions of Interlisp-D  that contain ^Y as a literal in a function definition will not load correctly into Fugue.6; new Fugue.6 .DCOMs must be made for these files.  (Fugue.6 DCOMs can be back loaded into earlier Fugue sysouts except where there is a LOADTIMECONSTANT construct.)<8>  New/Improved LispLibrary and LispUsers packages:-- N.B. Some current Library and Lispusers packages take advantage of new functionality not available before the Fugue.6 release.  Thus not all new packages are compatible with pre-Fugue.6 sysouts.  Tedit is one such package.Complete documentation for these packages is contained in the section entitled Revised Lisp Packages. * ATTACHEDWINDOW is a new package for "attaching" one window to another.  Any number of windows can be attached to a window.  ATTACHEDWINDOW supercedes MENUEDWINDOW which becomes a simple case of attaching a menu window to another window.ATTACHEDWINDOW makes it easy to manipulate a group of window as a unit.  Standard operations like MOVE, RESHAPE, OPEN and CLOSE can be done so that it appears to the user as if the windows are a single entity.  Each collection of attached windows has one main window and any number of other windows that are "attached" to it.  Moving or reshaping the main window causes all of the attached windows to be moved or reshaped as well.  Moving or reshaping an attached window does not affect the main window.  The initial motivation for attached windows was to allow multiple menus to be associated with the same window but there is no restriction on what windows can be attached.* GRAPHER has several new, minor features.   This release is almost compatible with your current code, although the graphs will look a tad different, so you need only revise if you want to take advantage of the new features.--  General layout function:  LAYOUTGRAPH is a combination of LAYOUTFOREST and LAYOUTLATTICE (which have been de-documented to discourage their use).  It provides three kinds of format (tree, compact tree, and lattice) in four directions (left-to-right, right-to-left, top-to-bottom, and bottom-to-top). --  Icons as node labels:  LAYOUTGRAPH and SHOWGRAPH both accept a NODELABEL which is a bitmap of arbitrary size.--  Cyclic graphs are allowed in the lattice format.  They generate boxed nodes instead of errors.--  Documentation has been completely revised.  See GRAPHER.PRESS and GRAPHER.TED.--  Defaults for fonts come from DEFAULTFONT in the current FONTPROFILE.* FXPRINTER is a  Library package which drives an Epson FX-80 printer using a serial (RS232) interface.  This package has explicit funtions to print files, text, bitmaps, and windows; it should also be added to PRINTERTYPES (as a LOCALPRINTER) so that LISTFILES etc should know about it.  On an 1108, the RS232 connection is made through the 1108's "Printer DTB" port.* The following Lisp packages are new or changed since the Fugue.4 release:BROWSERICONWGRAPHZOOMMENUEDWINDOWNOTEPADRS232, RS232CHAT, RS232EXEC, RS232FTP, RS232LOGINSYSEDITTEDIT, TEDITHCPY, TEDITMENU, TEXTOFD, TFBRAVO, IMAGEOBJ<9>  Memory management handles large reference counts.  Reference counts exceeding 63 are now properly handled via a reference count overflow table.  This allows objects to be properly collected when the reference count again reaches zero.<10> Sysouts may be installed directly from the 1108's rigid disk.The Lisp Install Tool now allows the user to install a fresh sysout from one logical volume into another.  This can be substantially faster than installing a sysout from a fileserver or floppy disks.  See the Xerox 1108 Users Guide for details.<11> Miscellaneous*  STORAGE function takes two optional argumentsThe function STORAGE in Interlisp-D now takes two optional arguments for filtering the amount of information presented:(STORAGE TYPES PAGETHRESHOLD)If TYPES is given, STORAGE only lists statistics for those types.  TYPES is an atom or list of types (either names or numbers).  If PAGETHRESHOLD is given, then STORAGE only lists statistics for types that have at least PAGETHRESHOLD pages allocated to them.  Note: his is completely incompatible with Interlisp-10's STORAGE.*  EDITPREFIXCHAR now defaults to NILTTYIN users: the variable EDITPREFIXCHAR is now by default NIL, meaning you can't type meta commands (this to avoid confusing users who don't know about it).  If you want to be able to issue editing commands to TTYIN during your typein, you should either call (TTYINMETA T) to enable bottom-blank (STOP on 1108's) as a true meta key, or set EDITPREFIXCHAR to the character code of your preferred meta prefix (it used to be 193, for top-blank).* GENSYM generalized.GENSYM's first argument now can be a multicharacter atom or string and will be the prefix of the generated atom.  Previously you could specify only a one-character prefix.  Also, GENNUM is now initialized to 0 instead of 10000.* ATOMHASH#PROBES (new function)(ATOMHASH#PROBES string) returns the number of probes it takes to find an atom in Interlisp's atom has table with PNAME = string, or NIL if no such atom is found.============================================KNOWN PROBLEMS WITH THIS RELEASE:* Only the Installation Utility floppy can be used to partition the local disk in a rather stylized way.  There is currently no Lisp utility which allows the user to declare the name and size for each logical volume.  * A sysout generated on an 1108 cannot be installed on an 1100.* If you LOGOUT while some other process is actively writing a file, it is not guaranteed that anything reasonable happens to the file. The process system allows processes to prevent LOGOUT before completion (by using a BEFOREEXIT DON'T process property), but not all system facilities have been modified to use this mechanism.* The caret is still global, rather than being a part of the window structure.  This means that there are times where a caret gets left up in a window when it should have come down.* The swapping file on the 1100 and 1132 (Lisp.VirtualMem) must be a small number (optimally 1) of disk segments, or swapping performance will degrade drastically.  To create a (nearly) contiguous swapping file, use the Alto Exec command CREATEFILE.RUN on a newly-installed disk.   The maximum size is 16,000 pages; this will guarantee that Lisp.VirtualMem will not become fragmented. * Most system packages were written before multi-processing was added to Interlisp-D; some of these packages rely to some extent on there being only one process running, and access and alter global state accordingly. We have corrected many of these conflicts but have not yet completed this task.  Avoid running more than one instance (from different processes) of DEdit, EMPRESS (hardcopy), MAKEFILE, the compiler, or Masterscope.* Tedit does not automatically load two files on which it depends: TEDITMENU.DCOM and ATTACHEDWINDOW.DCOM. ============================================LOCATION OF FILES:The following files are all available on [Maxc]<XEOS>:[Site liaisons should move these files to their local file servers.]  * Lisp memory images files:	Lisp.SYSOUT		standard release virtual memory image * Initialization for 1100 (Dolphin) and 1132 (Dorado):	Lisp.run * Microcode for 1100 (Dolphin) [new]:	DolphinLispMC.eb	for 3MB Ethernet	XMBDolphinLispMC.eb	for 10 MB Ethernet 	X3DolphinLispMC.eb	both 3 and 10MB Ethernet, but no floating point * Microcode for 1132 (Dorado) [new]:	DoradoLispMC.eb * Initial microcode for 1108 (Dandelion)	LispSAx000Initial.db\10942i21I