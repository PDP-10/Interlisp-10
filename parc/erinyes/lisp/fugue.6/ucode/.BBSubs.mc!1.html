<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[Erinyes]&lt;LISP>FUGUE.6>Ucode>BBSubs.mc!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{<br>File name bbSubs.mc<br>Last edited by Jim Frandeen: January 12, 1982  4:18 PM: Reverse labels at SLRBack+1 and DLRBack+1.<br>Last edited by Jim Frandeen: January 11, 1982  1:35 PM: Fix at 3,4,mapSFixes.<br>Sandman: January 8, 1982  11:03 AM: init rhVS(VD) from uReg in Src(Dst)VAMod.<br>Last edited by Jim Frandeen: August 20, 1981  2:18 PM: Change for new Assembler.<br>Last edited by Jim Frandeen: March 16, 1981  3:52 PM: Change MoverhVtoStkandRestore to fix bug for crossing 64K boundaries.<br>Last edited by Jim Frandeen: March 15, 1981  11:05 PM: Add entry points to RestoreRandRHRegs and rearrange for new Block.mc that includes Checksum.<br>Last edited by Don Charnley: February 26, 1981  2:39 PM: Make MoverhVToStkandRestore smaller for new stack size.<br>Last edited by Jim Frandeen: February 24, 1981  8:46 PM: Add entry points to RestoreRandRHRegs and rearrange for new Block.mc.<br>Created by: Don Charnley January, 1980<br>Description: BitBlt op-code<br>}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">dT  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c* , one cycle long<br>This subroutine is used to aid in loading a link register.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">REGISTERS<br>rL</span><span class="tab" val="66"></span><span style="font: 8pt serif">value to place in link register<br>Lx</span><span class="tab" val="66"></span><span style="font: 8pt serif">link register to be loaded<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING SEQUENCE<br>To load a link register<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rL, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; retnum, Lx &larr; 0, XDisp, DISP4[dT]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>{rtn here}</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[retnum,10,dTrets];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>dTRets<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>dT:<br>{0}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0,10,dT];<br>{1}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[1,10,dT];<br>{2}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[2,10,dT];<br>{3}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[3,10,dT];<br>{4}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[4,10,dT];<br>{5}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[5,10,dT];<br>{6}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[6,10,dT];<br>{7}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[7,10,dT];<br>{8}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[8,10,dT];<br>{9}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[9,10,dT];<br>{0A}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0A,10,dT];<br>{0B}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0B,10,dT];<br>{0C}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0C,10,dT];<br>{0D}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0D,10,dT];<br>{0E}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0E,10,dT];<br>{0F}</span><span class="tab" val="66"></span><span style="font: 8pt serif">RET[dTRets]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*, at[0F,10,dT];<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MoverhVToStkandRestore  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">length = 3 clicks<br>This subroutine is used to move the rhV registers into the stack.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>L0</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MOVES<br>Rbb1</span><span class="tab" val="66"></span><span style="font: 8pt serif">to UDstBit<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">to USrcBit<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">EXITS TO RestoreRandRHRegs  SUBROUTINE<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>MoverhVToStkandRestore:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhL &larr; UrhLsave, GOTO[RestoreBlockRegsC3],</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}</span><span style="font: bold 8pt serif">, at[3,8,MoverhVToStkandRestore]</span><span style="font: 8pt serif">;<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RestoreRandRHRegs  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">length = 2 1/3 clicks<br>This subroutine is used to restore the R registers and rh registers which were saved at the entry into BitBlt.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>L0</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RESTORES<br>L</span><span class="tab" val="66"></span><span style="font: 8pt serif">from ULsave<br>G</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UGsave<br>PC</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UPCsave<br>rhMDS</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UrhMDSsave<br>rhPC</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UrhPCsave<br>rhG</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UrhGsave<br>rhL</span><span class="tab" val="66"></span><span style="font: 8pt serif">from UrhLsave<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>RestoreCallers<br>RestoreBlockRegs entries are used by Block.mc in order to end up on the right cycle. <br>Block.mc saves all registers but does not use them all.<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>RestoreRandRHRegs:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhL &larr; UrhLsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}, at[2,</span><span style="font: bold 8pt serif">8</span><span style="font: 8pt serif">, LSEPReturn];<br>RestoreBlockRegsC3:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhPC &larr; UrhPCsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br>RestoreBlockRegsC2:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhMDS &larr; UrhMDSsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>RestoreBlockRegsC1:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhG &larr; UrhGsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br>RestoreBlockRegsC3Initial:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{This entry can be used from Block only if rhG has not yet been modified.}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">PC &larr; UPCsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">G &larr; UGsave, L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">L &larr; ULsave, RET[RestoreCallers]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">DstVAMod  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c3 , last cycle = c2<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Timing: 4 clicks, + 1 if neg, + 1 if rh fix<br>This subroutine is used to modify the destination virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhWho</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">increment for the destination address<br>UDstVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination page and word<br>UDstBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination bit<br>rhDstVA</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>UDstVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination page and word<br>UDstBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination bit<br>rhDstVA</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual page and word<br>TempB</span><span class="tab" val="66"></span><span style="font: 8pt serif">bit<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">to call VAModSub<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLS<br>VAModSub<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>DstVAModRtn<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>DstVAMod:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVD &larr; UrhVD</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; UDstVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempB &larr; UDstBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhRet &larr; VAaRet, CALL[VAMod]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{VAMod subroutine here {2 or 3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}-c*{c3};}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{return here if rh needs fix}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VD &larr; UrhVD</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}, at[Or[VAaRet,1],8,VAModRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VD &larr; VD + TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhVD &larr; VD</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br>fixrhVD:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVD &larr; VD LRot0, DISP3{RET}[VAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{return here if no rh fix or after rh fix}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UDstVALo &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}, at[VAaRet,8,VAModRet];<br><br>DstVAExit:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhWho, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UDstBit &larr; TempB, DISP2{RET}[DstVAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcVAMod  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c3 , last cycle = c2<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Timing: 4 clicks, + 1 if neg, + 1 if rh fix<br>This subroutine is used to modify the source virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhWho</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">increment for the source address<br>USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source page and word<br>USrcBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source bit<br>rhSrcVA</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source page and word<br>USrcBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source bit<br>rhSrcVA</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual page and word<br>TempB</span><span class="tab" val="66"></span><span style="font: 8pt serif">bit<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">to call VAModSub and SrcRemap<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLS<br>VAModSub<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>SrcVAModRtn<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>SrcVAMod:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVS &larr; UrhVS</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempB &larr; USrcBit</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhRet &larr; VAbRet, CALL[VAMod]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{VAMod subroutine here {2 or 3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}-c*{c3};}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{return here if rh needs fix}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; UrhVS</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}, at[Or[VAbRet,1],8,VAModRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; VS + TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhVS &larr; VS</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br>fixrhVS:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVS &larr; VS LRot0, DISP3{RET}[VAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{return here if no rh fix or after fix}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USrcVALo &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1}, at[VAbRet,8,VAModRet];<br><br>SrcVAExit:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhWho, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USrcBit &larr; TempB, DISP2{RET}[SrcVAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VAMod  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c3 , last cycle = c2<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Timing: 2 clicks, + 1 if neg<br>This subroutine is used to modify a virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual page and word<br>TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">increment for the address<br>TempB</span><span class="tab" val="66"></span><span style="font: 8pt serif">bit<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual page and word<br>TempB</span><span class="tab" val="66"></span><span style="font: 8pt serif">bit<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS<br>TempBpl</span><span class="tab" val="66"></span><span style="font: 8pt serif">modifier for rh<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>VAMod:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempB &larr; TempB + TempBpl, NibCarryBr, GOTO[VAmod1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>VAmod1:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl and ~0F, NegBr, BRANCH[oldWord, nextWord]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br>oldWord:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot12, BRANCH[oldWPos, oldWNeg]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br>nextWord:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot12, BRANCH[nextWPos, nextWNeg]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br>oldWPos:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; Q + TempBpl, CarryBr, GOTO[bPP]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>bPP:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp, BRANCH[oldPSeg, newPSeg]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br><br>nextWPos:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; Q + TempBpl + 1, CarryBr, GOTO[bPP]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>oldWNeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot4</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl or 0F</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot12</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; Q + TempBpl, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>bPN:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp, BRANCH[newNSeg, oldNSeg]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br><br>nextWNeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot4</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl or 0F</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; TempBpl LRot12</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; Q + TempBpl + 1, CarryBr, GOTO[bPN]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br>oldPSeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; 0, DISP3{RET}[VAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>newPSeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; 1, DISP3{RET}[VAModRet,1] {signal rh update}</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>oldNSeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; 0, DISP3{RET}[VAModRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>newNSeg:</span><span class="tab" val="66"></span><span style="font: 8pt serif">TempBpl &larr; {-1}TempBpl xor ~TempBpl, DISP3{RET}[VAModRet,1] {signal rh update}</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcLRemap  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c1 , last cycle = c3<br>This subroutine is used to remap the source virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source page<br>rhVS</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>SrcA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source page and word<br>rhSrcA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>UQSave</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved value of Q<br>UVSsave</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved contents of VS<br>uT</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved contents or rhVS<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>SrcRemapReturn<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>SrcLRemap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">UQSave &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UXsave &larr; VS</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; USrcVALoSav, dirDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; 0FF + 1, dirDISP[SrcInc]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>SLRFor:</span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; VS + Q, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[dir.forward,dirM,SrcInc];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; rhVS + 1, </span><span style="font: italic 8pt serif">LOOPHOLE[byteTiming]</span><span style="font: 8pt serif">, BRANCH[nofixSRhP,fixSRhP]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixSRhP:</span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVS &larr; Q LRot0</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>fixRSh:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>nofixSRhP:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; USrcVALoSav &larr; [rhVS, VS], GOTO[mpS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br><br>SLRBack:</span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; VS - Q, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[dir.backwards,dirM,SrcInc];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; rhVS - 1, </span><span style="font: italic 8pt serif">LOOPHOLE[byteTiming]</span><span style="font: 8pt serif">, BRANCH[fixSRhN,nofixSRhN]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixSRhN:</span><span class="tab" val="66"></span><span style="font: 8pt serif">rhVS &larr; Q LRot0, GOTO[fixRSh]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>nofixSRhN:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; USrcVALoSav &larr; [rhVS, VS], GOTO[mpS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br><br><br>mpS1:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; SrcA and 0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; MD, rhSrcA &larr; MD, XRefBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop, BRANCH[fixSMap, nofixSMap]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>nofixSMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; SrcA and ~0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; SrcA or Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>mfsR:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; UQSave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; UXsave, RET[SrcRemapReturn]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixSMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; SrcA LRot0, XwdDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rhVS, VS], DISP2[mapSFixes]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>mapSFixes:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mfS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[0,4,mapSFixes];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mfS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[1,4,mapSFixes];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mfS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[2,4,mapSFixes];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">GOTO[mfS1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[3,4,mapSFixes];<br>mfS1:</span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; SrcA and ~0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; SrcA or Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">GOTO[mfsR]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br><br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">LRemap  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c1 , last cycle = c3<br>This subroutine is used to remap the source virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>U</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">VALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source page<br>rh</span><span style="font: 10pt serif">VD</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source page and word<br>rh</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USES<br>UQSave</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved value of Q<br>U</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">save</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved contents of </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"><br>uT</span><span class="tab" val="66"></span><span style="font: 8pt serif">saved contents or rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">RemapReturn<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">LRemap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">UQSave &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UXsave &larr; </span><span style="font: 10pt serif">VD</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; U</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">VALoSav, dirDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; 0FF + 1, dirDISP[</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">Inc]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>DLRFor:</span><span class="tab" val="66"></span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> + Q, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[dir.forward,dirM,</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">Inc];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> + 1, </span><span style="font: italic 8pt serif">LOOPHOLE[byteTiming]</span><span style="font: 8pt serif">, BRANCH[nofixDRhP,fixDRhP]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixDRhP:</span><span class="tab" val="66"></span><span style="font: 8pt serif">rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; Q LRot0</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>fixRDh:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>nofixDRhP:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; U</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">VALoSav &larr; [rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">, </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">], GOTO[mpD1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br><br>DLRBack:</span><span class="tab" val="66"></span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> - Q, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[dir.backwards,dirM,</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">Inc];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> - 1, </span><span style="font: italic 8pt serif">LOOPHOLE[byteTiming]</span><span style="font: 8pt serif">, BRANCH[fixDRhN,nofixDRhN]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixDRhN:</span><span class="tab" val="66"></span><span style="font: 8pt serif">rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; Q LRot0, GOTO[fixRDh]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>nofixDRhN:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; U</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">VALoSav &larr; [rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">, </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">], GOTO[mpD1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br><br><br>mpD1:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A and 0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; MD, rh</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; MD, XRefBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop, BRANCH[fixDMap, nofixDMap]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>nofixDMap:</span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A and ~0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A or Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>mfdR:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; UQSave</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif"> &larr; UXsave, RET[</span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">RemapReturn]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>fixDMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A LRot0, XwdDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rh</span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">, </span><span style="font: 10pt serif">VD</span><span style="font: 8pt serif">], DISP2[mapDFixes]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>mapDFixes:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A or 0B0, GOTO[mfD1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[0,4,mapDFixes];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A or 0B0, GOTO[mfD1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[1,4,mapDFixes];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{page fault cant happen.  Checked before entering loop}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{page fault cant happen.  Checked before entering loop}<br>mfD1:</span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A and ~0FF</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A &larr; </span><span style="font: 10pt serif">Dst</span><span style="font: 8pt serif">A or Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">GOTO[mfdR]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br><br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">DstMap  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c3 , last cycle = c3<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Timing: 2 1/3 clicks, + 1 if fix map flags<br>This subroutine is used to map the destination virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>UDstVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination<br>rhVD</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>DstA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real destination page and word<br>rhDstA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real destination rh<br>UDstVALoSav</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">uses as a temp<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">real destination page and word<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>DstMapRet<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>DstMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">VD &larr; UDstVALoSav</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>DstMapSpec:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rhVD, VD]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UDstVALoSav &larr; VD</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">DstA &larr; MD, rhDstA &larr; MD, XDirtyDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>DMapRef:</span><span class="tab" val="66"></span><span style="font: 8pt serif">MAR &larr; Q &larr; [rhDstA, VD + 0], BRANCH[upDMap, DMapOK, 1]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>DMapOK:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">DstA &larr; Q, DISP2{RET}[DstMapRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>upDMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; DstA LRot0, XwdDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rhVD, VD], DISP2[upDMapHere]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>upDMapHere:<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; DstA or 0B0, GOTO[mapD]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[0,4,upDMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; DstA or 0B0, GOTO[mapD]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[1,4,upDMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; qWriteProtect, GOTO[DFault]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[2,4,upDMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; qPageFault, GOTO[DFault]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[3,4,upDMapHere];<br><br>mapD:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Xbus &larr; 2, XDisp, GOTO[DMapRef]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcMap  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">first cycle = c3 , last cycle = c3<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Timing: 2 1/3 clicks, + 1 if fix map flags<br>This subroutine is used to map the source virtual address.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">CALLING ARGUMENTS<br>rhRet</span><span class="tab" val="66"></span><span style="font: 8pt serif">caller<br>USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source<br>rhVS</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual source rh<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">always UPDATES<br>SrcA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source page and word<br>rhSrcA</span><span class="tab" val="66"></span><span style="font: 8pt serif">real source rh<br>USrcVALoSav</span><span class="tab" val="66"></span><span style="font: 8pt serif">virtual destination<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">uses as a temp<br>Q</span><span class="tab" val="66"></span><span style="font: 8pt serif">real destination page and word<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">RETURNS THRU<br>SrcMapRet<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>SrcMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">VS &larr; USrcVALoSav</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>SrcMapSpec:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rhVS, VS]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">USrcVALoSav &larr; VS</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; MD, rhSrcA &larr; MD, XRefBr</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>SMapRef:</span><span class="tab" val="66"></span><span style="font: 8pt serif">MAR &larr; Q &larr; [rhSrcA, VS + 0], BRANCH[upSMap, SMapOK]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>SMapOK:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; rhRet, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SrcA &larr; Q, DISP</span><span style="font: bold 8pt serif">3</span><span style="font: 8pt serif">{RET}[SrcMapRet]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>upSMap:</span><span class="tab" val="66"></span><span style="font: 8pt serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; SrcA LRot0, XwdDisp</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Map &larr; [rhVS, VS], DISP2[upSMapHere]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c1;<br>upSMapHere:</span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mapS]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[0,4,upSMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mapS]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[1,4,upSMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MDR &larr; SrcA or 10, GOTO[mapS]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[2,4,upSMapHere];<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">Q &larr; qPageFault, GOTO[SFault]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c2, at[3,4,upSMapHere];<br><br>mapS:</span><span class="tab" val="66"></span><span style="font: 8pt serif">[] &larr; 0, ZeroBr, GOTO[SMapRef]</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c3;<br><br>{</span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">SavebbRegs  SUBROUTINE<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">length = 2 2/3 clicks<br>This subroutine is used to move the rh registers in U.<br>Note that the caller MUST save L before calling.<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">MOVES<br>TOS</span><span class="tab" val="66"></span><span style="font: 8pt serif">STK<br>G</span><span class="tab" val="66"></span><span style="font: 8pt serif">to UGsave<br>rhG</span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhGsave<br>PC</span><span class="tab" val="66"></span><span style="font: 8pt serif">to UPCsave<br>rhPC</span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhPCsave<br>L</span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhLsave<br>rhL</span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhLsave<br>rhMDS</span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhMDSsave<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">EXITS TO SavebbRegsRet<br></span><span style="font: 8pt serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt serif">}<br><br>SavebbRegs:</span><span class="tab" val="66"></span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">L &larr; rhL</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2}, at[0,10,SavebbRegs];<br>SaveBlockRegs::</span><span class="tab" val="66"></span><span style="font: 8pt serif"><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">PC &larr; PC - 1</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br>SaveBlockRegsx:</span><span class="tab" val="66"></span><span style="font: 8pt serif">{Radr same as Ublock containing following Uregs}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UPCsave &larr; PC</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{the following Uregs are at "xB" to allow "&larr; rh"}<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UGsave &larr; G</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhLsave &larr; L, G &larr; rhG </span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhGsave &larr; G, PC &larr; rhPC</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c1};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhPCsave &larr; PC, TOS &larr; rhMDS, pRet2,</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c2};<br></span><span class="tab" val="66"></span><span style="font: 8pt serif">UrhMDSsave &larr; TOS, RET[SavebbRegsRet],</span><span class="tab" val="66"></span><span style="font: 8pt serif">,c*{c3};<br><br></span><span class="tab" val="66"></span><span style="font: 8pt serif">{END}</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
