(DEFINE-FILE-INFO §READTABLE "INTERLISP" §PACKAGE "INTERLISP")(FILECREATED "18-Dec-86 15:18:05" {ERIS}<LISPCORE>LIBRARY>VTCHAT.;16 37175        changes to%:  (VARS VTCHATCOMS)                    (FNS VTCHAT.ADDRESS VTCHAT.ATTRIBUTES VTCHAT.DOCOMMAND VTCHAT.HANDLECHARACTER                          VTCHAT.CLEARMODES VTCHAT.REPORT VTCHAT.RESETMODE VTCHAT.RESTORE VTCHAT.SAVE                          VTCHAT.SEQUENCE VTCHAT.SETMARGINS VTCHAT.SETMODE VTCHAT.STATUS)      previous date%: "30-Mar-86 15:22:30" {ERIS}<LISPCORE>LIBRARY>VTCHAT.;15)(* "Copyright (c) 1983, 1984, 1985, 1986 by sSCHLUMBERGER TECHNOLOGY CORPORATION.  All rights reserved.")(PRETTYCOMPRINT VTCHATCOMS)(RPAQQ VTCHATCOMS        ((RECORDS * VTCHATRECORDS)        (COMS (* ;;; "VT100 emulator")              (FNS VTCHAT.ADDRESS VTCHAT.ATTRIBUTES VTCHAT.DECLFONT VTCHAT.DOCOMMAND                    VTCHAT.HANDLECHARACTER VTCHAT.CLEARMODES VTCHAT.REPORT VTCHAT.RESETMODE                    VTCHAT.RESTORE VTCHAT.REVERSE.INDEX VTCHAT.SAVE VTCHAT.SEQUENCE VTCHAT.SETMARGINS                    VTCHAT.SETMODE VTCHAT.STATE VTCHAT.STATUS))        (INITVARS (VTCHAT.DEBUGGING.FLG)               [CHATFONT (FONTCREATE '(GACHA 12 MRR]               (GRAPHICSFONT CHATFONT)               (VTCHAT.TERM.IDENTITY.STRING "[?1;0c"))        (GLOBALVARS VTCHAT.DEBUGGING.FLG CHATFONT GRAPHICSFONT VTCHAT.TERM.IDENTITY.STRING)        (ADDVARS (CHAT.DRIVERTYPES (VT100 VTCHAT.HANDLECHARACTER VTCHAT.STATE)))        (FILES (SYSLOAD FROM VALUEOF LISPUSERSDIRECTORIES)               VT100KP)))(RPAQQ VTCHATRECORDS (VT100SAVE VT100.STATE))(DECLARE%: EVAL@COMPILE(RECORD VT100SAVE (CURSORPOS CHARATTR CHARSET))(DATATYPE VT100.STATE ((DINGED FLAG)                       (EATLF FLAG)                       (EATCRLF FLAG)                       (EATTOCRLF FLAG)                       (AUTOLF FLAG)                       (BLINKMODE FLAG)                       (BRIGHTMODE FLAG)                       (SMOOTHSCROLL FLAG)                       (SIFONT POINTER)                       (KEYPADMODE FLAG)                       (CURSORMODE FLAG)                       (CHARSET0 FLAG)                       (CHARSET1 FLAG)                       (SOFONT POINTER)                       (PARAMCOUNT WORD)                       (ADDRESSING WORD)                       ESCAPESEQUENCE VT100MEM PARAMARRAY RELORIGIN INVERTFLG CSTERM)                      VT100MEM _ (create VT100SAVE                                        CURSORPOS _ (create POSITION                                                           XCOORD _ 1                                                           YCOORD _ 1))                      PARAMARRAY _ (ARRAY 12 'SMALLP 0 1)))(/DECLAREDATATYPE 'VT100.STATE       '(FLAG FLAG FLAG FLAG FLAG FLAG FLAG FLAG POINTER FLAG FLAG FLAG FLAG POINTER WORD WORD               POINTER POINTER POINTER POINTER POINTER POINTER)       '((VT100.STATE 0 (FLAGBITS . 0))         (VT100.STATE 0 (FLAGBITS . 16))         (VT100.STATE 0 (FLAGBITS . 32))         (VT100.STATE 0 (FLAGBITS . 48))         (VT100.STATE 0 (FLAGBITS . 64))         (VT100.STATE 0 (FLAGBITS . 80))         (VT100.STATE 0 (FLAGBITS . 96))         (VT100.STATE 0 (FLAGBITS . 112))         (VT100.STATE 0 POINTER)         (VT100.STATE 2 (FLAGBITS . 0))         (VT100.STATE 2 (FLAGBITS . 16))         (VT100.STATE 2 (FLAGBITS . 32))         (VT100.STATE 2 (FLAGBITS . 48))         (VT100.STATE 2 POINTER)         (VT100.STATE 4 (BITS . 15))         (VT100.STATE 5 (BITS . 15))         (VT100.STATE 6 POINTER)         (VT100.STATE 8 POINTER)         (VT100.STATE 10 POINTER)         (VT100.STATE 12 POINTER)         (VT100.STATE 14 POINTER)         (VT100.STATE 16 POINTER))       '18)(* ;;; "VT100 emulator")(DEFINEQ(VTCHAT.ADDRESS  [LAMBDA (CHAT.STATE VT100.STATE ROW COLUMN)                (* ; "Edited 18-Dec-86 15:06 by amd")                    (* ;; "Do absolute positioning")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE [COND                                                                 (RELORIGIN (SETQ ROW                                                                             (IPLUS ROW TOPMARGIN))                                                                        (COND                                                                           ((ILESSP ROW TOPMARGIN)                                                                            (SETQ ROW TOPMARGIN))                                                                           ((IGREATERP ROW                                                                                    BOTTOMMARGIN)                                                                            (SETQ ROW BOTTOMMARGIN]                                      (MOVETO (SETQ XPOS (IMIN (ITIMES (SUB1 COLUMN)                                                                      FONTWIDTH)                                                               (IDIFFERENCE TTYWIDTH FONTWIDTH)))                                             [SETQ YPOS (IMAX FONTDESCENT (IDIFFERENCE                                                                           HOMEPOS                                                                           (ITIMES (SUB1 ROW)                                                                                  FONTHEIGHT]                                             DSP)))    T])(VTCHAT.ATTRIBUTES  [LAMBDA (CHAT.STATE VT100.STATE ATTRARRAY ATTRCOUNT)       (* ; "Edited 18-Dec-86 15:06 by amd")                    (* ;; "Function to do character attribute setting")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (bind ATTRS for A from ATTRCOUNT to 1 by -1                                         do (SELECTQ (ELT ATTRARRAY A)                                                (0 (push ATTRS 'NORMAL))                                                (1 (push ATTRS 'BRIGHT))                                                (4 (push ATTRS 'BLINK))                                                (5 (push ATTRS 'UNDERLINE))                                                (7 (push ATTRS 'INVERSE))                                                NIL) finally (TERM.MODIFY.ATTRIBUTES CHAT.STATE ATTRS                                                                    ])(VTCHAT.DECLFONT  [LAMBDA (CHAT.STATE VT100.STATE CHAR)                      (* ejs%: "20-Mar-86 14:41")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE (SETQ CHARSET1 NIL)                                      (SETQ CHARSET0 NIL)                                      (SETQ ESCAPESEQUENCE NIL])(VTCHAT.DOCOMMAND  [LAMBDA (CHAT.STATE VT100.STATE CHAR)                      (* ; "Edited 18-Dec-86 15:08 by amd")                    (* ;; "Function called when an escape or control sequence has been terminated by CHAR")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (PROG [STAYESCAPE [PARAM1 (COND                                                                   ((ZEROP ESCAPESEQUENCE)                                                                    0)                                                                   (T (ELT PARAMARRAY 1]                                                   (PARAM2 (COND                                                              ((ILESSP ESCAPESEQUENCE 2)                                                               0)                                                              (T (ELT PARAMARRAY 2]                                            (SELCHARQ CHAR                                                 (%[         (* ;                                                  "ESC-LeftBracket is the control sequence introducer")                                                     (SETQ CSTERM 64)                                                     (SETQ ESCAPESEQUENCE 1)                                                     (SETQ STAYESCAPE T)                                                     (SETA PARAMARRAY 1 0))                                                 (7          (* ; "ESC 7 -> Save parameters")                                                    (VTCHAT.SAVE CHAT.STATE VT100.STATE))                                                 (8          (* ; "ESC 8 -> Restore parameters")                                                    (VTCHAT.RESTORE CHAT.STATE VT100.STATE))                                                 (A          (* ;                                                    "ESC [ Pn A -> Move up;  param1 indicates how far")                                                    (TERM.UP CHAT.STATE (COND                                                                           ((ZEROP PARAM1)                                                                            1)                                                                           (T PARAM1))))                                                 (B          (* ;                                                  "ESC [ Pn B -> Move down;  param1 indicates how far")                                                    (TERM.GODOWN CHAT.STATE (COND                                                                               ((ZEROP PARAM1)                                                                                1)                                                                               (T PARAM1))))                                                 (C          (* ;                                                 "ESC [ Pn C -> Move right;  param1 indicates how far")                                                    (TERM.RIGHT CHAT.STATE (COND                                                                              ((ZEROP PARAM1)                                                                               1)                                                                              (T PARAM1))))                                                 (D [COND                                                       ((EQ 0 ESCAPESEQUENCE)                                                             (* ; "ESC D -> index")                                                        (TERM.DOWN CHAT.STATE))                                                       (T    (* ; "ESC [ Pn D -> cursor backwards")                                                          (TERM.LEFT CHAT.STATE (COND                                                                                   ((ZEROP PARAM1)                                                                                    1)                                                                                   (T PARAM1])                                                 (E          (* ; "ESC E -> Do CRLF")                                                    (MOVETO (SETQ XPOS 0)                                                           YPOS DSP)                                                    (TERM.DOWN CHAT.STATE))                                                 ((H f)                                                       [COND                                                         ((AND (EQ CHAR (CHARCODE H))                                                               (EQ 0 ESCAPESEQUENCE))                                                             (* ; "ESC H -> Set tab at position")                                                          (TERM.SET.TAB CHAT.STATE (IQUOTIENT XPOS                                                                                           FONTWIDTH))                                                          )                                                         ((NOT (EQ 0 ESCAPESEQUENCE))                                                             (* ; "ESC [ Pn H -> Cursor addressing")                                                          (VTCHAT.ADDRESS CHAT.STATE VT100.STATE                                                                 (COND                                                                    ((OR (ZEROP PARAM1)                                                                         (NULL PARAM1))                                                                     1)                                                                    (T PARAM1))                                                                 (COND                                                                    ((OR (ZEROP PARAM2)                                                                         (NULL PARAM2))                                                                     1)                                                                    (T PARAM2])                                                 (J          (* ;                                                            "Erase in display;  param1 indicates mode")                                                    (TERM.ERASE.IN.DISPLAY CHAT.STATE                                                           (COND                                                              ((OR (ZEROP PARAM1)                                                                   (NULL PARAM1))                                                               0)                                                              (T PARAM1))))                                                 (K          (* ;                                                              "Erase in line;  param1 indicates mode")                                                    (TERM.ERASE.IN.LINE CHAT.STATE                                                           (COND                                                              ((OR (ZEROP PARAM1)                                                                   (NULL PARAM1))                                                               0)                                                              (T PARAM1))))                                                 (M          (* ; "Reverse Index")                                                    (VTCHAT.REVERSE.INDEX CHAT.STATE VT100.STATE))                                                 (Z          (* ; "What are you?")                                                    (TERM.IDENTIFY.SELF CHAT.STATE))                                                 (< NIL)                                                 (=          (* ; "Enter keypad application mode")                                                    (VTCHAT.KPAPPLMODE CHAT.STATE VT100.STATE T))                                                 (>          (* ; "Leave keypad application mode")                                                    (VTCHAT.KPAPPLMODE CHAT.STATE VT100.STATE NIL))                                                 (c          (* ; "What are you?")                                                    (TERM.IDENTIFY.SELF CHAT.STATE))                                                 (h          (* ; "Set modes")                                                    (VTCHAT.SETMODE CHAT.STATE VT100.STATE PARAMARRAY                                                            ESCAPESEQUENCE))                                                 (l          (* ; "Reset mode")                                                    (VTCHAT.RESETMODE CHAT.STATE VT100.STATE                                                            PARAMARRAY ESCAPESEQUENCE))                                                 (m          (* ; "Set char attributes")                                                    (VTCHAT.ATTRIBUTES CHAT.STATE VT100.STATE                                                            PARAMARRAY ESCAPESEQUENCE))                                                 (n          (* ; "Status report")                                                    (VTCHAT.STATUS CHAT.STATE VT100.STATE PARAM1))                                                 (r          (* ; "Set scrolling margins")                                                    (VTCHAT.SETMARGINS CHAT.STATE VT100.STATE                                                           (COND                                                              ((ZEROP PARAM1)                                                               1)                                                              (T PARAM1))                                                           (COND                                                              ((ZEROP PARAM2)                                                               (ITIMES (IQUOTIENT TTYHEIGHT                                                                               FONTHEIGHT)                                                                      FONTHEIGHT))                                                              (T PARAM2))))                                                 (x (VTCHAT.REPORT CHAT.STATE VT100.STATE))                                                 (\)                                                 (PROGN                     (* ;; "(COND ((ZEROP ESCAPESEQUENCE) (printout PROMPTWINDOW 'ESC ' (CHARACTER CHAR) T)) (T (printout PROMPTWINDOW 'ESC[' PARAM1 ';' PARAM2 ' ' (CHARACTER CHAR) T)))")                                                        NIL))                                            (OR STAYESCAPE (SETQ ESCAPESEQUENCE NIL])(VTCHAT.HANDLECHARACTER  [LAMBDA (CHAR CHAT.STATE VT100.STATE)                      (* ; "Edited 18-Dec-86 15:09 by amd")                    (* ;; "Here and/or below")    (DECLARE (GLOBALVARS VTCHAT.DEBUGGING.FLG \MACHINETYPE \DANDELION \DAYBREAK))    (with CHAT.STATE CHAT.STATE          (with VT100.STATE VT100.STATE [COND                                           (VTCHAT.DEBUGGING.FLG (COND                                                                    ((ILESSP CHAR (CHARCODE SPACE))                                                                     (PRINTOUT PROMPTWINDOW "[" CHAR                                                                             "]"))                                                                    (T (\OUTCHAR (GETSTREAM                                                                                         PROMPTWINDOW)                                                                              CHAR]                (PROG NIL                      [COND                         ((EQ CHAR (CHARCODE BELL))                          (RETURN (COND                                     ((OR (EQ \MACHINETYPE \DANDELION)                                          (EQ \MACHINETYPE \DAYBREAK))                                      (BEEPON 880)                                      (DISMISS 20)                                      (BEEPOFF))                                     ((NOT DINGED)                                      (APPLY* INVERTWINDOWFN WINDOW)                                                             (* ; "Complement window")                                      (SETQ DINGED T]                      (COND                         (DINGED (APPLY* INVERTWINDOWFN WINDOW)                                (SETQ DINGED NIL)))                      (COND                         ((EQ CHAR (CHARCODE ^%[))                          (SETQ AUTOLF NIL)))                      (SELCHARQ CHAR                           ((LF FF ^K)                       (* ; "Line Feed")                                (COND                                   ((NOT EATLF)                                    (TERM.DOWN CHAT.STATE))                                   (T (SETQ EATLF NIL))))                           (^I                               (* ; "Tab")                               (TERM.TAB CHAT.STATE))                           (CR                               (* ; "Carriage return")                               (MOVETO (SETQ XPOS 0)                                      YPOS DSP))                           (BS                               (* ; "Back space")                               (TERM.LEFT CHAT.STATE 1))                           ((^X ^Z)                          (* ; "Cancel --resets modes")                                (VTCHAT.CLEARMODES CHAT.STATE VT100.STATE))                           (^N (DSPFONT SOFONT WINDOW)                               (SETQ CURRENTFONT 'SOFONT)    (* ; "SO --- character set switch")                               )                           (^O (DSPFONT SIFONT WINDOW)                               (SETQ CURRENTFONT 'SIFONT)    (* ; "SI --- character set switch")                               )                           (^%[                              (* ; "ESC Leadin")                                (SETQ ESCAPESEQUENCE 0)                                (SETQ CSTERM 48))                           (COND                              ((IGEQ CHAR (CHARCODE SPACE))  (* ; "Normal char")                               (COND                                  (ESCAPESEQUENCE (VTCHAT.SEQUENCE CHAT.STATE VT100.STATE CHAR))                                  (T (SETQ EATLF (SETQ EATCRLF NIL))                                     (RETURN (COND                                                ((AND (NEQ CHAR (CHARCODE DEL))                                                      (NOT EATTOCRLF))                                                             (* ; "Print the char")                                                 (TERM.PRINTCHAR CHAT.STATE CHAR (fetch (CHAT.STATE                                                                                         WRAPMODE)                                                                                    of CHAT.STATE])(VTCHAT.CLEARMODES  [LAMBDA (CHAT.STATE VT100.STATE)                           (* ; "Edited 18-Dec-86 15:09 by amd")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE (COND                                                                 ((OR BLINKMODE BRIGHTMODE)                                                                  (DSPFONT PLAINFONT DSP)                                                             (* ; "Restore normal font")                                                                  (SETQ FONT PLAINFONT)                                                                  (SETQ BRIGHTMODE (SETQ BLINKMODE])(VTCHAT.REPORT  [LAMBDA (CHAT.STATE VTCHAT.STATE)                          (* ; "Edited 18-Dec-86 15:12 by amd")                    (* ;; "Report terminal parameters -- DECREPTPARM")    (with CHAT.STATE CHAT.STATE (PRIN4 "[2;1;1;" OUTSTREAM)          (COND             [(EQ (fetch (STREAM DEVICE) of OUTSTREAM)                  \RS232C.FDEV)              (LET [(BAUD (CDR (FASSOC [CDR (FASSOC 'LINE.SPEED (RS232C.GET.PARAMETERS '(LINE.SPEED]                                      '((50 . 0)                                        (75 . 8)                                        (110 . 16)                                        (150 . 32)                                        (200 . 40)                                        (300 . 48)                                        (600 . 56)                                        (1200 . 64)                                        (1800 . 72)                                        (2000 . 80)                                        (2400 . 88)                                        (3600 . 96)                                        (4800 . 104)                                        (9600 . 112)                                        (19200 . 120]                   (COND                      (BAUD (printout OUTSTREAM BAUD ";" BAUD ";"))                      (T (printout OUTSTREAM "0;0;"]             (T (printout OUTSTREAM "0;0;")))          (PRIN1 "1;0x" OUTSTREAM)          (FORCEOUTPUT OUTSTREAM])(VTCHAT.RESETMODE  [LAMBDA (CHAT.STATE VT100.STATE MODEARRAY SETCOUNT)        (* ; "Edited 18-Dec-86 15:13 by amd")                    (* ;; "Does mode resetting")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (for M from 1 to SETCOUNT                                         do (SELECTQ (ELT MODEARRAY M)                                                (1 (replace (VT100.STATE CURSORMODE) of VT100.STATE                                                      with NIL))                                                (4 (SETQ SMOOTHSCROLL NIL))                                                (5 (COND                                                      (INVERTFLG (INVERTW WINDOW)                                                             (SETQ INVERTFLG NIL)                                                             (DSPTEXTURE WHITESHADE DSP)                                                             (DSPOPERATION 'REPLACE DSP))))                                                (6 (SETQ RELORIGIN NIL)                                                   (VTCHAT.ADDRESS CHAT.STATE VT100.STATE 1 1))                                                (7 (SETQ WRAPMODE NIL))                                                NIL])(VTCHAT.RESTORE  [LAMBDA (CHAT.STATE VT100.STATE)                           (* ; "Edited 18-Dec-86 15:13 by amd")                    (* ;; "Function to restor cursor, etc from storage")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (AND VT100MEM (PROGN (MOVETO (SETQ XPOS                                                                    (CAR (fetch (VT100SAVE CURSORPOS)                                                                            of VT100MEM)))                                                                  (SETQ YPOS                                                                   (CDR (fetch (VT100SAVE CURSORPOS)                                                                           of VT100MEM)))                                                                  DSP)                                                           (DSPFONT (CAR (fetch (VT100SAVE CHARATTR)                                                                            of VT100MEM))                                                                  DSP)                                                           (SETQ UNDERLINEMODE                                                            (CADR (fetch (VT100SAVE CHARATTR)                                                                     of VT100MEM)))                                                           (DSPSOURCETYPE (CADDR (fetch (VT100SAVE                                                                                         CHARATTR)                                                                                    of VT100MEM])(VTCHAT.REVERSE.INDEX  [LAMBDA (CHAT.STATE VT100.STATE)                           (* ejs%: "18-Nov-85 12:58")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE (COND                                                                 ((ILESSP YPOS (IDIFFERENCE TOPMARGIN                                                                                       FONTHEIGHT))                                                                  (MOVETO XPOS                                                                         (SETQ YPOS                                                                          (IMIN (IDIFFERENCE                                                                                        TOPMARGIN                                                                                        FONTHEIGHT)                                                                                (IPLUS YPOS                                                                                        FONTHEIGHT)))                                                                         DSP))                                                                 (T (TERM.SCROLLDOWN CHAT.STATE                                                                            TOPMARGIN])(VTCHAT.SAVE  [LAMBDA (CHAT.STATE VT100.STATE)                           (* ; "Edited 18-Dec-86 15:14 by amd")                    (* ;; "Function to save current curpos position, graphic rendition, and character set")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE (OR VT100MEM (SETQ VT100MEM                                                                            (create VT100SAVE)))                                      (replace (VT100SAVE CURSORPOS) of VT100MEM                                         with (create POSITION                                                     XCOORD _ XPOS                                                     YCOORD _ YPOS))                                      (replace (VT100SAVE CHARATTR) of VT100MEM                                         with (LIST FONT UNDERLINEMODE (DSPSOURCETYPE NIL DSP])(VTCHAT.SEQUENCE  [LAMBDA (CHAT.STATE VT100.STATE CHAR)                      (* ; "Edited 18-Dec-86 15:14 by amd")                    (* ;; "Here when an ESC has been seen")    (with CHAT.STATE CHAT.STATE          (with VT100.STATE VT100.STATE                (PROG (TEMP FONTDECL)                      (COND                         ((IGREATERP CHAR CSTERM)                          (VTCHAT.DOCOMMAND CHAT.STATE VT100.STATE CHAR))                         (T (COND                               ((ZEROP ESCAPESEQUENCE)                                (SELECTC CHAR                                    ((CHARCODE %()                                          (SETQ CHARSET0 T)                                         (SETQ ESCAPESEQUENCE 1)                                         (SETQ CSTERM (CHARCODE B)))                                    ((CHARCODE %))                                          (SETQ CHARSET1 T)                                         (SETQ ESCAPESEQUENCE 1)                                         (SETQ CSTERM (CHARCODE B)))                                    (printout PROMPTWINDOW "Bad ESCAPESEQUENCE--CHAR is "                                           (CHARACTER CHAR)                                           T)))                               (T (COND                                     ((OR CHARSET0 CHARSET1)                                      (VTCHAT.DECLFONT CHAT.STATE VT100.STATE CHAR))                                     (T (SELCHARQ CHAR                                             ((0 1 2 3 4 5 6 7 8 9)                                                   (SETQ TEMP (IPLUS (ITIMES 10 (ELT PARAMARRAY                                                                                     ESCAPESEQUENCE))                                                                    (IDIFFERENCE CHAR 48)))                                                  (COND                                                     ((ILESSP TEMP MAX.SMALLP)                                                      (SETA PARAMARRAY ESCAPESEQUENCE TEMP))))                                             (; (SETQ ESCAPESEQUENCE (ADD1 ESCAPESEQUENCE))                                                (SETA PARAMARRAY ESCAPESEQUENCE 0))                                             NIL])(VTCHAT.SETMARGINS  [LAMBDA (CHAT.STATE VT100.STATE TOP BOTTOM)                (* ; "Edited 18-Dec-86 15:15 by amd")                    (* ;; "Function to set top and bottom margins")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE [SETQ TOPMARGIN                                                               (IMAX 0 (IDIFFERENCE                                                                        HOMEPOS                                                                        (ITIMES (IDIFFERENCE TOP 2)                                                                               FONTHEIGHT]                                      (SETQ BOTTOMMARGIN (IMAX 0 (IDIFFERENCE                                                                  (IDIFFERENCE HOMEPOS                                                                         (ITIMES (SUB1 BOTTOM)                                                                                FONTHEIGHT))                                                                  FONTDESCENT)))                                      (TERM.HOME CHAT.STATE])(VTCHAT.SETMODE  [LAMBDA (CHAT.STATE VT100.STATE MODEARRAY SETCOUNT)        (* ; "Edited 18-Dec-86 15:15 by amd")                    (* ;; "Does mode setting")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (for M from 1 to SETCOUNT                                         do (SELECTQ (ELT MODEARRAY M)                                                (1 (replace (VT100.STATE CURSORMODE) of VT100.STATE                                                      with T))                                                (4 (SETQ SMOOTHSCROLL T))                                                (5 (COND                                                      ((NULL INVERTFLG)                                                       (SETQ INVERTFLG T)                                                       (INVERTW WINDOW)                                                       (DSPOPERATION 'ERASE DSP)                                                       (DSPTEXTURE BLACKSHADE DSP))))                                                (6 (SETQ RELORIGIN T)                                                   (CHAT.ADDRESS 1 1))                                                (7 (SETQ WRAPMODE T))                                                NIL])(VTCHAT.STATE  [LAMBDA (CHAT.STATE)                                       (* ejs%: "30-Mar-86 14:43")    (replace (CHAT.STATE TERM.IDENTITY.STRING) of CHAT.STATE with VTCHAT.TERM.IDENTITY.STRING)    (replace (CHAT.STATE TERM.TAB.STOPS) of CHAT.STATE       with '(8 16 24 32 40 48 56 64 72 80 88 96 104 112 120 128 136))    (replace (CHAT.STATE WRAPMODE) of CHAT.STATE with T)    (TERM.RESET.DISPLAY.PARMS CHAT.STATE)    (TERM.HOME CHAT.STATE)    (create VT100.STATE])(VTCHAT.STATUS  [LAMBDA (CHAT.STATE VT100.STATE TYPE)                      (* ; "Edited 18-Dec-86 15:16 by amd")                    (* ;; "Returns VT100 status info")    (with CHAT.STATE CHAT.STATE (with VT100.STATE VT100.STATE                                      (SELECTQ TYPE                                          (5                 (* ; "Host wants device status")                                             (PRIN1 "[0n" OUTSTREAM))                                          (6                 (* ; "Host wants cursor coords")                                             (BOUT OUTSTREAM (CHARCODE ^%[))                                             (BOUT OUTSTREAM (CHARCODE %[))                                             [BOUT OUTSTREAM (MKSTRING (ADD1 (IQUOTIENT YPOS                                                                                     FONTHEIGHT]                                             (BOUT OUTSTREAM (CHARCODE ;))                                             [BOUT OUTSTREAM (MKSTRING (ADD1 (IQUOTIENT XPOS                                                                                     FONTWIDTH]                                             (BOUT OUTSTREAM (CHARCODE R)))                                          NIL)                                      (FORCEOUTPUT OUTSTREAM]))(RPAQ? VTCHAT.DEBUGGING.FLG )(RPAQ? CHATFONT (FONTCREATE '(GACHA 12 MRR)))(RPAQ? GRAPHICSFONT CHATFONT)(RPAQ? VTCHAT.TERM.IDENTITY.STRING "[?1;0c")(DECLARE%: DOEVAL@COMPILE DONTCOPY(GLOBALVARS VTCHAT.DEBUGGING.FLG CHATFONT GRAPHICSFONT VTCHAT.TERM.IDENTITY.STRING))(ADDTOVAR CHAT.DRIVERTYPES (VT100 VTCHAT.HANDLECHARACTER VTCHAT.STATE))(FILESLOAD (SYSLOAD FROM VALUEOF LISPUSERSDIRECTORIES)       VT100KP)(PUTPROPS VTCHAT COPYRIGHT ("sSCHLUMBERGER TECHNOLOGY CORPORATION" 1983 1984 1985 1986))(DECLARE%: DONTCOPY  (FILEMAP (NIL (3834 36621 (VTCHAT.ADDRESS 3844 . 5537) (VTCHAT.ATTRIBUTES 5539 . 6558) (VTCHAT.DECLFONT 6560 . 6890) (VTCHAT.DOCOMMAND 6892 . 17925) (VTCHAT.HANDLECHARACTER 17927 . 22345) (VTCHAT.CLEARMODES 22347 . 23016) (VTCHAT.REPORT 23018 . 24532) (VTCHAT.RESETMODE 24534 . 25891) (VTCHAT.RESTORE 25893 . 27633) (VTCHAT.REVERSE.INDEX 27635 . 28946) (VTCHAT.SAVE 28948 . 29868) (VTCHAT.SEQUENCE 29870 . 32220) (VTCHAT.SETMARGINS 32222 . 33362) (VTCHAT.SETMODE 33364 . 34720) (VTCHAT.STATE 34722 . 35249) (VTCHAT.STATUS 35251 . 36619)))))STOP