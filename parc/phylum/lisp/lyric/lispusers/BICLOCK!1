(DEFINE-FILE-INFO READTABLE "INTERLISP" PACKAGE "INTERLISP")(FILECREATED "16-Nov-87 18:57:21" {DSK}<LISPFILES>BICLOCK.;1 35563        previous date%: "16-Aug-87 18:01:46" |{RONJA:IDA:LITH}<BKN>BICLOCK.;46|)(* "Copyright (c) 1984, 1985, 1986, 1987 by Bernt Nilsson @ University of Linkoeping.  All rights reserved.")(PRETTYCOMPRINT BICLOCKCOMS)(RPAQQ BICLOCKCOMS        [(FNS BICLOCK BICLOCKBEFN BICLOCKCFN BICLOCKFINDFONT BICLOCKNRFN BICLOCKPROCESS BICLOCKRPFN              BICLOCKRSFN BICLOCKSETALARM BICLOCKSETALARM1 BICLOCKSETALARM2 IDLE.BICLOCK)        (RECORDS BICLOCKPARMS UPTIMEREC)        (GLOBALVARS BICLOCKDEFAULTPROPS BICLOCKUSERPROPS BICLOCKINITIALPROPS BICLOCKIDLEPROPS)        [VARS (BICLOCKDEFAULTPROPS '(SECONDS T COLOR WHITE MARKS NIL DIGITS HOUR CHIME NIL ALARM NIL                                            SIZE 119 HORIZONTAL RIGHT VERTICAL TOP CREATE T]        [INITVARS (BICLOCKUSERPROPS)               (BICLOCKINITIALPROPS)               (BICLOCKIDLEPROPS '(HORIZONTAL CENTER VERTICAL CENTER]        (VARS (BICLOCKWINDOW (BICLOCK BICLOCKINITIALPROPS)))        (ADDVARS (IDLE.FUNCTIONS (Biclock 'IDLE.BICLOCK))               (IDLE.SUSPEND.PROCESS.NAMES BICLOCKPROCESS))        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA)                                                                             (NLAML)                                                                             (LAMA BICLOCK])(DEFINEQ(BICLOCK  [LAMBDA PROPS                                              (* BKN "13-Aug-87 15:32")    (LET     ((PLIST (APPEND (if [AND (EQ PROPS 1)                              (OR (NULL (ARG PROPS 1))                                  (LISTP (ARG PROPS 1]                         then (ARG PROPS 1)                       else (for I from 1 to PROPS collect (ARG PROPS I)))                    BICLOCKUSERPROPS BICLOCKDEFAULTPROPS)))     (if [OR (ODDP (LENGTH PLIST))             (find P in PLIST by (CDDR P) suchthat (NOT (LITATOM P]         then (ERROR "ARG NOT PROPLIST IN BICLOCK" PLIST))     (if (LISTGET PLIST 'CREATE)         then         (LET          ((W            (OR             (LISTGET PLIST 'WINDOW)             (CREATEW              (OR (LISTGET PLIST 'REGION)                  [LET [(SIZE (LISTGET PLIST 'SIZE))                        (HOR (LISTGET PLIST 'HORIZONTAL))                        (VERT (LISTGET PLIST 'VERTICAL]                       (if SIZE                           then (if (AND HOR VERT)                                    then (CREATEREGION (SELECTQ HOR                                                           (LEFT 0)                                                           (CENTER (QUOTIENT (DIFFERENCE SCREENWIDTH                                                                                     SIZE)                                                                          2))                                                           (RIGHT (DIFFERENCE (DIFFERENCE SCREENWIDTH                                                                                      SIZE)                                                                         1))                                                           (OR (NUMBERP HOR)                                                               0))                                                (SELECTQ VERT                                                    (BOTTOM 0)                                                    (CENTER (QUOTIENT (DIFFERENCE SCREENHEIGHT SIZE)                                                                   2))                                                    (TOP (DIFFERENCE (DIFFERENCE SCREENHEIGHT SIZE)                                                                1))                                                    (OR (NUMBERP VERT)                                                        0))                                                SIZE SIZE)                                  else (GETBOXREGION SIZE SIZE]                  (GETREGION 20 20 NIL 'BICLOCKNRFN))              NIL 0)))           [PARMS (create BICLOCKPARMS                         SECONDSMODE _ (LISTGET PLIST 'SECONDS)                         COLORMODE _ (LISTGET PLIST 'COLOR)                         MARKMODE _ [SELECTQ (LISTGET PLIST 'MARKS)                                        (HOUR 5)                                        ((HOUR&MINUTE MINUTE)                                              1)                                        (|3/6/9/12| 15)                                        (NUMBERP (LISTGET PLIST 'MARKS]                         DIGMODE _ [SELECTQ (LISTGET PLIST 'DIGITS)                                       (HOUR 1)                                       (|3/6/9/12| 3)                                       (NUMBERP (LISTGET PLIST 'DIGITS]                         CHIMEMODE _ [SELECTQ (LISTGET PLIST 'CHIME)                                         (HOUR 60)                                         (QUORTER 15)                                         (NUMBERP (LISTGET PLIST 'CHIME]                         ROMANDIGS _ (EQ (LISTGET PLIST 'DIGITFORMAT)                                         'ROMAN)                         ADJUSTEVENT _ (CREATE.EVENT)                         ALARMTIME _ (if (LISTGET PLIST 'ALARM)                                         then (IDATE (LISTGET PLIST 'ALARM]           P)          (SETQ P (ADD.PROCESS (LIST (FUNCTION BICLOCKPROCESS)                                     (KWOTE W)                                     (KWOTE PARMS))                         'RESTARTABLE                         'HARDRESET))          (WINDOWPROP W 'PROCESS P)          (WINDOWPROP W 'NEWREGIONFN (FUNCTION BICLOCKNRFN))          (WINDOWPROP W 'RESHAPEFN (FUNCTION BICLOCKRSFN))          (WINDOWPROP W 'REPAINTFN (FUNCTION BICLOCKRPFN))          (WINDOWPROP W 'CLOSEFN (FUNCTION BICLOCKCFN))          (WINDOWPROP W 'AFTERMOVEFN (FUNCTION BICLOCKRPFN))          (WINDOWPROP W 'PARMS PARMS)          (WINDOWPROP W 'WINDOWENTRYFN (FUNCTION BICLOCKBEFN))          (WINDOWPROP W 'BUTTONEVENTFN (FUNCTION BICLOCKBEFN))          W])(BICLOCKBEFN  [LAMBDA (W)                                                (* BKN "19-May-86 15:55")    [if (PROCESS.FINISHEDP (WINDOWPROP W 'PROCESS))        then (PRINTOUT PROMPTWINDOW T "RESTARING BICLOCK PROCESS")             (WINDOWPROP W 'PROCESS (ADD.PROCESS [LIST (FUNCTION BICLOCKPROCESS)                                                       (KWOTE W)                                                       (KWOTE (WINDOWPROP W 'PARMS]                                           'RESTARTABLE                                           'HARDRESET]    (if (KEYDOWNP 'LSHIFT)        then (BKSYSBUF (DATE))             (UNTILMOUSESTATE (NOT (OR LEFT MIDDLE)))      else      (with BICLOCKPARMS (WINDOWPROP W 'PARMS)            (if (MOUSESTATE LEFT)                then (if ALARMTIME                         then (PROMPTPRINT (DATE)                                     "   ALARM AT "                                     (GDATE ALARMTIME))                       else (PROMPTPRINT (DATE)                                   "    NO ALARM SET"))              elseif (MOUSESTATE MIDDLE)                then (LET [(SEL (MENU (create MENU                                             ITEMS _ `(("Seconds On" 'SON)                                                       ("Seconds Off" 'SOFF)                                                       ("White" 'WHITE)                                                       ("Black" 'BLACK)                                                       ["Markers" 'MINSEC                                                             "Use Submenu to Change number of Markers"                                                              (SUBITEMS ("No markers" 'NOMARKER)                                                                     ("3/6/9/12 Markers" '3HOURMARKS)                                                                     ("Only hours" 'HOURMARKS)                                                                     ("Hours and minutes"                                                                      'MINHOURMARKS]                                                       ["Digits" 'HOUR                                                              "Use Submenu to Change number of Digits"                                                              (SUBITEMS ("No Digits" 'NODIG)                                                                     ("3/6/9/12 Hours" '3HOUR)                                                                     ("All Hours" 'HOUR)                                                                     ("Arabic digits" 'ARABIC)                                                                     ("Roman digits" 'ROMAN]                                                       ["Chime" 'CHIME                                                               "Use Submenu to Change Chime intervall"                                                              (SUBITEMS ("No chime" 'NOCHIME)                                                                     ("Hours" 'CHIME)                                                                     ("Hours and quorters"                                                                      'CHIME15MIN]                                                       ("Set Alarm" 'ALARM)                                                       ("Alarm Off" 'AOFF]                          (SELECTQ SEL                              (SON (SETQ SECONDSMODE T))                              (SOFF (SETQ SECONDSMODE NIL))                              (WHITE (SETQ COLORMODE 'WHITE))                              (BLACK (SETQ COLORMODE 'BLACK))                              (NOMARKER (SETQ MARKMODE NIL))                              (3HOURMARKS (SETQ MARKMODE 15))                              (HOURMARKS (SETQ MARKMODE 5))                              (MINHOURMARKS (SETQ MARKMODE 1))                              (NODIG (SETQ DIGMODE NIL))                              (3HOUR (SETQ DIGMODE 3))                              (HOUR (SETQ DIGMODE 1))                              (ARABIC (SETQ ROMANDIGS NIL))                              (ROMAN (SETQ ROMANDIGS T))                              (NOCHIME (SETQ CHIMEMODE NIL))                              (CHIME (SETQ CHIMEMODE 60))                              (CHIME15MIN (SETQ CHIMEMODE 15))                              (ALARM (BICLOCKSETALARM W))                              (AOFF (SETQ ALARMTIME NIL))                              NIL)                          (if (MEMB SEL '(NOMARKER 3HOURMARKS HOURMARKS MINHOURMARKS NODIG 3HOUR HOUR                                                 ARABIC ROMAN))                              then (RESTART.PROCESS (WINDOWPROP W 'PROCESS))                            else (WAKE.PROCESS (WINDOWPROP W 'PROCESS])(BICLOCKCFN  [LAMBDA (W)    (DEL.PROCESS (WINDOWPROP W 'PROCESS])(BICLOCKFINDFONT  [LAMBDA (SIZE MODERNCLASSIC)                               (* BKN "16-Aug-87 17:57")    (LET [(ALLFONTS (FONTSAVAILABLE '* '* 'MRR 0 'DISPLAY]         [SORT ALLFONTS (FUNCTION (LAMBDA (F1 F2)                                    (AND [NOT (MEMB (CAR F1)                                                    '(LOGO]                                         (OR [AND MODERNCLASSIC (MEMB (CAR F1)                                                                      '(MODERN CLASSIC))                                                  (NOT (MEMB (CAR F2)                                                             '(MODERN CLASSIC]                                             (GREATERP (CADR F1)                                                    (CADR F2))                                             (AND (EQP (CADR F1)                                                       (CADR F2))                                                  (for FAM                                                     in '(MODERN CLASSIC GACHA HELVETICA HELVETICAD                                                                 TERMINAL)                                                     do (if (EQ FAM (CAR F1))                                                            then (RETURN T)                                                          elseif (EQ FAM (CAR F2))                                                            then (RETURN NIL]         (find FONT in ALLFONTS suchthat (LEQ (CADR FONT)                                              SIZE])(BICLOCKNRFN  [LAMBDA (FP MP)                                            (* BN "17-Sep-84 10:40")    (COND       [MP (with POSITION MP (PROG [(DX (IDIFFERENCE XCOORD (fetch (POSITION XCOORD) of FP)))                                    (DY (IDIFFERENCE YCOORD (fetch (POSITION YCOORD) of FP]                                   [COND                                      [(IGREATERP (IABS DX)                                              (IABS DY))                                       (SETQ YCOORD (IPLUS (fetch (POSITION YCOORD) of FP)                                                           (ITIMES DX (COND                                                                         ((MINUSP (ITIMES DX DY))                                                                          -1)                                                                         (T 1]                                      (T (SETQ XCOORD (IPLUS (fetch (POSITION XCOORD) of FP)                                                             (ITIMES DY (COND                                                                           ((MINUSP (ITIMES DX DY))                                                                            -1)                                                                           (T 1]                                   (RETURN MP]       (T FP])(BICLOCKPROCESS  [LAMBDA (W PARMS)                                          (* BKN "16-Aug-87 17:39")    (CENTERPRINTINREGION "Wait" NIL W)    (with     BICLOCKPARMS PARMS     (PROG [(WIDTH (WINDOWPROP W 'WIDTH))            (HEIGHT (WINDOWPROP W 'HEIGHT]           (while T              bind S (BM _ (BITMAPCREATE WIDTH HEIGHT))                   (BG _ (BITMAPCREATE WIDTH HEIGHT))                   (BM1 _ (BITMAPCREATE WIDTH HEIGHT))                   (SHADOW _ (BITMAPCREATE WIDTH HEIGHT))                   (XC _ (IQUOTIENT WIDTH 2))                   (YC _ (IQUOTIENT HEIGHT 2))                   (SX _ (ARRAY 60 'FIXP 0 0))                   (SY _ (ARRAY 60 'FIXP 0 0))                   MX MY HX HY MP HP R MARKUR MARKLR MARK1LR DOTR SECR MINR HOURR CIRCW MARKW MARK1W                    SECW MINW HOURW DIGW DIGFONT NOW SECS (SLOWMODE _ T)                   (SMODE _ T)                   (MEAN _ 50)                   (LIMIT _ 1000)                   CL0 REF NOSEC INVERTFLG LASTCHIME (CHIMECOUNT _ 0)              first                                          (* First set up some relations)              (BLOCK)              (SETQ R (IDIFFERENCE (IMIN XC YC)                             4))              (SETQ MARKUR (FTIMES R 1.0))              (SETQ MARKLR (FTIMES R 0.9))              (SETQ MARK1LR (FTIMES R 0.98))              (SETQ DOTR (FTIMES R 0.05))              (SETQ SECR (FTIMES R 1.0))              (SETQ MINR (FTIMES R 0.9))              (BLOCK)              (SETQ HOURR (FTIMES R 0.6))              (SETQ CIRCW (FTIMES R 0.03))              (SETQ MARKW (FTIMES R 0.0375))              (SETQ MARK1W (FTIMES R 0.009))              (SETQ SECW (IMAX 1 (FTIMES R 0.01)))              (SETQ MINW (IMAX 2 (FTIMES R 0.037)))              (SETQ HOURW (IMAX 3 (FTIMES R 0.07)))              (SETQ DIGW (FTIMES R (if (NUMBERP MARKMODE)                                       then 0.75                                     else 0.9)))              (SETQ S (DSPCREATE BM))              (DSPXOFFSET XC S)              (DSPYOFFSET YC S)              (DSPOPERATION 'PAINT S)                        (* Generate signature)              (SETQ DIGFONT (BICLOCKFINDFONT (TIMES R 0.15)))              (DSPFONT DIGFONT S)              (if DIGFONT                  then (CENTERPRINTINREGION "BN" (CREATEREGION (MINUS XC)                                                        (MINUS (QUOTIENT (TIMES YC 4)                                                                      5))                                                        WIDTH                                                        (QUOTIENT (TIMES YC 4)                                                               5))                              S))                            (* Generate background Hour Marks)              (SETQ DIGFONT (BICLOCKFINDFONT (TIMES R (if (NUMBERP MARKMODE)                                                          then 0.2                                                        else 0.25))                                   ROMANDIGS))              (DSPFONT DIGFONT S)              (for H from 1 to 12 as V from 60 by -30 bind SYM                 do (BLOCK)                    (SETQ HX (COS V))                    (SETQ HY (SIN V))                    (if (AND (NUMBERP MARKMODE)                             (ZEROP (IMOD (TIMES H 5)                                          MARKMODE)))                        then (DRAWLINE (FTIMES HX MARKUR)                                    (FTIMES HY MARKUR)                                    (FTIMES HX MARKLR)                                    (FTIMES HY MARKLR)                                    MARKW                                    'REPLACE S))                    (if (AND DIGFONT (NUMBERP DIGMODE)                             (ZEROP (IMOD H DIGMODE)))                        then (SETQ SYM                              (if ROMANDIGS                                  then (CAR (NTH '(ÿïÁÿ  ÿïÂÿ  ÿïÃÿ  ÿïÄÿ  ÿïÅÿ  ÿïÆÿ  ÿïÇÿ  ÿïÈÿ  ÿïÉÿ  ÿïÊÿ  ÿïÊÁÿ  ÿïÊÂÿ ) H))                                else H))                             (MOVETO (DIFFERENCE (FTIMES HX DIGW)                                            (QUOTIENT (STRINGWIDTH SYM S)                                                   2))                                    (DIFFERENCE (FTIMES HY DIGW)                                           (if ROMANDIGS                                               then (DIFFERENCE (QUOTIENT (FONTPROP S 'HEIGHT)                                                                       2)                                                           (FONTPROP S 'DESCENT))                                             else (QUOTIENT (FONTPROP S 'ASCENT)                                                         2)))                                    S)                             (PRIN1 SYM S)))                 (* Generate background Second Marks)              (for I from 0 to 59 as V from 90 by -6                 do (BLOCK)                    (SETA SX I (FIX (FTIMES (SETQ MX (COS V))                                           SECR)))                    (SETA SY I (FIX (FTIMES (SETQ MY (SIN V))                                           SECR)))                    (if (AND (NUMBERP MARKMODE)                             (ZEROP (IMOD I MARKMODE)))                        then (DRAWLINE (FTIMES MX SECR)                                    (FTIMES MY SECR)                                    (FTIMES MX MARK1LR)                                    (FTIMES MY MARK1LR)                                    MARK1W                                    'REPLACE S)))              (BLOCK)              (FILLCIRCLE 0 0 DOTR BLACKSHADE S)                     (* Let this be the Background to be used in the loop)              (BITBLT BM NIL NIL BG)                     (* Determine a reference point for millisecond clock, that is half a second           ahead...)              (while (IEQP (DAYTIME)                           T1) bind (T1 _ (DAYTIME)) do (BLOCK) finally (SETQ REF (IPLUS (CLOCK                                                                                          0)                                                                                         500)))              do              (BITBLT BG NIL NIL BM)                         (* Compute Number of seconds since                                                              midnigth)              (SETQ NOW (DAYTIME))              (SETQ SECS (with UPTIMEREC (\UNPACKDATE (if ADJUSTALARM                                                          then ALARMTIME                                                        else NOW))                               (IPLUS (ITIMES HOUR 3600)                                      (ITIMES MINUTE 60)                                      SECOND)))              (if SLOWMODE                  then (BLOCK))                              (* Draw Hour Arm)              (COND                 ((EQP HP (IQUOTIENT SECS 120))                  (DRAWLINE 0 0 HX HY HOURW 'REPLACE S))                 (T (DRAWLINE 0 0 (SETQ HX (FIX (FTIMES (SIN (SETQ HP (IQUOTIENT SECS 120)))                                                       HOURR)))                           (SETQ HY (FIX (FTIMES (COS HP)                                                HOURR)))                           HOURW                           'REPLACE S)))              (if SLOWMODE                  then (BLOCK))                              (* Draw Minute Arm)              (COND                 ((EQP MP (IQUOTIENT SECS 10))                  (DRAWLINE 0 0 MX MY MINW 'REPLACE S))                 (T (DRAWLINE 0 0 (SETQ MX (FIX (FTIMES (SIN (SETQ MP (IQUOTIENT SECS 10)))                                                       MINR)))                           (SETQ MY (FIX (FTIMES (COS MP)                                                MINR)))                           MINW                           'REPLACE S)))              (if SLOWMODE                  then (BLOCK))                              (* Draw Seconds Arm)              (COND                 ((NOT NOSEC)                  (DRAWLINE 0 0 (ELT SX (IMOD SECS 60))                         (ELT SY (IMOD SECS 60))                         SECW                         'REPLACE S)))                       (* Now, Generate The Shadow)              (if SLOWMODE                  then (BLOCK))              (BITBLT BM NIL NIL SHADOW)              [for DX from -1 to 1                 do (for DY from -1 to 1 do (if SLOWMODE                                                then (BLOCK))                                            (BITBLT SHADOW NIL NIL SHADOW DX DY NIL NIL 'INPUT                                                   'PAINT)                       when (NOT (ZEROP (IPLUS (IABS DX)                                               (IABS DY]              (if SLOWMODE                  then (BLOCK))                              (* Find the Real background)              (TOTOPW W)              (BITBLT (WINDOWPROP W 'IMAGECOVERED)                     NIL NIL BM1)              (BITBLT SHADOW NIL NIL BM1 NIL NIL NIL NIL 'INPUT (SELECTQ COLORMODE                                                                    (WHITE 'PAINT)                                                                    (BLACK 'ERASE)                                                                    NIL))              (if SLOWMODE                  then (BLOCK))              (BITBLT BM NIL NIL BM1 NIL NIL NIL NIL 'INPUT (SELECTQ COLORMODE                                                                (WHITE 'ERASE)                                                                (BLACK 'PAINT)                                                                NIL))                                                              (* Now, at last, Output it)              (BITBLT BM1 NIL NIL W NIL NIL NIL NIL (if INVERTFLG                                                        then 'INVERT                                                      else 'INPUT)                     'REPLACE)              [if SLOWMODE                  then                  (if [AND CHIMEMODE (OR (NULL LASTCHIME)                                         (NOT (IEQP (IQUOTIENT LASTCHIME (ITIMES CHIMEMODE 60))                                                    (IQUOTIENT SECS (ITIMES CHIMEMODE 60]                      then (if LASTCHIME                               then (SETQ CHIMECOUNT                                     (if (IEQP (IMOD (IQUOTIENT SECS 60)                                                     60)                                               0)                                         then (IPLUS (IMOD (IDIFFERENCE (IQUOTIENT SECS                                                                               (ITIMES 60 60))                                                                  1)                                                           12)                                                     1)                                       else 1)))                           (SETQ LASTCHIME SECS))                  (if (IGREATERP CHIMECOUNT 0)                      then (add CHIMECOUNT -1)                           (BEEPON 440)                           (BLOCK 25)                           (BEEPON 220)                           (BLOCK 25)                           (BEEPOFF))                  (for N from 1 to (COND                                      (SMODE 10)                                      (T 1)) bind (DEL _ (COND                                                            ((OR SMODE (AND ALARMTIME                                                                            (ILEQ ALARMTIME NOW))                                                                 (IGREATERP CHIMECOUNT 0))                                                             1000)                                                            (T 60000)))                     until (OR ADJUSTALARM (AND ALARMTIME (ILEQ ALARMTIME NOW)))                     repeatwhile (AND NOSEC (IGREATERP MEAN LIMIT))                     do (BLOCK (IDIFFERENCE DEL (IMOD (IDIFFERENCE (CLOCK 0)                                                             REF)                                                      DEL)))                        (SETQ CL0 (CLOCK 0))                        (BLOCK)                        (SETQ MEAN (IQUOTIENT (IPLUS (ITIMES MEAN 8)                                                     (ITIMES (IMIN (IDIFFERENCE (CLOCK 0)                                                                          CL0)                                                                   500)                                                            2))                                          10]              (SETQ SLOWMODE (NOT ADJUSTALARM))              (SETQ SMODE SECONDSMODE)              (SETQ NOSEC (AND (OR (NOT SMODE)                                   (IGREATERP MEAN LIMIT))                               (NOT ADJUSTALARM)))              (SETQ INVERTFLG (if (AND ALARMTIME (ILEQ ALARMTIME NOW))                                  then (BEEPON (if INVERTFLG                                                   then 440                                                 else 880))                                       (BLOCK 50)                                       (BEEPOFF)                                       (NOT INVERTFLG)                                elseif ADJUSTALARM                                  then (AWAIT.EVENT ADJUSTEVENT)                                       NIL))              (SETQ LIMIT (IMIN (IPLUS (IMIN LIMIT (IQUOTIENT (ITIMES MEAN 10)                                                          9))                                       1)                                50])(BICLOCKRPFN  [LAMBDA (W)    (WAKE.PROCESS (WINDOWPROP W 'PROCESS])(BICLOCKRSFN  [LAMBDA (W)    (RESTART.PROCESS (WINDOWPROP W 'PROCESS])(BICLOCKSETALARM  [LAMBDA (W)                                                (* BKN "11-Dec-85 14:57")    (LET     [(M       (OR        (WINDOWPROP W 'ADJUSTMENUW)        (MENUWINDOW         (create MENU                ITEMS _                `(("<Hr>")                  ("<Min>")                  ("<Sec>")                  %,@                  [for I1 in '(24 12 3 1 -1 -3 -12 -24) as I2                     in '(30 15 5 1 -1 -5 -15 -30)                     join (for QQQ in '(T NIL NIL) as SCALE                             in (CONSTANT (LIST (TIMES 60 60)                                                60 1)) as HELP in '(                                                      "Will Increment/Decrement Hours by that Amount"                                                                                                                        "Will Increment/Decrement Minutes by that Amount"                                                     "Will Increment/Decrement Seconds by that Amount"                                                                    )                             collect (LET ((I (if QQQ                                                  then I1                                                else I2)))                                          (LIST I (LIST (FUNCTION BICLOCKSETALARM1)                                                        (KWOTE W)                                                        (KWOTE (TIMES I SCALE)))                                                HELP]                  ("OK!" (BICLOCKSETALARM2 %, (KWOTE W))                         "Will Exit Adjust Mode")                  ("_0" (BICLOCKSETALARM1 %, (KWOTE W)                               %,                               (CONSTANT (TIMES 60 60))                               T)                        "Will Reset Alarm Time to Hr:00:00")                  ("_0" (BICLOCKSETALARM1 %, (KWOTE W)                               60 T)                        "Will Reset Alarm Time to Hr:Min:00"))                TITLE _ "Adjust Alarm"                CENTERFLG _ T                MENUCOLUMNS _ 3]     (WINDOWPROP W 'ADJUSTMENUW M)     (ATTACHWINDOW M W 'BOTTOM 'JUSTIFY)     (with BICLOCKPARMS (WINDOWPROP W 'PARMS)           (SETQ ALARMTIME (OR ALARMTIME (PLUS (DAYTIME)                                               60)))           (SETQ ADJUSTALARM T)           (NOTIFY.EVENT ADJUSTEVENT)           (PROMPTPRINT (GDATE ALARMTIME])(BICLOCKSETALARM1  [LAMBDA (W DSEC MODULOFLG)                                 (* BKN "11-Dec-85 14:56")    (with BICLOCKPARMS (WINDOWPROP W 'PARMS)          [LET [(OLDTIME (OR ALARMTIME (PLUS (DAYTIME)                                             60]               (SETQ ALARMTIME (if MODULOFLG                                   then (DIFFERENCE OLDTIME (IMOD (with UPTIMEREC (\UNPACKDATE                                                                                          ALARMTIME)                                                                        (IPLUS (ITIMES HOUR 3600)                                                                               (ITIMES MINUTE 60)                                                                               SECOND))                                                                  DSEC))                                 else (IPLUS OLDTIME DSEC]          (NOTIFY.EVENT ADJUSTEVENT)          (PROMPTPRINT (GDATE ALARMTIME])(BICLOCKSETALARM2  [LAMBDA (W)                                                (* BKN "12-Nov-85 19:34")    (with BICLOCKPARMS (WINDOWPROP W 'PARMS)          (SETQ ADJUSTALARM NIL)          (NOTIFY.EVENT ADJUSTEVENT)          (DETACHWINDOW (WINDOWPROP W 'ADJUSTMENUW))          (CLOSEW (WINDOWPROP W 'ADJUSTMENUW])(IDLE.BICLOCK  [LAMBDA (W)                                                (* BKN "17-Jun-86 14:22")    (RESETLST (LET ((BW (BICLOCK BICLOCKIDLEPROPS)))                   (RESETSAVE NIL (LIST (FUNCTION CLOSEW)                                        BW))                   (while T do (BLOCK 5000)                               (if (NEQ (\GETBASEPTR BW 2)                                        W)                                   then (TOTOPW W))                               (MOVEW BW [RAND 0 (DIFFERENCE SCREENWIDTH (WINDOWPROP BW 'WIDTH]                                      (RAND 0 (DIFFERENCE SCREENHEIGHT (WINDOWPROP BW 'HEIGHT]))(DECLARE%: EVAL@COMPILE(DATATYPE BICLOCKPARMS (SECONDSMODE COLORMODE MARKMODE DIGMODE CHIMEMODE ROMANDIGS ALARMTIME                               ADJUSTALARM ADJUSTEVENT))(RECORD UPTIMEREC (YEAR MONTH DAY HOUR MINUTE SECOND QQQ)))(/DECLAREDATATYPE 'BICLOCKPARMS '(POINTER POINTER POINTER POINTER POINTER POINTER POINTER POINTER                                         POINTER) '((BICLOCKPARMS 0 POINTER)                                                   (BICLOCKPARMS 2 POINTER)                                                   (BICLOCKPARMS 4 POINTER)                                                   (BICLOCKPARMS 6 POINTER)                                                   (BICLOCKPARMS 8 POINTER)                                                   (BICLOCKPARMS 10 POINTER)                                                   (BICLOCKPARMS 12 POINTER)                                                   (BICLOCKPARMS 14 POINTER)                                                   (BICLOCKPARMS 16 POINTER)) '18)(DECLARE%: DOEVAL@COMPILE DONTCOPY(GLOBALVARS BICLOCKDEFAULTPROPS BICLOCKUSERPROPS BICLOCKINITIALPROPS BICLOCKIDLEPROPS))(RPAQQ BICLOCKDEFAULTPROPS        (SECONDS T COLOR WHITE MARKS NIL DIGITS HOUR CHIME NIL ALARM NIL SIZE 119 HORIZONTAL RIGHT               VERTICAL TOP CREATE T))(RPAQ? BICLOCKUSERPROPS )(RPAQ? BICLOCKINITIALPROPS )(RPAQ? BICLOCKIDLEPROPS '(HORIZONTAL CENTER VERTICAL CENTER))(RPAQ BICLOCKWINDOW (BICLOCK BICLOCKINITIALPROPS))(ADDTOVAR IDLE.FUNCTIONS (Biclock 'IDLE.BICLOCK))(ADDTOVAR IDLE.SUSPEND.PROCESS.NAMES BICLOCKPROCESS)(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA )(ADDTOVAR NLAML )(ADDTOVAR LAMA BICLOCK))(PUTPROPS BICLOCK COPYRIGHT ("Bernt Nilsson @ University of Linkoeping" 1984 1985 1986 1987))(DECLARE%: DONTCOPY  (FILEMAP (NIL (1494 33672 (BICLOCK 1504 . 6348) (BICLOCKBEFN 6350 . 11303) (BICLOCKCFN 11305 . 11376) (BICLOCKFINDFONT 11378 . 12999) (BICLOCKNRFN 13001 . 14417) (BICLOCKPROCESS 14419 . 28889) (BICLOCKRPFN 28891 . 28964) (BICLOCKRSFN 28966 . 29042) (BICLOCKSETALARM 29044 . 31630) (BICLOCKSETALARM1 31632 . 32653) (BICLOCKSETALARM2 32655 . 32990) (IDLE.BICLOCK 32992 . 33670)))))STOP