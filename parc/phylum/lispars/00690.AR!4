Number: 690Date: 13-Apr-84 12':41':23Submitter: Sannella.PASource: SHULMAN@RUTGERS.ARPASubject: DIR performance to Tops20 Ftp serverAssigned To: Attn: vanMelle, PYoungStatus: OpenIn/By: Problem Type: PerformanceImpact: ModerateDifficulty: Frequency: EverytimePriority: PerhapsSystem: CommunicationsSubsystem: PUP ProtocolsMachine: Disk: Lisp Version: Source Files: Microcode Version: Memory Size: File Server: Server Software Version: Disposition: [attn''d vanMelle, bumped priority, guessed at Difficulty, added to Subject]'[4/28/84 bvm': Changed subject; see AR#805 for first problem]Description: '[lmm': this looks like its a problem in the DIR code]''Received': from RUTGERS.ARPA by PARC-MAXC.ARPA; 12 APR 84 06':31':03 PST'Date': 12 Apr 84 09':30':53 EST'From': Jeffrey Shulman <SHULMAN@RUTGERS.ARPA>'Subject': DEVICE filed in file names'To': lispsupport.pa'cc': SHULMAN@RUTGERS.ARPA''. . .''	On a related issue':  Remote directory listings seem to take'forever.  Looking at the network traffic shows about 20 packets going'back and forth just to do a single file.  If you can send me code that'does that I will also fix that (if it *is* fixable.)'''Thanks.''							Jeff'-------''Sender': sannella.pa'Date': 12 Apr 84 13':47':57 PST (Thursday)'Subject': Re': DEVICE filed in file names'In-reply-to': SHULMAN''s message of 12 Apr 84 09':30':53 EST'To': Jeffrey Shulman <SHULMAN@RUTGERS.ARPA>'cc': lispsupport'from': LispSupport'. . .'''Likewise': "Remote directory listings seem to take forever." One of the interesting questions is whether the latency between packets is in Interlisp-D or on the 20. Can you turn on FTPDEBUGFLG and do a directory of a single file and report the printout? Does it correspond to what you believe should be the protocol reading the FTP spec? (You do have a copy of the FTP protocol specification, don''t you?)'''Thanks much,''Larry Masinter'(with Michael Sannella)''-----''Received': from RUTGERS.ARPA by PARC-MAXC.ARPA; 12 APR 84 14':54':02 PST'Date': 12 Apr 84 17':53':47 EST'From': Jeffrey Shulman <SHULMAN@RUTGERS.ARPA>'Subject': Re': DEVICE filed in file names'To': LispSupport.pa'In-Reply-To': Message from "LispSupport.pa@Xerox.ARPA" of 12 Apr 84 16':47':57 EST'''Here is an annoted dribble session for Interlisp-D (Fugue.6)':'NIL'21_(SETQ FTPDEBUGFLG T]'(FTPDEBUGFLG reset)'T'22_DIR LOGIN.CMD'[10]((DIRECTORY SHULMAN) (NAME-BODY "LOGIN.CMD") (USER-NAME SHULMAN) ('USER-PASSWORD "d") (DESIRED-PROPERTY DIRECTORY) (DESIRED-PROPERTY 'NAME-BODY) (DESIRED-PROPERTY VERSION))[6]'[11]'[11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11]['11][11][11][11]''   {RUTGERS}<SHULMAN>'LOGIN.CMD;1 [11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11]['11][11][11][11][6]'NIL''It seems to be doing a complete directory.  Is this a bug on our side?''23_CONN {RED}T':<DESIGN>'{RUTGERS}T':<DESIGN>'24_INFILEP(INIT.LISP]'{RUTGERS}T':<DESIGN>INIT.LISP;1'25_DIR *.*'[10]((NAME-BODY NIL) (VERSION 0) (USER-NAME SHULMAN) (USER-PASSWORD "d") (DESIRED-PROPERTY DIRECTORY) (DESIRED-PROPERTY NAME-BODY) ('DESIRED-PROPERTY VERSION))[6]'[11]'[11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11]['11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11][11'][11][11][11][11][6]'NIL''It does not find anything.  We do have a PS':<DESIGN> also.''26_COPYFILE({DSK}FOO.BAR FOO.BAR]'[9]((END-OF-LINE-CONVENTION CR) (CREATION-DATE "12-Apr-84 17':37':29") (SIZE 287') (TYPE TEXT) (USER-NAME SHULMAN) (USER-PASSWORD "d") (DIRECTORY 'DESIGN) (NAME-BODY FOO.BAR))[6]'[11][6]'[5][3]{0}[6]'[3]{0}[6]'{RUTGERS}<DESIGN>FOO.BAR;1''As you can see it did not go to T':<DESIGN> but PS':<DESIGN>.''27_INFILEP(FOO.BAR]'NIL'''Now in Interlisp-10':''@nlisp'INTERLISP-10  26-SEP-83 ...'''TTYIN (not found on T NIL T':<NLISP> T':<LISP.USERS> <HELPSYS>)'''Hello, Jeff.'2_EXEC'' TOPS-20 Command processor 5.1(244700)'@V T':<NLISP>TTYIN''   T':<Nlisp>' Ttyin.Com.1;P777752       27 66948(7)    9-Sep-82 19':06':38 Hedrick   '@PO'131075'4-LOGOUT)''With Interlisp-10 when we DEFINE DSK': as DSK':, T': it does work.''Hope this helps.  This is a high priority problem on our end since'our other DEC-20''s *only* have non-PS device names.''							Jeff'-------''Date': 28 Apr 84 16':53 PST'From': vanMelle.pa'Subject': Re':  AR#690': DEVICE field in DIR'To': Shulman@Rutgers'cc': vanMelle.pa, LispSupport, Masinter''. . .''Meanwhile, another question you asked was about DIR taking so long.  There are two likely things to make DIR slow, and they are both shortcomings that I have seen in at least one Tops20 FTPSERVER (at Sumex)':''(1) The server enumerates the whole directory when Lisp only asked for some subpart;''(2) The server ignores the DESIRED-PROPERTY attribute in the requested property list, and sends back "all" properties for each file, instead of just the requested information.''Of the two, (1) is clearly the more serious, and is simply a bug.  In fact, in some future version of Lisp, if the server still has the bug, you will see everything your server returns, not just the files matching the pattern (which Lisp currently methodically filters).  (2) is not a bug, but a missed opportunity for better performance.''Workaround: Test Case: Edit-By: MasinterEdit-Date:  9-May-84 18':07':02