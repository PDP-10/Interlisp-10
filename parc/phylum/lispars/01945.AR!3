Number: 1945Date: 23-Aug-84 19':07':41Submitter: halvorsenSource: halvorsenSubject: Break under  SCROLLBYREPAINTFN under LAB.EXPOSEMESSAGEAssigned To: Attn: ReleaseStatus: FixedIn/By: Problem Type: BugImpact: AnnoyingDifficulty: EasyFrequency: OncePriority: PerhapsSystem: Windows and GraphicsSubsystem: Window SystemMachine: 1108Disk: Lisp Version:  9-Aug-84 18':38':02Source Files: Microcode Version: 5124Memory Size: 3071File Server: Server Software Version: Disposition: '["vanMelle" "25-Aug-84 20':58':53" Attn': System':(Text->Windows% and% Graphics) Subsystem':(Lafite->Window% System) Description':]'["Burton.pa" "27-Aug-84 18':16':44" Attn': Status':(Open->Fixed) Difficulty':(->Easy) Description':]Description: I moved my browser part way off the window so that only the menu and title bar showed.  When I did a getmail (which resulted in 1 msg being retrieved)  I ended up in a break "NIL- Non numeric arg, FLOAT broken).  The stack looked like this':''NIL'60':BT!'PLUS'SCROLLBYREPAINTFN'LAB.EXPOSEMESSAGE'\LAFITE.GETNEWMAIL'ERRORSET'\LAFITE.GETMAIL.PROC'\EVALFORM'ERRORSET'\MAKE.PROCESS0'T''61':BTV'PLUS'   WINDOW {WINDOW}#7,125702'   XDELTA 0'   YDELTA 23'   CONTINUOUSFLG NIL'   DSP {STREAM}#7,62150'   EXTENT (0 -587 525 612)'   X NIL'   CRHEIGHT NIL'   CRWIDTH NIL'   CRLEFT NIL'   CRBOTTOM NIL'   WHOLEHEIGHT 25'   WHOLEWIDTH 525'SCROLLBYREPAINTFN'   MAILFOLDER {MAILFOLDER}#4,174700'   MSGDESCRIPTOR {LAFITEMSG}#7,22340'   WINDOW {WINDOW}#7,125702'   YPOS -587'   CLIPREGION (0 -576 525 25)'LAB.EXPOSEMESSAGE'   MAILFOLDER {MAILFOLDER}#4,174700'   WINDOW {WINDOW}#7,125702'   REPORTWINDOW {WINDOW}#7,77000'   OUTSTREAM {STREAM}#7,141150'   FIRSTMESSAGE {LAFITEMSG}#7,22340'\LAFITE.GETNEWMAIL'ERRORSET'   WINDOW {WINDOW}#7,125702'   MAILFOLDER {MAILFOLDER}#4,174700'   ITEM ("Get Mail" (QUOTE \LAFITE.GETMAIL) '"Retrieves new messages and puts them into this mail folder.")'   MENU {MENU}#6,152572'   LISPXHIST NIL'   RESETY NIL'   RESETZ NIL'\LAFITE.GETMAIL.PROC'   *FORM* (\LAFITE.GETMAIL.PROC (QUOTE '{WINDOW}#7,125702) (QUOTE {MAILFOLDER}#4,174700) ('QUOTE &) (QUOTE {MENU}#6,152572))'   *ARGVAL* NIL'   *TAIL* NIL'   *FN* \LAFITE.GETMAIL.PROC'\EVALFORM'ERRORSET'   \INTERRUPTABLE T'   #MYHANDLE# {PROCESS}#10,136400'   #FORM# (\LAFITE.GETMAIL.PROC (QUOTE '{WINDOW}#7,125702) (QUOTE {MAILFOLDER}#4,174700) ('QUOTE &) (QUOTE {MENU}#6,152572))'   HELPFLAG BREAK!'   \CURRENTDISPLAYLINE 7'   \#DISPLAYLINES 15'   \LINEBUF.OFD {STREAM}#7,62064'   \PRIMREADTABLE {READTABLEP}#1,102770'   \PRIMTERMTABLE {TERMTABLEP}#1,101740'   \PRIMTERMSA {CHARTABLE}#1,122600'   TtyDisplayStream {STREAM}#6,146320'   \TERM.OFD {STREAM}#6,146320'   \TTYWINDOW NIL'   \PRIMOUT.OFD {STREAM}#6,146320'   \PRIMIN.OFD {STREAM}#7,62064'\MAKE.PROCESS0'T'-------''Date': 25 Aug 84 20':54 PDT'From': vanMelle.pa'Subject': Re': AR#1945': Break under SCROLLBYREPAINTFN'To': Burton'cc': vanMelle.pa, Halvorsen''I''m passing this one off to you.  It seems to be repeatable, and it looks kosher from Lafite''s point of view.  The error seems to be coming from a (SETQ X (PLUS CRBOTTOM CRHEIGHT)) in SCROLLBYREPAINTFN, and both CRBOTTOM and CRHEIGHT are NIL.  In fact, so are CRWIDTH and CRLEFT, all of which are extracted from a call to INTERSECTREGIONS, which apparently returned NIL.'--------''Date': 27 Aug 84 18':15 PDT'From': Burton.pa'Subject': AR# 1945': break under SCROLLBYREPAINTFN'To': Halvorsen'cc': Burton.pa, Vanmelle.pa, LispSupport''Fixed.  Turned out that SCROLLBYREPAINTFN wasn''t checking for the situation where the entire window was off screen.''After fixing this, I discovered that the code in MOVEW that notices to redisplay the parts of a window that were off the screen wasn''t handling this case either so I fixed that too.''LispSupport': This later change should be documented in the release message since it means that windows moved from completely off the screen to back on the screen will get redisplayed.''Richard''''Workaround: Test Case: Edit-By: Burton.paEdit-Date: 27-Aug-84 18':16':46