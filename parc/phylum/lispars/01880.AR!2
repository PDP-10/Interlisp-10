Number: 1880Date: 16-Aug-84 15':49':37Submitter: Sannella.PASource: halvorsen.paSubject: Copyfile beraks in \PUTBASE.UFN under \FILEOUTCHARFN udner \COPYOPENFILELisp Version: Description: 'Date': 15 Aug 84 16':56 PDT'From': halvorsen.pa'Subject': Lisp': Copyfile beraks in \PUTBASE.UFN under \FILEOUTCHARFN udner \COPYOPENFILE'To': LispSupport.pa'cc': halvorsen.pa''Lisp System Date': 14-Aug-84 22':01':47'Machine': Dandelion (204#13#)'Microcode version': 24,4'Memory size': 5777'Frequency': Always'Impact': Serious''This repeatedly happens when I try copying {phylum}<halvorsen>papers>trkeep.converted to {marxc}</user/pk/>tr  The charcode it is trying to put is an innocent 105.''  Per-Kristian''-----''Date': 15 Aug 84 17':02 PDT'From': halvorsen.pa'Subject': Lisp': More on copyfile problem'To': LispSupport.pa'cc': halvorsen.pa''Lisp System Date': 14-Aug-84 22':01':47'Machine': Dandelion (204#13#)'Microcode version': 24,4'Memory size': 5777'Frequency': >> Always, Intermittent, Once <<'Impact': >> Fatal, Serious, Moderate, Annoying, Minor <<''I forgot to say that the error is an \ILLEGAL.ARG error,  the arg is 65536 which is the file ptr.''PK''-----''Date': 16 Aug 84 17':32 PDT'From': vanMelle.pa'Subject': Re': AR 1880': Copyfile beraks in \PUTBASE.UFN under \FILEOUTCHARFN udner \COPYOPENFILE'In-reply-to': LispSupport.pa''s message of 16 Aug 84 15':50':12 PDT (Thursday)'To': LispSupport.pa'cc': vanMelle.pa, Masinter, Halvorsen, Kaplan''The problem is that {phylum}<halvorsen>papers>trkeep.converted is of type TEXT, and the EOL convention of {marxc} is different from that of {phylum}.  Thus, COPYFILE does its slow case, converting the eol''s by doing repeated \OUTCHAR of BIN.  Unfortunately, it turns out there are no eols at all in this file, so the destination''s CHARPOSITION never gets reset to zero, and after the 65536''th byte, finally overflows 16 bits.''I fixed \FILEOUTCHARFN to not overflow the CHARPOSITION field, but rather wrap around (an unlikely case, but this certainly was a bug).  I was going to fix COPYFILE to call COPYCHARS instead of its little \OUTCHAR loop, but it turns out COPYCHARS has the same bug (of calling \OUTCHAR) when the source is not randaccessp.''	Bill 'Workaround: Test Case: Edit-By: Sannella.PAEdit-Date: 17-Aug-84  8':56':32Attn: Assigned To: In/By: Disposition: System: Operating SystemSubsystem: Generic File OperationsMachine: Disk: Microcode Version: Memory Size: File Server: Server Software Version: Difficulty: Frequency: EverytimeImpact: SeriousPriority: AbsolutelyStatus: FixedProblem Type: BugSource Files: 