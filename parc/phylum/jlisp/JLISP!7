(FILECREATED "22-SEP-83 11:17:35" {PHYLUM}<JLISP>JLISP.;7 21699        changes to:  (FNS JSTRINGWIDTH)      previous date: " 5-AUG-83 12:23:14" {PHYLUM}<JLISP>JLISP.;6)(* Copyright (c) 1982, 1983 by Xerox Corporation)(PRETTYCOMPRINT JLISPCOMS)(RPAQQ JLISPCOMS ((FNS .BUFBOUT. DUMMYPRESSFONT GETVCODE INCR JADDCHAR JCHDEL JDSPPRINTCHAR 		       JFILLBUFFER JGETKEY JMAKEPRESS JPEEKBACK JPEEKKEY JPRESSCHAR JSHOWKANJI 		       JSTRINGWIDTH WORDCHARP WORDSEPRP \CHARSETFONT JERASECHARS \READCUFONTFILE)	(DECLARE: (INITRECORDS DSTREAM)		  DONTCOPY		  (RECORDS DSTREAM BUFFER CHR)		  (MACROS \CHARSHIFTP \CHARBITS \CHARSET .CHARSHIFT.))	(COMS (GLOBALVARS SPECIALKEYS)	      (ADDVARS (SPECIALKEYS)))	(DECLARE: EVAL@COMPILE DONTCOPY (FILES (LOADCOMP)					       PRESS ATERM))	(COMS (GLOBALVARS JFNS)	      [DECLARE: FIRST (VARS JFNS)			(P (for X in JFNS do (MOVD? (CAR X)						    (CADR X]	      (FNS JIN))	(VARS (JPENDINGCHAR))	(VARS (\INFILLBUFFER))))(DEFINEQ(.BUFBOUT.  [LAMBDA (CH FLG)                 (* lmm "29-MAR-82 22:13")    (push CHARS (create CHR using (CAR CHARS)				  XPOS _(DSPXPOSITION NIL (TTYDISPLAYSTREAM))				  CODES _ CH STATE _ STATE))    (COND      ((NULL FLG)	(\CHECKCARET (TTYDISPLAYSTREAM))	(MAPC CH (FUNCTION \ECHOCHAR])(DUMMYPRESSFONT  [LAMBDA (FAMILY PSIZE)                                     (* lmm "24-MAR-82 09:52")                                                             (* CREATE DUMMY JAPANESE FONT)    (create FONTDESCRIPTOR using (FONTCREATE (QUOTE GACHA)					     PSIZE NIL NIL (QUOTE PRESS))				 FONTFAMILY _ FAMILY])(GETVCODE  [LAMBDA (C)                      (* lmm "23-MAR-82 22:08")    (\ECHOCHAR C)    (\ECHOCHAR (SETQ C (\GETKEY)))    (COND      ([OR (AND (IGEQ C (CHARCODE A))		(ILEQ C (CHARCODE Z)))	   (AND (IGEQ C (CHARCODE a))		(ILEQ C (CHARCODE z]	(LOGAND C 31))      (T C])(INCR  [LAMBDA (RSNX)                   (* lmm "23-MAR-82 22:08")                                   (* copy of incparencount)    (DECLARE (USEDFREE CHARS))    (COND      ((EQ RSNX STRINGDELIM.RC)	[replace (CHR INSTRINGP) of (CAR CHARS) with (NOT (fetch (CHR INSTRINGP) of (CAR CHARS]	NIL)      ((NOT (fetch (CHR INSTRINGP) of (CAR CHARS)))	(SELECTC RSNX		 (LEFTPAREN.RC (AND (ZEROP (fetch (CHR LBRKCOUNT) of (CAR CHARS)))				    (add (fetch (CHR LPARCOUNT) of (CAR CHARS))					 1))			       NIL)		 [RIGHTPAREN.RC    (* NOTE: RP's never match left-brackets, just like on 10)				(AND (ZEROP (fetch (CHR LBRKCOUNT) of (CAR CHARS)))				     (OR (ZEROP (fetch (CHR LPARCOUNT) of (CAR CHARS)))					 (ZEROP (add (fetch (CHR LPARCOUNT) of (CAR CHARS))						     -1]		 (LEFTBRACKET.RC (add (fetch (CHR LBRKCOUNT) of (CAR CHARS))				      1)				 NIL)		 [RIGHTBRACKET.RC (COND				    ((ZEROP (fetch (CHR LBRKCOUNT) of (CAR CHARS)))				      (replace (CHR LPARCOUNT) of (CAR CHARS) with 0))				    (T (AND (ZEROP (add (fetch (CHR LBRKCOUNT) of (CAR CHARS))							-1))					    (ZEROP (fetch (CHR LPARCOUNT) of (CAR CHARS]		 NIL])(JADDCHAR  [LAMBDA (CHAR FLG)               (* lmm "23-MAR-82 22:08")    (COND      ((ILESSP CHAR 128)	(.BUFBOUT. (LIST CHAR)))      (T (.BUFBOUT. (LIST (LOGOR 128 (LRSH CHAR 8))			  (LOGOR 128 (LOGAND CHAR 127])(JCHDEL  [LAMBDA (EMPTY)                                            (* lmm " 5-APR-82 15:09")    (while (AND (NULL (fetch (CHR CODES) of (CAR CHARS)))		(CDR CHARS))       do (pop CHARS))                                       (* GET RID OF ANY GARBAGE)    (PROG1 (COND	     ((CDR CHARS)                                    (* BACK UP DISPLAY, RETURN (CHR CODES))	       (DSPBACKUP (IDIFFERENCE (DSPXPOSITION NIL (TTYDISPLAYSTREAM))				       (fetch (CHR XPOS) of (CAR CHARS)))			  (TTYDISPLAYSTREAM))	       (fetch (CHR CODES) of (pop CHARS)))	     (EMPTY                                          (* NOTHING TO ERASE; POTENTIALLY RING BELL)		    (PRIN3 (FCHARACTER (CHARCODE BELL))			   T)		    NIL))	   (SETQ STATE (fetch (CHR STATE) of (CAR CHARS])(JDSPPRINTCHAR  [LAMBDA (STREAM CHARCODE)                                  (* lmm " 2-MAR-83 14:06")    (PROG ((DS (OUTPUTDSP STREAM)))          (RETURN (PROG ((FONT0 (fetch FONT0 of DS)))		        (RETURN (COND				  (FONT0 (BLTCHAR (\CHARBITS CHARCODE)						  DS)					 (DSPFONT FONT0 DS)					 (replace FONT0 of DS with NIL)					 1)				  ((\CHARSHIFTP CHARCODE)    (* An extended charset/character pair)				    (replace FONT0 of DS with (DSPFONT (\CHARSETFONT CHARCODE										     (DSPFONT NIL DS))								       DS))				    0)				  (T (NONJ\DSPPRINTCHAR STREAM CHARCODE])(JFILLBUFFER  [LAMBDA (FILLTYPE)                                         (* rmk: " 5-AUG-83 12:22")    (DECLARE (USEDFREE #CURRENTRDTBL# FLG \PRIMTERMTABLE \PRIMTERMSA \LINEBUF.OFD))    (\RESETLINE)    (PROG (C TCLASS RSNX (RTBLSA (AND (NEQ FILLTYPE READC.FT)				      (fetch READSA of #CURRENTRDTBL#)))	     (CONTROLTON (fetch CONTROLFLG of \PRIMTERMTABLE))	     [CHARS (LIST (create CHR				  CODES _ NIL				  LPARCOUNT _(fetch (LINEBUFFER LPARCOUNT) of \LINEBUF.OFD)				  LBRKCOUNT _(fetch (LINEBUFFER LBRKCOUNT) of \LINEBUF.OFD)				  INSTRINGP _(fetch (LINEBUFFER INSTRINGP) of \LINEBUF.OFD]	     TMP STATE BUFFERSTATE (\INFILLBUFFER T))          (DECLARE (SPECVARS . T))          [COND	    ((AND CONTROLTON (EQ FILLTYPE READC.FT))	      (SETQ C (JGETKEY))	      (\ECHOCHAR C)	      (\BOUT \LINEBUF.OFD C)	      (RETURN (\CLOSELINE]          (JRESETLINE)          (replace STATE of (CAR CHARS) with STATE)          (* TCLASS is terminal syntax class, RSNX is read-table 							     code)      NEXT(SETQ C (JGETKEY))          [SELECTC (fetch TERMCLASS of (\SYNCODE \PRIMTERMSA C))		   (CHARDELETE.TC (AND (JCHDEL T)				       (JSHOWSTATE)))		   [LINEDELETE.TC (COND				    ((JCHDEL T)				      (while (AND (SETQ C (JPEEKBACK))						  (OR (CDR C)						      (NEQ (\SYNCODE \PRIMTERMSA (CAR C))							   EOL.TC)))					 do (JCHDEL))				      (JSHOWSTATE]		   [WORDDELETE.TC (COND				    ((SETQ C (JCHDEL T))				      [while (AND (WORDSEPRP C)						  (SETQ C (JCHDEL]				      [COND					((WORDCHARP C)					  (while (AND (SETQ C (JPEEKBACK))						      (WORDCHARP C))					     do (JCHDEL]				      (JSHOWSTATE]		   (CTRLV.TC (.BUFBOUT. (LIST (GETVCODE C))					T))		   (EOL.TC (JADDCHAR C)			   (GO EXIT))		   (RETYPE.TC (\ECHOCHAR (CHARCODE EOL))			      (for X in (REVERSE CHARS)				 do (replace XPOS of X with (DSPXPOSITION NIL (TTYDISPLAYSTREAM)))				    (for Y in (fetch CODES of X) do (\ECHOCHAR Y)))			      (GO NEXT))		   (COND		     ((SETQ TMP (FASSOC C SPECIALKEYS))		       (EVAL (CADR TMP)))		     (T [COND			  ((AND (IGEQ C (CHARCODE a))				(ILEQ C (CHARCODE z)))			    (SETQ C (IDIFFERENCE C 32]			(COND			  (JMODEFLAG (JROMACHAR C))			  (T (JADDCHAR C)))			(AND (EQ FILLTYPE READC.FT)			     (GO NEXT))			(COND			  ((EQ ESCAPE.RC (SETQ RSNX (\SYNCODE RTBLSA C)))			    (COND			      ([EQ CTRLV.TC (fetch TERMCLASS of (\SYNCODE \PRIMTERMSA (SETQ C									    (JGETKEY]				(SETQ C (GETVCODE C)))			      (T (\ECHOCHAR C)))			    (NCONC1 (fetch CODES of (CAR CHARS))				    C)			    (GO NEXT)))			(SELECTC FILLTYPE				 [RATOM/RSTRING.FT (COND						     ((AND CONTROLTON (fetch STOPATOM of RSNX))						       (GO EXIT]				 [READ.FT (COND					    ([AND CONTROLTON (ZEROP (fetch (CHR LBRKCOUNT)								       of (CAR CHARS)))						  (ZEROP (fetch (CHR LPARCOUNT) of (CAR CHARS)))						  (fetch STOPATOM of RSNX)						  (SELECTC RSNX							   ((LIST LEFTPAREN.RC LEFTBRACKET.RC)							     NIL)							   (STRINGDELIM.RC (fetch (CHR INSTRINGP)									      of (CAR CHARS)))							   (NOT (fetch (CHR INSTRINGP)								   of (CAR CHARS]                                                             (* READ is reading an atom. Return when atom ends, but 							     also obey bracket/paren exception noted on page 14.33 of							     manual.)					      (GO EXIT)))					  (COND					    ((INCR RSNX)          (* Parens balance--throw the carriage if the closing paren or bracket character was not a CR, and if FLG argument 	  of READ is NIL. (We know we are under a READ call because of FILLTYPE))					      (AND (NEQ C (CHARCODE EOL))						   (NOT FLG)						   (\ECHOCHAR (CHARCODE EOL)))					      (GO EXIT))					    ((EQ IMMEDIATE.RMW (fetch WAKEUP of RSNX))                                                             (* Immediate read-macro)					      (GO EXIT]				 (SHOULDNT]          (GO NEXT)      EXIT(for X in (REVERSE CHARS) do (for C in (fetch CODES of X) do (\BOUT \LINEBUF.OFD C)))          (with CHR (CAR CHARS)		(replace (LINEBUFFER LPARCOUNT) of \LINEBUF.OFD with LPARCOUNT)		(replace (LINEBUFFER LBRKCOUNT) of \LINEBUF.OFD with LBRKCOUNT)		(replace (LINEBUFFER INSTRINGP) of \LINEBUF.OFD with INSTRINGP))          (\CLOSELINE])(JGETKEY  [LAMBDA NIL                                                (* lmm " 1-APR-82 14:47")    (COND      (JPENDINGCHAR (PROG1 JPENDINGCHAR (SETQ JPENDINGCHAR NIL)))      (T (\GETKEY])(JMAKEPRESS  [LAMBDA (FILE PFILE FONTS HEADING TABS)    (DECLARE (GLOBALVARS PRESSTABSTOPS))                     (* rmk: " 5-AUG-83 12:05")    (RESETLST      (PROG [REGION INSTRM IN MTABS (FA (FONTMAPARRAY FONTS (QUOTE PRESS]                                                             (* FA is an array of font-descriptors)	    [RESETSAVE [SETQ IN (OPENFILE FILE (QUOTE INPUT)					  (QUOTE OLD)					  8					  (QUOTE ((SEQUENTIAL T]		       (QUOTE (PROGN (CLOSEF? OLDVALUE]	    [SETQ REGION (PressOutFile (OR PFILE (PACKFILENAME (QUOTE EXTENSION)							       (QUOTE PRESS)							       (QUOTE BODY)							       IN))				       (NEQ HEADING T)				       (ELT FA 1)				       1				       (OR HEADING (CONCAT IN "     " (GETFILEINFO IN (QUOTE 										     CREATIONDATE]	    (SETQ INSTRM (\GETOFD IN (QUOTE INPUT)))	    (replace (STREAM ENDOFSTREAMOP) of INSTRM with (FUNCTION ZERO))                                                             (* Make \BIN return 0 on EOS)	    [bind C FC (CCNT _ 0)		  (MAXFONT _(ARRAYSIZE FA))	       do		(SETQ C (\BIN INSTRM))		(COND		  ((\CHARSHIFTP C)		    (SHOW.PRESS CCNT)		    (PressFont (PROG1 CPRESSFONT (\BOUT PRESSOUTSTRM (JPRESSCHAR (LOGAND C 127)										 (LOGAND										   (\BIN INSTRM)										   127)										 CPRESSFONT))				      (SHOW.PRESS 1)))		    (SETQ CCNT 0))		  ([AND (IGREATERP C (CONSTANT (APPLY (FUNCTION MAX)						      (CHARCODE (NULL ^F CR ^L TAB]		    (\BOUT PRESSOUTSTRM C)		    (add CCNT 1))		  (T (SELCHARQ C			       [^F                           (* Font shift)				   (SHOW.PRESS CCNT)				   (SETQ CCNT 0)				   (SELCHARQ (SETQ FC (\BIN INSTRM))					     [^T             (* tab to absolute pos.)						 (COND						   ((\EOFP INSTRM)						     (\BOUT PRESSOUTSTRM (CHARCODE ^F))						     (\BOUT PRESSOUTSTRM (CHARCODE ^T))						     (add CCNT 2))						   (T [OR MTABS (SETQ MTABS (for TAB									       in (OR TABS 										    PRESSTABSTOPS)									       collect (millsToMicas											 TAB]						      (SETQ FC (OR [CAR (NTH MTABS (SETQ FC									       (\BIN INSTRM]								   (ERROR 								  "Undefined absolute tab number"									  FC)))						      (SETX.PRESS (SETQ PRESSPOSITION FC]					     [NULL (\BOUT PRESSOUTSTRM (CHARCODE ^F))						   (COND						     ((\EOFP INSTRM)                                                             (* EOS after ^F)						       (SETQ CCNT 1))						     (T (\BOUT PRESSOUTSTRM FC)							(SETQ CCNT 2]					     (COND					       ((IGEQ MAXFONT FC)						 (PressFont (ELT FA FC)))					       (T (\BOUT PRESSOUTSTRM (CHARCODE ^F))						  (\BOUT PRESSOUTSTRM FC)						  (SETQ CCNT 2]			       (CR (SHOW.PRESS CCNT)				   (SETQ CCNT 0)				   (PressNewLine REGION))			       (^L (SHOW.PRESS CCNT)				   (SETQ CCNT 0)				   (PressFont (PROG1 CPRESSFONT (PressClosePage)						     (PressStartPage)))				   (PressNewPage REGION))			       (TAB (FRPTQ 8 (\BOUT PRESSOUTSTRM (CHARCODE SPACE)))				    (add CCNT 8))			       [NULL (COND				       ((\EOFP INSTRM)       (* Zero byte marks possible EOS)					 (SHOW.PRESS CCNT)					 (RETURN))				       (T (\BOUT PRESSOUTSTRM C)					  (add CCNT 1]			       (PROGN (\BOUT PRESSOUTSTRM C)				      (add CCNT 1]	    (RETURN (LIST (CLOSEF IN)			  (PressClose IN])(JPEEKBACK  [LAMBDA NIL                      (* lmm "23-MAR-82 22:08")    (for X in CHARS when (fetch CODES of X) do (RETURN (fetch CODES of X])(JPEEKKEY  [LAMBDA NIL                                                (* lmm " 1-APR-82 14:47")    (OR JPENDINGCHAR (SETQ JPENDINGCHAR (\GETKEY])(JPRESSCHAR  [LAMBDA (NSCSET NSCHAR FONT0)    (* @nED "24-MAR-82 12:16")    (PROG ((SIZE (fetch FONTSIZE of FONT0)))          (RETURN (COND		    ((EQ NSCSET 36)                                   (* HIRAGANA)		      (PressFont (COND				   ((IGREATERP SIZE 11)				     KANA12)				   (T KANA10)))		      (IDIFFERENCE NSCHAR 32))		    ((EQ NSCSET 37)                                   (* KATAKANA)		      (PressFont (COND				   ((IGREATERP SIZE 11)				     KANA12)				   (T KANA10)))		      (IPLUS NSCHAR 83))		    (T (SETQ NSCHAR (IPLUS (ITIMES 94 (IDIFFERENCE NSCSET 48))					   NSCHAR -33))		       (PressFont (ELT (COND					 ((IGREATERP SIZE 11)					   KANJI12)					 (T KANJI10))				       (LRSH NSCHAR 8)))		       (LOGAND NSCHAR 255])(JSHOWKANJI  [LAMBDA (CODE DSP)                                         (* ÎëÌÚ "27-JAN-83 09:56")    (DSPFONT (\CHARSETFONT (LRSH CODE 8)			   (DSPFONT NIL DSP))	     DSP)    (PRIN3 (CHARACTER (LOGAND CODE 127))	   DSP])(JSTRINGWIDTH  [LAMBDA (STR FONT FLG RDTBL)                               (* rmk: "22-SEP-83 11:17")                                                             (* Returns the width of STR according to FONT)    (PROG (STRM WIDTHSBASE W0)          (DECLARE (SPECVARS WIDTHSBASE W0 FONT))            (* Used in \MAPCHARS)          [SETQ WIDTHSBASE (COND	      ((type? FONTDESCRIPTOR FONT)		(fetch (ARRAYP BASE) of (ffetch \SFWidths of FONT)))	      ((SETQ STRM (DISPLAYSTREAMP (\OUTSTREAMARG FONT T)))		(ffetch (\DISPLAYDATA DDWIDTHSCACHE) of (fetch IMAGEDATA of STRM)))	      (T (fetch (ARRAYP BASE) of (fetch (FONTDESCRIPTOR \SFWidths)					    of (OR (DEFAULTFONT (OR FONT (QUOTE DISPLAY))								NIL T)						   (FONTCREATE FONT]          (RETURN (SELECTC (NTYPX STR)			   [\LITATOM (COND				       [FLG (for C (SA _(fetch READSA of (\GTREADTABLE RDTBL)))					       inatom STR					       sum (.CHARSHIFT. C (COND								  ((fetch (READCODE ESCQUOTE)								      of (\SYNCODE SA C))								    (IPLUS (\FGETWIDTH WIDTHSBASE										       (CHARCODE											 %%))									   (\FGETWIDTH WIDTHSBASE C)))								  (T (\FGETWIDTH WIDTHSBASE C]				       (T (for C inatom STR sum (.CHARSHIFT. C (\FGETWIDTH WIDTHSBASE 											   C]			   [\STRINGP			     (COND			       [FLG (IPLUS (UNFOLD (\FGETWIDTH WIDTHSBASE (CHARCODE %"))						   2)					   (for C instring STR					      sum (.CHARSHIFT. C (SELCHARQ								 C								 ((%" %%)								   (IPLUS (\FGETWIDTH WIDTHSBASE										      (CHARCODE											%%))									  (\FGETWIDTH WIDTHSBASE C)))								 (\FGETWIDTH WIDTHSBASE C]			       (T (for C instring STR sum (.CHARSHIFT. C (\FGETWIDTH WIDTHSBASE C]			   (PROG ((S 0))			         (DECLARE (SPECVARS S))			         (\MAPCHARS [FUNCTION (LAMBDA (C)						(add S (.CHARSHIFT. C (\FGETWIDTH WIDTHSBASE C]					    STR FLG RDTBL)			         (RETURN S])(WORDCHARP  [LAMBDA (C)                                                (* lmm "12-APR-82 16:32")    (AND C (OR (CDR C)	       (AND (EQ OTHER.RC (\SYNCODE RTBLSA (CAR C)))		    (NEQ WORDSEPR.TC (\SYNCODE \PRIMTERMSA (CAR C])(WORDSEPRP  [LAMBDA (C)                      (* @nED "24-MAR-82 12:55")    (NOT (WORDCHARP C])(\CHARSETFONT  [LAMBDA (CODE FONT0)                                       (* lmm "15-APR-82 18:16")    (SETQ CODE (\CHARSET CODE))    (for X in BIGJFONTS bind (HT _(FONTHEIGHT FONT0)) do [COND							   ([AND (IGREATERP HT (CAR X))								 (SETQ X (ASSOC CODE (CDR X]							     (RETURN (CADR X]       finally (RETURN (OR (FONTP (ELT JDISPLAYFONTS CODE))			   FONT0])(JERASECHARS  [LAMBDA (FN)                     (* lmm "29-MAR-82 22:05")    (while [AND (CDR CHARS)		(APPLY* FN (fetch STATE of (CAR CHARS]       do (JCHDEL])(\READCUFONTFILE  [LAMBDA (FILE FAMILY SIZE FACE)                            (* lmm " 9-APR-82 13:35")    (PROG [FD NUMBCODES RW BITMAP OFFSETS HEIGHT WW H WIDTHS FONTDESC CSN CHAR WID BUFFER OFFSET CN	      (OFD (\GETOFD (OPENFILE FILE (QUOTE INPUT)				      (QUOTE OLD]          (SETQ H (\WIN OFD))          (SETQ WW (\WIN OFD))          (SETQ NUMBCODES (IQUOTIENT (IDIFFERENCE (GETEOFPTR OFD)						  (GETFILEPTR OFD))				     (UNFOLD (IPLUS 2 (ITIMES H WW))					     BYTESPERWORD)))          (SETQ BITMAP (BITMAPCREATE (UNFOLD (ITIMES WW NUMBCODES)					     BITSPERWORD)				     H))          (SETQ BUFFER (BITMAPCREATE (UNFOLD WW BITSPERWORD)				     H))          (SETQ OFFSET 0)          (while (NOT (EOFP OFD))	     do (SETQ CHAR (\WIN OFD))		(SETQ WID (\WIN OFD))		(SETQ CN (LRSH CHAR 8))		(SETQ CHAR (LOGAND CHAR 255))		[COND		  ([NOT (SETQ FONTDESC (CADR (ASSOC CN FD]		    (SETQ FONTDESC		      (create FONTDESCRIPTOR			      FONTFAMILY _ FAMILY			      FONTSIZE _ SIZE			      FONTFACE _ FACE			      FONTDEVICE _(QUOTE DISPLAY)))		    (replace CHARACTERBITMAP of FONTDESC with BITMAP)		    (replace \SFDescent of FONTDESC with (IDIFFERENCE H SIZE))		    (replace \SFAscent of FONTDESC with H)		    (replace \SFHeight of FONTDESC with (IDIFFERENCE (fetch \SFAscent of FONTDESC)								     (fetch \SFDescent of FONTDESC)))		    (replace FIRSTCHAR of FONTDESC with 0)		    (replace LASTCHAR of FONTDESC with \MAXCHAR)		    (replace \SFOffsets of FONTDESC with (ARRAY (IPLUS 2 \MAXCHAR)								(QUOTE SMALLPOSP)								0 0))		    (replace \SFWidths of FONTDESC with (ARRAY (IPLUS 2 \MAXCHAR)							       (QUOTE SMALLPOSP)							       0 0))		    (push FD (LIST CN FONTDESC]		(SETA (fetch \SFOffsets of FONTDESC)		      CHAR OFFSET)		(SETA (fetch \SFWidths of FONTDESC)		      CHAR WID)		(BINS OFD (fetch BITMAPBASE of BUFFER)		      0		      (LLSH (ITIMES WW H)			    1))		(BITBLT BUFFER 0 0 BITMAP OFFSET 0 WID H NIL (QUOTE REPLACE))		(add OFFSET WID))          (RETURN (PROG1 FD (CLOSEF OFD]))(DECLARE: (DECLARE: EVAL@COMPILE (GLOBALVARS FONT0ARRAY))(SETUPHASHARRAY (QUOTE FONT0ARRAY)		NIL)DONTCOPY [DECLARE: EVAL@COMPILE (HASHLINK DSTREAM (FONT0 FONT0ARRAY))(HASHLINK BUFFER (JLINEBUFSTATE))(RECORD CHR (CODES XPOS STATE LPARCOUNT LBRKCOUNT INSTRINGP))](DECLARE: EVAL@COMPILE (GLOBALVARS FONT0ARRAY))(SETUPHASHARRAY (QUOTE FONT0ARRAY)		NIL)(DECLARE: EVAL@COMPILE (PUTPROPS \CHARSHIFTP MACRO ((CHARCODE)			     (IGREATERP CHARCODE 127)))(PUTPROPS \CHARBITS MACRO ((CODE)			   (LOGAND CODE 127)))(PUTPROPS \CHARSET MACRO ((CODE)			  (LOGAND CODE 127)))(PUTPROPS .CHARSHIFT. MACRO ((C ELSE)			     (COND			       (W0 (PROG1 (\FGETWIDTH WIDTHSBASE (\CHARBITS C))					  (SETQ WIDTHSBASE W0)					  (SETQ W0)))			       ((\CHARSHIFTP C)				 (SETQ W0 WIDTHSBASE)				 [SETQ WIDTHSBASE (fetch (ARRAYP BASE)						     of (ffetch \SFWidths of (\CHARSETFONT C FONT]				 0)			       (T ELSE))))))(DECLARE: DOEVAL@COMPILE DONTCOPY(ADDTOVAR GLOBALVARS SPECIALKEYS))(ADDTOVAR SPECIALKEYS )(DECLARE: EVAL@COMPILE DONTCOPY (FILESLOAD (LOADCOMP)	   PRESS ATERM))(DECLARE: DOEVAL@COMPILE DONTCOPY(ADDTOVAR GLOBALVARS JFNS))(DECLARE: FIRST (RPAQQ JFNS ((\DSPPRINTCHAR NONJ\DSPPRINTCHAR JDSPPRINTCHAR)	     (STRINGWIDTH NONJ\STRINGWIDTH JSTRINGWIDTH)	     (MAKEPRESS NONJ\MAKEPRESS JMAKEPRESS)	     (\FILLBUFFER NONJ\FILLBUFFER JFILLBUFFER)))(for X in JFNS do (MOVD? (CAR X)			 (CADR X))))(DEFINEQ(JIN  [LAMBDA (INSTALLFLG)             (* lmm "24-MAR-82 09:46")    (COND      (INSTALLFLG (JLISPINIT)))    (for X in JFNS do (MOVD (COND			      (INSTALLFLG (CADDR X))			      (T (CADR X)))			    (CAR X)))    (NOT INSTALLFLG]))(RPAQQ JPENDINGCHAR NIL)(RPAQQ \INFILLBUFFER NIL)(PUTPROPS JLISP COPYRIGHT ("Xerox Corporation" 1982 1983))(DECLARE: DONTCOPY  (FILEMAP (NIL (983 19798 (.BUFBOUT. 993 . 1307) (DUMMYPRESSFONT 1309 . 1648) (GETVCODE 1650 . 1937) (INCR 1939 . 3231) (JADDCHAR 3233 . 3467) (JCHDEL 3469 . 4300) (JDSPPRINTCHAR 4302 . 4939) (JFILLBUFFER 4941 . 9603) (JGETKEY 9605 . 9804) (JMAKEPRESS 9806 . 13207) (JPEEKBACK 13209 . 13395) (JPEEKKEY 13397 . 13552) (JPRESSCHAR 13554 . 14339) (JSHOWKANJI 14341 . 14580) (JSTRINGWIDTH 14582 . 16630) (WORDCHARP 16632 . 16867) (WORDSEPRP 16869 . 16977) (\CHARSETFONT 16979 . 17381) (JERASECHARS 17383 . 17573) (\READCUFONTFILE 17575 . 19796)) (21290 21557 (JIN 21300 . 21555)))))STOP