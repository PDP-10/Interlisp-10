<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;LispCore>DlionInitial>Trident>Klamath>LispTridentInitial11T.mc!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">{File name:  [Idun]&lt;WDLion&gt;LispTridentInitial.mc<br><br>  Lichtenberg   2-Aug-84  1:28:03 fixed obscure leader pages bug.<br><br>Lichtenberg 20-Jul-84 14:42:48 -- Mesa 11.0 upgrades installed.<br>Lichtenberg 27-Jun-84 21:22:36  -- a stab at Lisp Initial<br>Lichtenberg 28-Jun-84 21:16:17  -- Lisp lives on Trident!!!!!!!<br>Lichtenberg  8-Jul-84 12:23:51  -- Put in code to build burp table on IOCB page<br>Lichtenberg  8-Jul-84 16:14:23  -- Trident boot now automatic for 16k ctl store<br><br> Description: first microcode read from the Trident disk, gets emulator microcode into CP memory,<br> Author: Neely,<br> Created: Neely ,December 11, 1981  12:38 PM<br> Last Edited by Neely February 17, 1982  10:16 AM:    - fix to boot link in ucode file & cyl cross.<br> Last Edited by Neely February 17, 1982  7:02 AM:    - fix to handle first page with boot link.<br> Last Edited by Neely February 3, 1982  9:44 AM:    - Moved RegDef of uDevOrd to dandelion.df.<br> Last Edited by Neely February 2, 1982  4:16 PM:    - Retries during Initial.<br> Last Edited by Neely January 15, 1982  9:27 PM:    - Fixed SD.Request.location.deviceOrdinal bug.<br> Last Edited by Neely January 15, 1982  2:13 PM:    - Fixed rCrhm = 1 bug.<br> Last Edited by Neely January 14, 1982  2:37 PM:    - Restored extract of filePageHi from BootID.<br> Last Edited by Neely January 13, 1982  7:49 PM:    - 30 secs., fixed multiDrive bug, filePageHi bug.<br> Last Edited by Neely January 12, 1982  6:31 PM:    - Fixed IOCB update and filePageHi bugs.<br> Last Edited by Neely January 4, 1982  1:30 PM:     - Fixed IOCBdiskLabel bug.<br> Last Edited by Neely December 31, 1981  5:03 PM:   - Fixed register bug @ xTest+1.<br> Last Edited by Neely December 18, 1981  2:09 PM:   - Fix NegBr probs and clientHeader probs.<br> Last Edited by Neely December 17, 1981  5:46 PM:   - IOCB.clientHeader&larr;0/0/0<br> Last Edited by Neely December 17, 1981  10:09 AM:  - Recal as well as Reset<br> Last Edited by Neely December 15, 1981  5:14 PM:   - Make all Rets [x, 10, z]<br> Last Edited by Neely December 11, 1981  12:38 PM:} <br> <br>RegDef[uLinkPtr, U, 27{uTT}];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{uLinkPtr}<br>RegDef[uFirstPage,U,49];<br>Set[hardMicrocodeFirstPage,13&rsquo;d];<br><br><br>{word offsets}<br>  {into Working Page}<br>Set[WPinitCSB, 48];<br>Set[WPrdLblCtl, 42];<br>Set[WPverLblCtl, 46];<br>Set[WPvrrLabelParam, 40];<br>Set[WPvvrLabelParam, 44];<br>  {into IOCBs}<br>Set[IOCBcHeader, 0];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{clientHeader}<br>Set[IOCBcHeaderCyl, 0];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{clientHeader.cylinder}<br>Set[IOCBcHeaderHS, 1];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{clientHeader.head&sector}<br>Set[IOCBdataPtrLo, 4];<br>Set[IOCBdataPtrHi, 5];<br>Set[IOCBtries, 6];<br>Set[IOCBpageCount, 7];<br>Set[IOCBcStatus, 8];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{Controller Status}<br>Set[IOCBdStatus, 9];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{Disk Status}<br>Set[IOCBdHeader, 0A];</span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>Set[IOCBdiskAdr, 0E];<br>Set[IOCBfilePageLo, 0F];<br>Set[IOCBseekDrive, 11];<br>Set[IOCBseekCyl, 12];<br>Set[IOCBseekHead, 13];<br>Set[IOCBhdrCtl, 16];<br>Set[IOCBlabelParam, 18];<br>Set[IOCBdataCtl, 1E];<br>Set[IOCBlabelParam, 18];<br>Set[IOCBlabelErrMask, 1B];<br>Set[IOCBclientLabel, 20];<br>Set[IOCBcLblFilePageLo, 25];<br>Set[IOCBcLblFilePageHi, 26];<br>Set[IOCBcLblBootLink, 28];<br>Set[IOCBcLblBootLink1, 29];<br>Set[IOCBdiskLabel, 30];<br>Set[IOCBdLblBootLink, 38];<br><br>{values }<br>Set[vDStatusEndCyl, 40];<br>Set[vDStatusAnyAtten, 80];<br>Set[vCStatusLastField, 6]; {Last Field Mask}<br>Set[vCStatusDataField, 6];<br>Set[vCStatusLblField, 4];<br>Set[vCStatusVerErrLRot8, 8];<br><br>Set[vCmdTagHd, 40];<br>Set[vCmdHd5, 5];<br>Set[vCmdTagCtl,</span><span style="font: 10pt serif; color: aqua"> </span><span style="font: 10pt serif">20];<br>Set[vCmdResetRecal, 0A];<br><br>Set[vLabelSize, 0A];<br><br>Set[vT300Heads, 19&rsquo;d];<br>Set[vT80Heads, 5];<br>Set[vSecsPerTrack, 30&rsquo;d];<br><br>Set[vNumHeadsBox, 2F];<br><br>{physical volume boot files}<br>{useful data formats extracted from Boot.mesa<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BootFileType: TYPE= {hardMicrocode, softMicrocode, germ, pilot, debugger, debugee};<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">DiskFileID: TYPE= RECORD[fID: File.ID, firstPage: File.PageN</span><span style="font: 10pt serif; color: aqua">u</span><span style="font: 10pt serif">mber, da: DiskAddress];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">PVBootFiles: POINTER TO ARRAY BootFileType[hardMicrocode..pilot] OF DiskFileID= 2;<br><br>After reading from the disk, PVBootFiles moved to memory location 2}<br><br>Set[bootingInfo, 8];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{origin of PVBootFiles in physical volume root page}<br>Set[Disk</span><span style="font: 10pt serif; color: aqua">F</span><span style="font: 10pt serif">ileIDSize, 9];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{number of words in DiskFileID}<br>Set[bootingInfoSize, Mul[DiskFileIDSize, 4]];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{size of PVBootFiles}<br><br>{things salted away in page 0}<br>Set[availableDevices, 0];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{devices available for booting, set up by Phase 0}<br>Set[bootReadyFlag, 1];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{non-zero indicates boot file is ready}<br>Set[hardFileID, 2];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{hard microcode DiskFileID, copied from physical volume root page}<br>Set[emulatorFileID, 0B];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{emulator microcode DiskFileID, copied from physical volume root page}<br>Set[germFileID, 14];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{germ DiskFileID, copied from physical volume root page}<br>Set[bootFileID, 1D];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{working DiskFileID, copied from one of the above fileID&rsquo;s}<br>Set[bootPage, 22];<br>Set[bootDiskAddr, 24];<br>Set[labelTemplate, 26];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{template label used by boot loading routines}<br><br>{ *****{germ definitions}<br>Set[germPageHigh, 0];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{virtual page number of origin of germ -- 1B}<br>Set[germPageLow, 1];<br>Set[sFirstGermRequest, 320&rsquo;b];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{start of germ request in SD}<br>Set[sLastGermRequest, 377&rsquo;b];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{end of germ request in SD}<br>Set[RequestSize, 60&rsquo;b];</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">{size of germ request in SD}<br>Set[SD.Request.version, 320&rsquo;b];<br>  Set[RequestVersionHigh, 7];<br>  Set[RequestVersionLow, 56&rsquo;b];<br>Set[SD.Request.action, 321&rsquo;b];<br>  Set[bootPhysicalVolume, 2];<br>Set[SD.Request.location, 322&rsquo;b];<br>Set[SD.Request.location.deviceType, 322&rsquo;b];<br>  Set[germPilotDisk, 64&rsquo;d];<br>Set[SD.Request.location.devOrd, 323&rsquo;b];<br><br>*****}<br><br>Set[sLastGermRequest,                  Add[sFirstGermRequestLow, 57&rsquo;b]];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{end of germ request in SD}<br>Set[RequestSize,                        60&rsquo;b];</span><span class="tab" val="77"></span><span style="font: 10pt serif">{size of germ request in SD}<br><br>Set[SD.Request.version,                Add[sFirstGermRequestLow, 00&rsquo;b]];<br><br>  Set[RequestVersionHigh,                  7];<br>  Set[RequestVersionLow,                56&rsquo;b];<br><br>Set[SD.Request.action,                 Add[sFirstGermRequestLow, 01&rsquo;b]];<br>  Set[bootPhysicalVolume,                  2];<br>Set[SD.Request.location,               Add[sFirstGermRequestLow, 02&rsquo;b]];<br>Set[SD.Request.location.deviceType,    Add[sFirstGermRequestLow, 02&rsquo;b]];<br>  Set[germPilotDisk,                    64&rsquo;d];<br>Set[SD.Request.location.deviceOrdinal, Add[sFirstGermRequestLow, 03&rsquo;b]];<br><br><br>Set[bootNotEnoughBanks, 57&rsquo;d];  {makes 257 error code if trident boots with 4k storage}<br>Set[MicroDBNumber,3]; {second DB is microcode}<br><br><br>DoneOnceOnlyInit:<br>{Initialization}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">germStart&larr; rE,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uBootStart&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {boot file starts at 200}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{===========================================================================}<br>{**** START of NEW CODE for LISP </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br><br>{*}</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br>{*}</span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; acR{uDiagnostic} - 1, NZeroBr, BRANCH[pLispBoot, pMesaBoot],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>pLispBoot:</span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[LispBoot, MesaBoot],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>pMesaBoot: CANCELBR[MesaBoot, 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{map virtual pages 0-255 to real pages 0-255, first we must save the current mapping of the lowest virtual pages}<br><br>MesaBoot2: uDiagnostic&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>MesaBoot:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 0AA{Lisp},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uLispBootMsg &larr; rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">{MCtl &larr; 0} Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{**** END of NEW CODE for LISP</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{===========================================================================}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br><br>{map virtual pages 0-255 to real pages 0-255, first we must save the current mapping of the lowest virtual pages}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; topPage, L3&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0FF+1, CALL[L3BLT3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; present,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10, L3BLTRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{set up identity map for benefit of the disk microcode}<br>identityMap:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0], BRANCH[$, InitIOCB],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, rB&larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR+rC, CarryBr, GOTO[identityMap],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>InitIOCB:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {addr of IOCB}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; bUBitSignAdr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">KCtl &larr; rD LRot0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {Select boot drive}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Initialize IOCB.clientHeader=0/0/0}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, IOCBcHeaderCyl+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, IOCBcHeaderHS+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rDrh&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Merge drive info into IOCB. Uses rB=100=IOCBaddr & rD=bUBitSignAdr}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+IOCBseekDrive, L0&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[merge3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+IOCBhdrCtl, L0&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10, mergeRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[merge3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+IOCBdataCtl, L0&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, mergeRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[merge3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+WPrdLblCtl, L0&larr; 3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[2, 10, mergeRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[merge3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+WPverLblCtl, L0&larr; 4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[3, 10, mergeRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[merge3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[] &larr; rD LRot8,XDisp, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[4, 10, mergeRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">DISP4[CSBIndex],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 0,  {drive 0}  GOTO[IOCBDA],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[8, 10, CSBIndex]; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 4,  {drive 1}  GOTO[IOCBDA],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[4, 10, CSBIndex]; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; </span><span style="font: 10pt serif; color: cyan">8</span><span style="font: 10pt serif">,  {drive 2}  GOTO[IOCBDA],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[2,</span><span style="font: 10pt serif; color: cyan"> </span><span style="font: 10pt serif">10, CSBIndex]; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">r</span><span style="font: 10pt serif; color: cyan">C</span><span style="font: 10pt serif"> &larr; 0C, {drive </span><span style="font: 10pt serif; color: cyan">3</span><span style="font: 10pt serif">}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[1</span><span style="font: 10pt serif; color: cyan">,</span><span style="font: 10pt serif"> 10, CSBIndex]; <br><br>IOCBD</span><span style="font: 10pt serif; color: cyan">A</span><span style="font: 10pt serif">:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [r</span><span style="font: 10pt serif; color: cyan">B</span><span style="font: 10pt serif">rh, IOCBdisk</span><span style="font: 10pt serif; color: cyan">A</span><span style="font: 10pt serif">dr+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR</span><span style="font: 10pt serif; color: cyan"> </span><span style="font: 10pt serif">&larr; rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; rC</span><span style="font: 10pt serif; color: cyan">,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; RShift1 acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; RShift1 acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uDevOrd &larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>InitCSB:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB+WPinitCSB, {adr Init vals for CSB}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC+rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 0{*** IOPageLow ***}, L3&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {CSB at 14000}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 10, CALL[L3BLT3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{Set tiUnumHeads based on boot drive type(i.e. T80/T300)}<br><br>{select head 5}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; U0400,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, L3BLTRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB or vCmdHd5, L0 &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {Select Head 5}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; vCmdTagHd, CALL[SetRst1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;{delays after tagReset} <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Xbus &larr; KStatus, XwdDisp, {test bit 9&10}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[0, 10, SetRst3Ret];<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">DISP2[DiskType, 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br>typeT300:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; vT300Heads, GOTO[setHeads], </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2, at[3, 10, DiskType];<br>typeT80:</span><span class="tab" val="77"></span><span style="font: 10pt serif">    acR &larr; vT80Heads,  </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2, at[1, 10, DiskType];<br>setHeads:   tiUnumHeads &larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br>{ write the number of heads onto the IOCB page}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 0FF + 1 {addr of IOCB}, c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, vNumHeadsBox + 0], c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; acR, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; U0400,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB or vCmdResetRecal, L0 &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; vCmdTagCtl, CALL[SetRst1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {Reset Disk Check}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; 0, GOTO[rootPage],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3, at[1, 10, SetRst3Ret];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{===========================================================================}<br>{**** START of NEW CODE for LISP </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{** Lisp uses identity map for all of real memory for benefit of the disk microcode}<br><br>LispBoot:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q &larr; 55{Mesa},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; Q xor uLispBootMsg, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 03{B}0{dirtyRef}, BRANCH[$, MesaBoot2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q{100}&larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>nextId3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{acR{dirtyRef}, rB{10000}, Q{100},   map 2&uarr;12 pages as identity}<br><br>nextId:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, acR &larr; acR + Q{100}, CarryBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+1, BRANCH[nextId, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>incSeg:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR + 1, NibCarryBr{2&uarr;12 pages},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; topPage{virtual}, BRANCH[nextId3, Zdone],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>Zdone:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; 0E - rC, PgCarryBr{if rC is low or eq},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0B0{2mb+dirty}, BRANCH[ZnextId3, doneId],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;{%%}<br><br>{acR{2mb+dirty}, rB{10000}, Q{100},   map next 2&uarr;11 pages as identity}<br><br>ZnextId:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, acR &larr; acR + Q{100}, CarryBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+1, BRANCH[ZnextId, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>ZincSeg:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; acR + 1{9}, NibCarryBr{2&uarr;12{11} more pages},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR + 1, BRANCH[ZnextId3, doneId],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>ZnextId3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, GOTO[ZnextId],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>doneId:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR{dirty;page FF}&larr; ~0DF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh&larr;1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; 040,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{14000} &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{acR{FF20}, rB{12000{11800}}, rCrh,rC{14000},  remaining vp&rsquo;s mapped to FF}<br><br>Scrap:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0], BRANCH[$, doneScrp],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br>Scrap2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR{-1}, rB&larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rB - rC{4000}, ZeroBr, GOTO[Scrap],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>doneScrp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{acR{-1}, rCrh,rC{14000},  change 65 map entries to protect the map and iopage to point to FF{-1}}<br><br>Protect65:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Map{14000}&larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR{-1}, rC&larr; rC, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC - 0FF - 1, BRANCH[Protect65, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{Mesa11: Real Page 20000 is IOPage for Mesa11 but stack for Lisp}<br>{Divert the reading of page 20000 from newIOPage to oldIOPage}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; 2{IOPageHigh},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 40,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Map{20000} &larr; [rCrh{2}, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR{4031} &larr; acR or 31,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>        GOTO[InitIOCB],c1;<br><br><br>{**** END of NEW CODE for LISP</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{===========================================================================}<br><br>{Now we&rsquo;re ready to read the root page.} <br>{There is only one IOCB. DCB[0] points to it. DCB[0] can be used for any drive.<br> The IOCB is initialized with a da=0/0/0 .}<br><br>rootPage:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rD&larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {rD(rh)= addr of IOCB}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF &larr; 2, L3 &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {read data into pg. 2}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 1, CALL[doVrr1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;  <br><br>{save the useful stuff from the physical volume root page}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10, xferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+bootingInfo, L3&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; bootingInfoSize, CALL[L3BLT2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br>{** lisp **}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 2, c1, at[2, 10, L3BLTRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; 0, c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rCrh, hardMicrocodeFirstPage + 0], c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; MD, c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uFirstPage &larr; rC, c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c3;<br><br><br>{read the emulator boot file or the hard microcode}<br>emuHard:</span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; bootFileID, BRANCH[$, emuHard0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">  rB&larr; hardFileID, L0&larr; 8, GOTO[emuHard1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>emuHard0:</span><span class="tab" val="77"></span><span style="font: 10pt serif">  rB&larr; emulatorFileID, L0&larr; 8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>emuHard1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; DiskFileIDSize, CALL[BLT2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 2, L2&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[8, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">nextPage&larr; acR, CALL[readBoot3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10,readBootRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; nextPage, BRANCH[$, readGerm],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{===========================================================================}<br>{**** START of NEW CODE for LISP </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus&larr; rC{uDiagnostic}-1, NZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, BRANCH[$, doDiag],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{test if we have lisp or diagnostics in real memory}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 15{passH},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh{0} &larr; rB{300} &larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0F{passA}],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{passH} &larr; rC LRot8, CANCELBR[$, 2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; MD xor rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC xor 0E3{passL},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rC, NZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, BRANCH[$, notLisp],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{ We have Lisp; Restore the map.}<br>{set map[0..3FFFF] to vacant and interpret FPTOVP}<br><br>LispInit:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB{7FFF}&larr; ~1 RRot1, rBrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB{3FFF}&larr; rB RShift1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 60{vacant},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>vacLp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh{0C1}, rB+0], ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rC{vacant}, rB&larr; rB-1, NibCarryBr, BRANCH[$, vDone],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>vac3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, BRANCH[$, vacLp]{match to vacRef+1},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>vacRef:</span><span class="tab" val="77"></span><span style="font: 10pt serif">{Refresh,}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Xbus &larr; 1, XDisp, GOTO[vac3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>vDone: Noop, CANCELBR[$, 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{update Interface page and interpret FPTOVP}<br><br>{Map[InterfacePageVp] &larr; 3}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acRrh &larr; 26&rsquo;b{INTERFACEspace}, CANCELBR[$, 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 20&rsquo;b{INTERFACEbase=10000&rsquo;b},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 3{real interface page},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB{300} &larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; rB + 03{B}0{dirty},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Map{161000} &larr; [acRrh,acR],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; rB{3B0},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 0C{(NRealPages{3072})/256},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 15&rsquo;b{MachineType} + 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; 6{\DANDELION},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{C00} &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q &larr; topPage{virtual},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q &larr; Q + 40,{ map not included}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q{NRealPages} &larr; Q + {02}{0A8}{-56 mp301}0FF{+1}{bank 0 was not incl but},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 70&rsquo;b{NRealPages} + 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; Q{NRealPages} {&larr; topPage}{rC{C00}},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{%% no segment crossing of FPTOVP[i-1] ptr ??? }<br><br>{interpret FPTOVP setup}<br>{for i{acR} &larr; 501&rsquo;b to MaxRealPage{rC}</span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{</span><span class="tab" val="77"></span><span style="font: 10pt serif">unless FPTOVP[i-1]=none{-1}</span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{</span><span class="tab" val="77"></span><span style="font: 10pt serif">do MAP[FPTOVP[i-1]]:vp &larr; i</span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 73&rsquo;b{FPTOVPStart} + 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR{F2Vpage} &larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR{F2VrealPage+1} &larr; acR + 2{file1=real2}{+1},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acRrh &larr; acR &larr; acR LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR and ~0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR{F2V+500b} &larr; acR + 40,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 0FF + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{501b} &larr; rC + 41,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{interpret FPTOVP Loop </span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{acR:</span><span class="tab" val="77"></span><span style="font: 10pt serif">FPTOVP[i-1] ptr </span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{rB:</span><span class="tab" val="77"></span><span style="font: 10pt serif">FPTOVP[i-1]:vp</span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{rC:</span><span class="tab" val="77"></span><span style="font: 10pt serif">i &larr; 501b</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{Q:</span><span class="tab" val="77"></span><span style="font: 10pt serif">NRealPages= C00</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br>{rBrh:</span><span class="tab" val="77"></span><span style="font: 10pt serif">10000{Map}</span><span class="tab" val="77"></span><span style="font: 10pt serif">}<br><br>{spin2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[spin2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c*;}{%%%}<br><br>f2vLp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; acR &larr; [acRrh, acR + 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB{7FFF} &larr; (rB xor ~rB) RShift1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB{vp} &larr; MD and rB{7FFF},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rB + rB, NegBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8, XRefBr, BRANCH[$, none],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rC + 0F</span><span style="font: 10pt serif; color: cyan">, NibCarryBr</span><span style="font: 10pt serif">{nondisplay bank?}, BRANCH[$, fvMod],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh{1}, </span><span style="font: 10pt serif; color: cyan">rB + 0], BRAN</span><span style="font: 10pt serif">CH[fvNo, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; rC{i}, GOTO[none],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;</span><span style="font: 10pt serif; color: cyan"><br>fvNo:</span><span class="tab" val="77"></span><span style="font: 10pt serif">N</span><span style="font: 10pt serif; color: cyan">oop, GOTO[</span><span style="font: 10pt serif">none],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c</span><span style="font: 10pt serif; color: cyan">2;<br><br>fvMod:</span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">M</span><span style="font: 10pt serif">AR&larr; [rBrh{1</span><span style="font: 10pt serif; color: cyan">}, rB + </span><span style="font: 10pt serif">0], BRANCH[fvMNo, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; </span><span style="font: 10pt serif; color: cyan">rC{i} + </span><span style="font: 10pt serif">70{move ove</span><span style="font: 10pt serif; color: cyan">r fl</span><span style="font: 10pt serif">ags to "dp" bit}, GOTO[none],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;</span><span style="font: 10pt serif; color: cyan"><br>fvMNo:</span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">Noop, GOTO[none],</span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">c2;<br>none:</span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">rC &larr; rC LRot8, CANCELBR[$, 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif; color: cyan">rC &larr; r</span><span style="font: 10pt serif">C + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rC xor Q{NRealPages}, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR + 1, BRANCH[f2vLp, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{spin3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[spin3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c*;}{%%%}<br><br>{done with interpret FPTOVP}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 40,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{4000} &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Map[IOPageVp=0FF] &larr; 500}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR{100FF}&larr; [rBrh{1}, rB + 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR{4001} &larr; rC{4000} + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{100} &larr; 0FF + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{200} &larr; rC + rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{400} &larr; rC + rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uBootStart&larr; rC{400}, {GOTO[StartNewInit],}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>bankTest: Q &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Bank &larr; rB &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>btLoop: rC &larr; ~ PPort, BRANCH[$, {GOTO[}MultiBank],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>btLL: rC &larr; (rC LRot8) xor Q,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rC and 3, NZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q &larr; Q + {0FF +} 1, BRANCH[$, NotEnoughBanks],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Bank &larr; rB +4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB +4, NibCarryBr,{}{%}</span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[btLoop],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>MultiBank:        rB&larr; 4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh{0} &larr; rB{400h}&larr; rB LRot8, c2; {boot file starts at 200}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; MicroDBNumber{3rd DB for Trident},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {*** Changed for auto Lisp boot ***}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC{400q}{100} &larr; 0FF + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC+rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uBootStart&larr; rC{400},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br><br>{===========================================================================}<br>{**** START of NEW CODE for LISP </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br><br>        Noop,GOTO[GoNewInit],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>GoNewInit:</span><span class="tab" val="77"></span><span style="font: 10pt serif">{copy data diverted from newIOPage to oldIOPage back to newIOPage}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 40,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0FF + 1, L0&larr; 0D,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{BLT cnt/acR:100 from/rB:14000 to/rC:20000}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{clear oldIOPage to zeros}</span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0D{free?}, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 40,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Initialize uIOPage register}</span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB or 1, c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uIOPage &larr; rC{4001},  c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>ioclp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh{14000}, rB+0], BRANCH[$, ioclrDone],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; acR and ~acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB +1, PgCarryBr, GOTO[ioclp],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>ioclrDone:</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[StartNewInit],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{**** END of NEW CODE for LISP</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{===========================================================================}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{Tridents without 16k control store are not allowed yet}<br>NotEnoughBanks:  acR &larr; bootNotEnoughBanks, GOTOABS[Maintenance2Loc], c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>BackFromNewInit:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"> TOS{8002h} &larr; RRot1 5,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MCtl &larr; TOS{8002h}, GOTO[exitToEmulator],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>{**** END of NEW CODE for LISP</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{===========================================================================}<br><br>{hard microcode (quick exit), pick up diagnostic table entry from first page of boot file}<br><br>{===========================================================================}<br>{**** START of NEW CODE for LISP </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br><br>doDiag:</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 055{Mesa}, GOTO[doDiag2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br>notLisp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 055{Mesa}, GOTO[doDiag2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br>doDiag2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">uLispBootMsg &larr; rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{**** END of NEW CODE for LISP</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">       *****}<br>{===========================================================================}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; 2,</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {boot file starts at 200}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC+rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uBootStart&larr; rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[exitToEmulator],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{read the germ}<br>readGerm:</span><span class="tab" val="77"></span><span style="font: 10pt serif">germStart&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; germFileID,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; bootFileID, L0&larr; 9,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; DiskFileIDSize, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">L2&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[9, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[readBoot3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{<br>We now have the germ in real memory.  Restore the map for pages 0-255.  Then move the germ to MDS 0, starting at page 1.  Initialize the Request in the germ&rsquo;s SD.<br>}<br>RestoreMap:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1,10,readBootRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; 0, L0&larr; 5,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0FF+1, CALL[BLT3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{vacate the pages just used to restore the low ones}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[5, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0FF+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; vacant, L0&larr; 0B,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR-1, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Move germ to MDS 0, page 1}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; germStart,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0B, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; nextPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; rD - rC, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">transferCount &larr; rD, BRANCH[moveGerm1, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {number pages in germ}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">  acR&larr; bootNullGerm, GOTOABS[Maintenance2Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br>moveGerm1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">germStart&larr; acR xor ~acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rFrh &larr; germPageHigh, rF &larr; 0 + germPageLow,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF &larr; rF LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>mg2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Map &larr; [rFrh, rF],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rCrh &larr; rC &larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0FF + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC and ~0FF, L0 &larr; 0C,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF &larr; rF + 0FF + 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0C, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; rD - 1, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE &larr; LShift1 0FF, SE &larr; 1, BRANCH[mg2, InitRequest],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{Initialize Request in germ&rsquo;s SD}<br><br>InitRequest: </span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">{rE has 1FF = start of SD -1}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequestHigh,</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8,</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;  {Constants use an 8-bit data path.}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE &larr; rE + rC + 1,  {correct page}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Map &larr; rF &larr; [rFrh, rE + 0],</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequestLow,</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; MD,</span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{InitRequest:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Map &larr; rF &larr; [rFrh, rE + 1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequest,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>}<br><br>ZeroReq:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; rD, rC &larr; rC + 1, PgCarryBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {rD zero from above}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[ZeroReq, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; RequestVersionHigh,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; rD LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rD &larr; rD or RequestVersionLow,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.version+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; rD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.action+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; bootPhysicalVolume,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.location.deviceType+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; germPilotDisk,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>doneReq:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MCtl &larr; 0, GOTO[exitToEmulator],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>{Read the first page of the bootFile.  Calculate the proper label by reading the label from the disk and filing in the correct fileID and page number}<br>readBoot3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>readBoot:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rD+IOCBcHeader, L3&larr; 3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {disk address of boot}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 2, CALL[L3BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{** New for Lisp: Copy addr of first page of boot file to IOCB page}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[3, 10, L3BLTRet]; {nil disk address?}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rD or 80{uLinkPtr}{+{1}headerAddr}, L0&larr; 0E{*free?},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {save for lisp}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 2, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; 82, {** New for Lisp - sets up loc of burp table}c1, at[0E, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">uLinkPtr &larr; rB {** New for Lisp **},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {nil disk address?}<br><br>{ ** End of new stuff for Lisp **}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR or MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; acR, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[$, nilBootFile],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF&larr; nextPage, L3&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVrr2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {read 1 starting at page 2}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rD+IOCBclientLabel,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, xferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; bootFileID, L3&larr; 4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 6, CALL[L3BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; rE and 7F,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[4, 10, L3BLTRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; rE LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {rE&larr;  high bits of page#}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; LShift1 rE,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr;  7,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD and acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR or rE,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1,;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {read low 16 bits of page #}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC+1, {reading first page is a special case}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">filePage&larr; rC,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {restore disk address}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rD+IOCBcHeader, L0&larr; 3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 2, CALL[BLT2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF&larr; nextPage, L3&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[3, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVvr3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {read 1 starting at page 2}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0A, GOTOABS[Maintenance2Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[2, 10, xferLblVerRet]; {was bootDeviceError}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; nextPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[2, 10, xferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">nextPage&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageHi+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; ~7,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD and acR,  {Mask out 3bit Label flags}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageHi+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{check for VERY special case of a boot link in the first page}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblBootLink+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblBootLink1+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; acR or rB, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[rbLink, rbNotLink],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>rbLink:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, {boot link in the first page}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0, {to zero out boot link}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblBootLink+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblBootLink1+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br>rbNotLink:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; labelTemplate,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rD+IOCBclientLabel, L0&larr; 6,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; vLabelSize, CALL[BLT3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br><br>{read the rest of the file from the Pilot Volume}<br>readLoop:</span><span class="tab" val="77"></span><span style="font: 10pt serif">L1&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[6, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[pagesLeftInCylinder],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">transferCount&larr; acR, NZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, PLCRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[$, readRun],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{no pages left in cylinder, advance to next cylinder}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeaderHS+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {start at head 0, sector 0}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeaderCyl+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeaderCyl+0], L1&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR+1, CALL[pagesLeftInCylinder],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {step in one cylinder}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[2, 10, PLCRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">transferCount&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>readRun:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rF&larr; ~0FF, L3&larr; 3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;{** Was: rF &larr; nextPage}<br><br><br>{*** New stuff for Lisp ***}<br><br>{Transfer count reduced to 0FF}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; acR and rF, NZeroBr, c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF &larr; nextPage, BRANCH[oldTCnt,newTCnt],c2;<br><br>oldTCnt: GOTO[readRun1],c3;<br>newTCnt: acR &larr; 0FF, GOTO[readRun1], c3;<br><br>readRun1:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Ybus &larr; rF + acR, PgCarryBr{new transferCount},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, BRANCH[oldTC, newTC],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>oldTC:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, GOTO[readRun2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>newTC:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0-rF, GOTO[readRun2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>readRun2:<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR and 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{*** End New Stuff for Lisp ***}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">transferCount &larr; acR, CALL[doVvr2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {TransferCount &larr; ACR for Lisp}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; transferCount,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[3, 10, xferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; filePage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR+rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {next page in file}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">filePage&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; nextPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR+rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {next page in memory}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">nextPage&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[readLoop],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>{burped while reading run of pages, controllerStatus in rF.}<br>readBurp:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBpageCount+0], {get # of sectors remaining}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[3, 10, xferLblVerRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; transferCount,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD, {number sectors remaining}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; rB - acR, {number sectors transferred}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">transferCount&larr; acR, {zero is okay}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; filePage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; rE+acR+1 {+1 because one sec read via Vrr},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {file page for next label}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">filePage&larr; rE,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; nextPage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+acR+1 {+1 because one sec read via Vrr},</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {next available page for vvr}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">nextPage&larr; rB,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF&larr; rB-1, L3&larr; 4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {page used by vrr}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVrr2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {transfer 1 page}<br><br>{Copy boot link to header,  and check for end of file, FFFF in both words of boot link.}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdLblBootLink+0] ,c1,at[4, 10, xferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdLblBootLink+1], c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; acR or rB, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR+1, BRANCH[rdBurp1, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">  acR&larr; bootBrokenChain, GOTOABS[Maintenance3Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {boot chain link is zero}<br>rdBurp1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; acR or rB, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;{FFFF+1 or FFFF+1 = 0  =&gt; end}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rD+IOCBclientLabel, BRANCH[rdBurp2, endRead],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>rdBurp2:<br>{*** New stuff for Lisp ***}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{*1}</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader{headerAddr}+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR-1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{*2}</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader{headerAddr}+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB-1, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>{*2}</span><span class="tab" val="77"></span><span style="font: 10pt serif">Q&larr; uLinkPtr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Temp &larr; filePage, c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rK &larr; uFirstPage, c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">, c3;<br><br>{*5}</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; Temp - rK,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{*5}</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR-1, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>{*5}</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB-1, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q{uLinkPtr} &larr; Q +3, PgCarryBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; vLabelSize{labelSize}, BRANCH[there1, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">{Noop,} L0&larr; 7, GOTO[there2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>there1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">uLinkPtr &larr; Q{uLinkPtr+3}, L0&larr; 7,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>there2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; labelTemplate, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{*** End  new stuff for Lisp ***}<br>{</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; labelTemplate, L0&larr; 7,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; vLabelSize, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[7, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; filePage,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[readLoop],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>endRead:</span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[readBootRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{here if boot file pointer was zero}<br>nilBootFile:</span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 1 {disk Boot}, BRANCH[noDiagnostics, $],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; germStart, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[noGerm, noEmulator],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>noEmulator:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; bootNoEmulator, GOTOABS[Maintenance2Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br><br>noGerm:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; bootNoGerm, GOTOABS[Maintenance2Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br>{this code tries a disk boot if no hard microcode is installed}<br>noDiagnostics:</span><span class="tab" val="77"></span><span style="font: 10pt serif">uDiagnostic&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">bootDevice &larr; acR {disk Boot}, GOTO[emuHard],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br><br>{subroutines}<br><br>{doVvr and doVrr do either a vvr or vrr operation to the boot drive. <br> TridentBootIOCB.bravo set up an IOCB that has.<br>     .microNext=0<br>     .dcbOffset=0 (DCB[0] can be and is used for any drive)<br>     .headerParam=verify, IncrDataPtr=TRUE, firstIOCB=TRUE<br>     .dataParam=read<br> Early parts of TridentInitial do the following.<br>     Set up DCB[0].microNext=ptr-to-the-only-IOCB, (never changed).<br>     Particularize IOCB based on boot drive.<br> Additionally both vrr and vvr REQUIRE: <br>     acR=pageCount, <br>     rD(rh)=IOCB addr.,<br>     rF=MemoryPageNumber, <br>     IOCB.clientHeader=Header, <br> vvr also REQUIRES: <br>     IOCB.clientLabel=Label     <br> Both vrr and vvr RETURN: <br>     rD(rh) unchanged,<br>     rF=ControllerStatus,<br>     IOCB.clientHeader=last in run. <br>     IOCB.pageCount=upDated (0 If good completion) <br>     IOCB.dataPtr=last in run. <br> vvr also RETURNS: <br>     IOCB.clientLabel=updated     <br> vrr also RETURNS: <br>     IOCB.clientLabel = IOCB.diskLabel as read}<br><br>doVrr2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>doVrr3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>doVrr1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">L1 &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rD+WPvrrLabelParam, CALL[doXfer],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rD+IOCBdiskLabel,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10, doXferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rD+IOCBclientLabel, L0&larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0A, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>xUpdateHS:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeaderHS+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; vSecsPerTrack, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {rB &larr; head sector} <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC and 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr;  rC xor acR, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[$, xLastSec],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, GOTO[xIncrHS]</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br>xLastSec:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB or 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;{so +1 yields sec=0 head+1} <br>xIncrHS:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB+1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeaderHS+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB, pRet3, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {update head sector}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[xferGoodRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>doVvr2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>doVvr3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>doVvr1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">L1 &larr; 1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rD+WPvvrLabelParam, CALL[doXfer], </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[1, 10, doXferGoodRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB+1, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {update client label}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">GOTO[xUpdateHS],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br>{doXfer completes the set-up of the IOCB and starts the microcode. It then waits for the inProgress bit to go off. If there were no errors, then it returns via pRet1/doXferGoodRet. If there is a PURE label verify error, then it returns via pRet3/xferLblVerRet. In either case rF has the status. For other error conditions doXfer retries the operation and if IOCB.tries goes to zero it goes to Maintenance2Loc with a bootDeviceError code.}<br><br>doXfer:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rF &larr; rF LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBpageCount+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {set IOCB.pageCount} <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rD+IOCBlabelParam,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif"><br>{** generalize TridentInitial to read past 0th segment}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdataPtrHi+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rF and 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {IOCB.dataPtrLo} <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdataPtrLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rF and ~0FF, L0&larr; 2,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {set IOCB.dataPtrLo} <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 4, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {vvr/vrr to labelParam}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rD+IOCBcHeader, GOTO[Xzzy],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[2, 10, subrRet]; <br><br>XRetry:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rD+IOCBcHeader,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br>Xzzy:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rD+IOCBdHeader, L0&larr; 4,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 2, CALL[BLT],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcLblFilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[4, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; 0C0, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBfilePageLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {set IOCB.filePageLo}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcStatus+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; acR, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {C000=InPrg&GoodComp}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; acR LRot12, {acR = 0C00}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rDrh, IOCBcHeader+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {get head, sector}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CANCELBR[$, 2], LOOPHOLE[wok], </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {sector, head}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB and 0FF, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; rB or acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBseekHead+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {set IOCB.seekHead}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; vCStatusVerErrLRot8, {used in err recovery}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rDrh, IOCBcHeader+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {get cylinder}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8, {used in err recovery} </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBseekCyl+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB or acR, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {set IOCB.seekCyl}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">KCmd &larr; acR LRot0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {0C00=ctlTest&firmEnab}<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBlabelErrMask+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; vCStatusLastField, {used in err recovery} </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD or rB, {used in err recovery}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br>XWait:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rDrh, IOCBcStatus+0], CANCELBR[$]</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC or vCStatusLblField, {used in err recovery} </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rF&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; U4000,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[] &larr; rF, NegBr,  {Neg =&gt; still in Progress}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">[] &larr; acR and rF, ZeroBr, BRANCH[$, XWait],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>XDone:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB and rF, BRANCH[XOK, XErr], </span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br><br>XOK:</span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet1,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[doXferGoodRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br>XErr:</span><span class="tab" val="77"></span><span style="font: 10pt serif">[] &larr; rB xor rC, ZeroBr,  { 0 =&gt; label verify err }</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[XNotLblVer,XLblVer],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br>XLblVer:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet3, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[xferLblVerRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>XNotLblVer:</span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB and vCStatusLastField,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB &larr; rB xor vCStatusDataField, ZeroBr, {0=&gt; data fld err}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[XChkRetry,XAdjIOCB],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br>XAdjIOCB:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBpageCount+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBpageCount+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB+1, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdataPtrLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBdataPtrLo+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB-1, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>XChkRetry:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBtries+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBtries+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR&larr; rB-1, ZeroBr, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[XRetry, XHardErr],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>XHardErr:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0B, GOTOABS[Maintenance2Loc],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; {was bootDeviceError}<br><br><br><br><br>{Uses data left in last header to compute pages left in cylinder, returns result in acR.}<br>pagesLeftInCylinder:  Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR&larr; [rDrh, IOCBcHeader+1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; tiUnumHeads, CANCELBR[$, 0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; rE LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR and 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; {head}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; rE and 0FF,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {sector}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; rB-acR-1, NegBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rB&larr; vSecsPerTrack, BRANCH[multiply, OffEnd],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>OffEnd:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; {off the end of the cylinder}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet1, GOTO[pgLft1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{multiply, multiplier in rB, multiplicand in acR, uses rC, result left in Q<br>  timing:</span><span class="tab" val="77"></span><span style="font: 10pt serif">45 cycles  main loop is 3 cycles times 15 iterations<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"> 4 cycles last iteration<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"> 3 cycles preamble<br></span><span class="tab" val="77"></span><span style="font: 10pt serif"> 1 cycles postamble<br>  total</span><span class="tab" val="77"></span><span style="font: 10pt serif">53 cycles  (2 MOD 3}<br><br>multiply:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Q&larr; acR,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; 0&rsquo;x,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; 10&rsquo;x,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>mult0:</span><span class="tab" val="77"></span><span style="font: 10pt serif">[]&larr; Q and 1, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC&larr; rC-1, ZeroBr, BRANCH[mult1, mult2],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>mult1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; DARShift1 (acR+rB), BRANCH[mult0, mult3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br>mult2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR DARShift1, BRANCH[mult0, mult3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>mult3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Q&larr; ~Q, </span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; Q+vSecsPerTrack, pRet1, GOTO[pgLft1],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>pgLft1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">acR&larr; acR-rE, RET[PLCRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br><br><br>{This subroutine is used to transfer commands to the selected disk.  Upon entry rB has the Bus value and rC has the Tag constant shifted right by 8.  Subroutine must set the Bus in c1 and the Tag in c3 of click1. Then it must wait at least two clicks to reset the tag.}<br><br>SetRst3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>SetRst1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">KCmd &larr; rB LRot0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC LRot8,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">KCmd &larr; (rB or rC) LRot0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; 10, {used in wait following tag reset}</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>{In c3 of click3 the tag is reset.}<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">KCmd &larr;  rB LRot0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>SRWait:</span><span class="tab" val="77"></span><span style="font: 10pt serif">CANCELBR[$],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">rC &larr; rC - 1, ZeroBr,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">BRANCH[$, SRWait],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[SetRst3Ret],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br><br>{L3BLT exists because there are too many calls on BLT}<br>L3BLT2:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br>L3BLT3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>L3BLT:</span><span class="tab" val="77"></span><span style="font: 10pt serif">L0 &larr; 0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">CALL[BLT3],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1, at[0, 10, subrRet];<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">pRet3,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[L3BLTRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3; <br><br><br>{This subroutine performs: (rC&uarr;) &larr; (rC&uarr;) or (rD). Destroys acR}<br><br>merge3:</span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br>merge1:</span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="77"></span><span style="font: 10pt serif">acR &larr; MD,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MAR &larr; [rCrh, rC+0],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">MDR &larr; acR or rD, pRet0,</span><span class="tab" val="77"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="77"></span><span style="font: 10pt serif">RET[mergeRet],</span><span class="tab" val="77"></span><span style="font: 10pt serif">c3;<br><br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
