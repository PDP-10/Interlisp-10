<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;LispCore>GC>LispDMC.DM!2>LJUMP.mc</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt monospace">:Title[LJUMP]; <br>*<br>* Edit History<br>* January 26, 1984  7:00 PM, JonL, opNOP and NEXTOP from LOPS<br>* January 4, 1984  6:40 PM, JonL, Moved in TL.NOP and TL.DECTSP2<br>* November 5, 1982  9:21 AM, Masinter<br><br>KnowRBase[LTEMP0];<br>TOPLEVEL;<br>InsSet[LispInsSet, 1];<br><br>*--------------------------------------------------------------------<br>opJUMP:</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 1 or 2 byte jump<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">NextOpcode;<br><br>set[dx, 0];<br>repeat[20,<br> IFUjmp[add[200, dx], 1, ifuBR, 0, opJUMP, add[dx, 2]] <br> set[dx, add[dx,1]]];<br><br>IFUjmp[260, 2, ifuBR, 0, opJUMP, 1];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* signed long jump<br><br><br>*--------------------------------------------------------------------<br>opFJUMP:</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace"> * jump if NIL and pop<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">TSP&larr; (fetch&larr; TSP) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Md, TSP&larr; (fetch&larr; TSP) - 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) + 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd&larr; T or Md;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu#0], T&larr; Id - (PCX&rsquo;) - 1;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">NextOpcode;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* take branch<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PCF&larr; T, Branch[TL.NOP];<br><br><br>set[dx, 0];<br>repeat[20,<br> IFUjmp[add[220, dx], 1, StackM2BR, 0, opFJUMP, add[dx, 2]] <br> set[dx, add[dx,1]]];<br><br> IFUjmp[262, 2, StackM2BR, 0, opFJUMP, 1];<br><br>*--------------------------------------------------------------------<br>opTJUMP: </span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* jump if not NIL and pop<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">TSP&larr; (fetch&larr; TSP) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Md, TSP&larr; (fetch&larr; TSP) - 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) + 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd&larr; T or Md;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu=0], T&larr; Id - (PCX&rsquo;) - 1;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">NextOpcode;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* take branch<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PCF&larr; T, branch[TL.NOP];<br><br>set[dx, 0];<br>repeat[20,<br> IFUjmp[add[240, dx], 1, StackM2BR, 0, opTJUMP, add[dx, 2]]<br> set[dx, add[dx,1]]];<br><br>IFUjmp[263, 2, StackM2BR, 0, opTJUMP, 1];<br><br>*--------------------------------------------------------------------<br>opNFJUMPX:</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* jump if NIL, pop if no jump<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (fetch&larr; TSP) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP0&larr; Md, fetch&larr; T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) + 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd&larr; (LTEMP0) or Md;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu#0], T&larr; Id - (PCX&rsquo;) - 1;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) - 1, NextOpcode;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* take branch<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PCF&larr; T;<br>TL.DECTSP2: </span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* after PCF&larr;, normally<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">TSP&larr; (TSP) - (2c), Branch[opNOP];<br><br> IFUjmp[264, 2, StackM2BR, 0, opNFJUMPX, 1];<br><br>*--------------------------------------------------------------------<br>opNTJUMPX:</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* jump if not NIL and pop<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (fetch&larr; TSP) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP0&larr; Md, fetch&larr; T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) + 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd&larr; (LTEMP0) or Md;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu=0], T&larr; Id - (PCX&rsquo;) - 1;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) - 1, NextOpcode;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* take branch<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PCF&larr; T, branch[TL.DECTSP2];<br><br> IFUjmp[265, 2, StackM2BR, 0, opNTJUMPX, 1];<br><br>*--------------------------------------------------------------------<br>opJUMPXX:</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* Long jump, relative to byte 0<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Id;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; lsh [T, 10];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Id + T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; T - (PCX&rsquo;) - 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PCF&larr; T, branch[TL.NOP];<br>TL.NOP: </span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* after PCF&larr;, normally<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">nop, Branch[opNOP];<br><br>IFUpause[261, 3, ifuBR, 0, opJUMPXX, noNData, 0, 0];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt monospace"><br>*--------------------------------------------------------------------<br>opNOP:<br>*--------------------------------------------------------------------<br>   NextOpcode;<br><br>regOP1[376, ifuBR, opNOP, noNData];<br><br><br><br></span><span style="font: 10pt monospace">:if[Debugging];<br></span><span style="font: 10pt monospace"><br></span><span style="font: 10pt monospace">*--------------------------------------------------------------------<br>SUBROUTINE;</span><span class="tab" val="24"></span><span style="font: 10pt monospace">NEXTOP: GLOBAL, * Debugging checks after each opcode <br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">RBase&larr; RBase[PSTATE];<br></span><span style="font: 10pt monospace">KnowRBase[LTEMP0];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">PSTATE&larr; (PSTATE) and not (PS.PCXBAD);<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu#0], LTEMP1&larr; Link;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">ifuJump[0];<br>TOP LEVEL;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">uCodeCheck[PSTATEbitsAtEndOfOp];<br></span><span style="font: 10pt monospace"><br></span><span style="font: 10pt monospace">:endif;<br></span><span style="font: 10pt monospace"><br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
