<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;LispCore>Dove>BBInit1.mc!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt sans-serif">{<br>File name bbInit1.mc<br>Description: Modified for Lisp, Mesa BitBlt op-code<br>Purcell July 14, 1982  10:38 PM Bit offset correction + PC correct (see ***)<br><br>Description: Mesa BitBlt op-code<br>Sandman November 2, 1981  2:28 PM New Instruction Set<br>Last edited by Jim August 20, 1981  2:20 PM: Fix for new assembler. <br>Last edited by Jim Frandeen: March 31, 1981  8:39 AM: Change SrcMapRet from Mod 8 to Mod 10.<br>Last edited by Don Charnley: March 6, 1981  1:48 PM: Fixed PageFault/64K cross interaction problem.<br>Last edited by Don Charnley: March 3, 1981  4:08 PM: Moved UWidth into stack, no memory reads after int and pf, stack now has 12&rsquo;d things.<br>Last edited by Olmstead: February 27, 1981  2:51 PM<br>Last edited by Don Charnley: February 26, 1981  2:35 PM: Add changes for new stack size to save 10 instructions.<br>Author: don charnley<br>Created: January, 1980<br>}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt sans-serif"><br><br>@BITBLT:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Save R and RH registers}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">ULsave &larr; L, L2 &larr; 0, CALL[SavebbRegs],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{SaveRegs subroutine here {2 2/3 Clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2-c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif"> rhType &larr; Type.normal, push</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[0,10,SavebbRegsRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; ErrnIBnStkp, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, DISP4[HowBigStack,06]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{move BitBltArg to stack and rh}<br>bbNormEntry: {non-interrupts come here}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{get real address of BitBltArg}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{and insure that it is 0 mod 16}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; UBitBltArg,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[hbs.2,10,HowBigStack];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{rhVS = rhMDS, so no need to load it}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; VS and ~0{F***}, L2 &larr; sd.spec</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; argMap, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{SrcMapSpec subroutine here {2 Clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br>bbGetArg:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{move BitBltArg to U registers}<br><br>{rtn here}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 8], L0 &larr; 0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[argMap,10,SrcMapRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{UWidth}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 0A], L0 &larr; 1</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[0,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UWidth &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{UFlags}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 3], L0 &larr; 2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[1,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UFlags &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{UDstBpl}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 7], L0 &larr; 3</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[2,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstBpl &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{SrcBpl}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 9], L0 &larr; 4</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[3,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcBpl &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{Height}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 0], L0 &larr; 5</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[4,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UHeight &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{DLo}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 6], L0 &larr; 8</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[5,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstVALo &larr; Rbb0, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{SBit}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 5]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[8,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; Rbb0 and 0F, CANCELBR[$,0]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; MD{SHi}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcBit &larr; Q,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 and ~0F,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 LRot12,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 4],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,0],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; MD{SLo},</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 + Q, CarryBr,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcVALo &larr; Rbb0, BRANCH[bbbitsrcok, bbbitsrcnok],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br><br>bbbitsrcnok:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; Rbb1 + 1, GOTO[bbbitsrcend],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br>bbbitsrcok:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">GOTO[bbbitsrcend],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br>bbbitsrcend:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 2], L0 &larr; 0A</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UrhVS &larr; Rbb1, CANCELBR[MDtoRbb0,0], L0Disp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{MDtoRbb0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; MD{DBit}, DISP4[MDtoRbb0Ret]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MAR &larr; [rhSrcA,SrcA + 1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[0A,10,MDtoRbb0Ret];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; Rbb0 and 0F, CANCELBR[$,0]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; MD{DHi}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstBit &larr; Q,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 and ~0F,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 LRot12,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UDstVALo,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 + Q, CarryBr,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstVALo &larr; Rbb0, BRANCH[bbbitdstok, bbbitdstnok],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br>bbbitdstnok:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; Rbb1 + 1, GOTO[bbbitend],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br><br>bbbitdstok:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">GOTO[bbbitend],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c1;<br>bbbitend:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVS &larr; UrhVS,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UrhVD &larr; Rbb1,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Ybus &larr; UFlags, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVD &larr; UrhVD, BRANCH[FsetUp,$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{if direction backward, mod SrcVA and DstVA}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Note:  gray is always forward}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Backwards SetUp}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; UWidth</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; TempBpl - 1, rhWho &larr; sdWidth, CALL[DstVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{DstVAMod subroutine here {4 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2-c1;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; UWidth</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[sdWidth,4,DstVAModRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; TempBpl - 1, CALL[SrcVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{SrcVAMod subroutine here {4 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{interrupt entry goes thru this code}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{restore rh from u regs}<br><br>BandBLTNormEntry:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVS &larr; UrhVS, GOTO[rhfromu]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[hbs.C,10,HowBigStack];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVS &larr; UrhVS, GOTO[rhfromu]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[hbs.D,10,HowBigStack];<br>rhfromu:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVD &larr; UrhVD</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>FsetUp:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>TextBltToBitBltEntry:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb3{W} &larr; UWidth</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[sdWidth,4,SrcVAModRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{W-1} &larr; Rbb3{W} - 1, NegBr {test if width = 0}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; 0F, BRANCH[$,Widtheq0]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; Rbb2 LRot12</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb2 and Rbb3, ZeroBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; 8, BRANCH[wnotsmall,wsmall]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>wnotsmall:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; 2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; Q or rhType</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhType &larr; Q LRot0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>wsmall:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb4 &larr; UFlags, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb3 &larr; Rbb4 LRot4, BRANCH[DirFor,DirBack]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br>DirFor:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; 0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{W-1} &larr; Rbb0{W-1}, GOTO[uwwpos]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>DirBack:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; 0 - Rbb0, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{0-(W-1)} &larr; 0 - Rbb0{W-1}, BRANCH[uwwpos,uwwneg]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>uwwpos:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; Rbb2 and ~0F, GOTO[conL13]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>uwwneg:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; Rbb2 or 0F, GOTO[conL13]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>conL13:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; Rbb2 LRot12{this only used for PgCarry and sign check}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UWidthM1 &larr; Rbb0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UWidthW &larr; Rbb2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; UHeight, ZeroBr {test if height = 0}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{L3 &larr; 0,,gr,,0,,sF}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{gr and srcFunc}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; LRot1 Rbb3, BRANCH[$,Heighteq0]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 and 3</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 + 6</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0 and 5, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; dtRet.L3, L3 &larr; 0, XDisp, DISP4[dT]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{dT subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{dstFunc and dir}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb4 LRot8</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dtRet.L3,10,dTRets];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 and 6</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0 or Rbb1, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; dtRet.L1, L1 &larr; 0, XDisp, DISP4[dT]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{dT subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; UDstBpl</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dtRet.L1,10,dTRets];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0 and 0F, ZeroBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; dbneq0, grDisp, BRANCH[dstwn0,$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; USrcBpl, grDISP[srcgrchk]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; 1, XDisp, GOTO[srcchk]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[gr.gray,grM,srcgrchk];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0 and 0F, ZeroBr, GOTO[srcchk]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[gr.notgray,grM,srcgrchk];<br>srcchk:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; sbneq0, BRANCH[sbnot0,sbis0]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>sbis0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UrefillType &larr; dbsb0, GOTO[SetUpAllC1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>sbnot0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UrefillType &larr; Rbb1{sbneq0}, GOTO[SetUpAllC1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>dstwn0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UrefillType &larr; Rbb1{dbneq0}, CANCELBR[SetUpAllC1,0F]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">ITEM REFILL</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{updateHeight, test if thru}<br>ItemRefill3:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; UHeight, L2 &larr; sd.src</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; Rbb0 - 1, ZeroBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UHeight &larr; Rbb0, grDisp, BRANCH[$,bbNormExit]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhWho &larr; sdBpl, grDISP[srcgrayornot]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>{notGray}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; USrcBpl, CALL[SrcVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[gr.notgray,grM,srcgrayornot];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{SrcVAMod subroutine {4 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2-c1;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{will return to dstUphere}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{update Src address}<br>{gray}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{max} &larr; UGray</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[gr.gray,grM,srcgrayornot];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1{cur} &larr; Rbb0 LRot8</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{max} &larr; Rbb0 and 0F, ZeroBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1{cur} &larr; Rbb1 and 0F, BRANCH[$,dstUphere]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1{cur+1} &larr; Rbb1{cur} + 1</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0{max} - Rbb1{cur+1}, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; Rbb1 LRot8, BRANCH[$,GrayWrap]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{not gray wrap}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UGray &larr; Rbb1 xor Rbb0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{usva} &larr; USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{usva+1} &larr; Rbb2{usva} + 1, PgCarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, BRANCH[$,GrayNewPage]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcVALo &larr; Rbb2{usva+1}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">GOTO[dstUphere]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>GrayNewPage:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop ,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; 10, CALL[SrcVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>GrayWrap:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UGray &larr; Rbb0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1{maxX10} &larr; Rbb0{max} LRot4</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{usva} &larr; USrcVALo</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2{usva-max} &larr; Rbb2{usva} - Rbb0{max}, PgCarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, BRANCH[GrayWrapNewPage,$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcVALo &larr; Rbb2{usva-max}, GOTO[dstUphere]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>GrayWrapNewPage:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; 0 - Rbb1{maxX10}, CALL[SrcVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{update Dst address}<br>dstUphere:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; UDstBpl, CALL[DstVAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[sdBpl,4,SrcVAModRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{DstVAMod subroutine {4 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3-c2;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{will return to IntTest}<br><br>IntTest:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UWidthM1, MesaIntBr,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3, at[sdBpl,4,DstVAModRet];<br>wdcTest:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; uWDC, ZeroBr, BRANCH[bbNoInt, MaybeInt]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>MaybeInt:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; uWP, ZeroBr, BRANCH[bbNoWDC, bbWDC]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>bbWDC:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">ClrIntErr, BRANCH[bbDoInt, $]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, GOTO[bbNoInt]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{no mesa interrupt}<br>bbNoWDC:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{ClrIntErr, }CANCELBR[$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>bbNoInt:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; UrefillType, XDisp, CANCELBR[SetUpTest]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br>SetUpTest:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; USrcBit + Q, NibCarryBr, LOOPHOLE[niblTiming], DISP2[SetUpAllC1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>SetUpAllC1:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Lcount &larr; number of dest words to be written minus 1 }<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1 &larr; UDstBit, dirDisp, CANCELBR[$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dbneq0,4,SetUpAllC1];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; Rbb1 and 0F, dirDISP[lcx]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; 10 - Lcount</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.backwards,dirM,lcx];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; ~UWidthM1, GOTO[lccont]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0 &larr; UWidthM1</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.forward,dirM,lcx];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, GOTO[lccont]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>lccont:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; Lcount + Rbb0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; Lcount and ~0F</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Umask1 &larr; Rmask[0 - DstBit]}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; 0F - Rbb1{db}, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; maskRet.f1, XDisp, DISP4[MaskTbl]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{MaskTbl subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; Lcount LRot12, dirDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[maskRet.f1,10,MaskRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">ULcntsav &larr; Lcount, dirDISP[m2set]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{FORWARD MASKS HERE}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Umask1 &larr; Rbb2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.forward,dirM,m2set];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{-w+1} &larr; 0 - Rbb0{w-1}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0{-w+1} - Rbb1{db} - 1, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; maskRet.f2, XDisp, DISP4[MaskTbl]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{MaskTbl subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; RShift1 ~Rbb2, SE &larr; 1, GOTO[stum2]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[maskRet.f2,10,MaskRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{BACKWARDS MASKS HERE}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; RShift1 ~Rbb2, SE &larr; 1</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.backwards,dirM,m2set];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Umask1 &larr; Rbb2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Umask2 &larr; Rmask[width - DstBit - 1]}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0{w-2} - Rbb1{db}, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; maskRet.b2, XDisp, DISP4[MaskTbl]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{MaskTbl subroutine here</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br><br>stum2:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Umask2 &larr; Rbb2</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[maskRet.b2,10,MaskRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{L0 &larr; skew + 2}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{sb} &larr; USrcBit, dirDisp, CANCELBR[$]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[sbneq0,4,SetUpAllC1];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb1{db} &larr; UDstBit, dirDISP[WhichMasks]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Q &larr; Rmask[SrcBit - DstBit]}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0{sb} - Rbb1{db} - 1, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.forward,dirM,WhichMasks];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; maskRet.fQ, XDisp, DISP4[MaskTbl]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{MaskTbl subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">GOTO[setL0] {leave pre-Qmask in Rbb2}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[maskRet.fQ,10,MaskRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Q &larr; Lmask[DstBit - SrcBit]}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Rbb0{sb} - Rbb1{db}, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.backwards,dirM,WhichMasks];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; maskRet.bQ, XDisp, DISP4[MaskTbl]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{MaskTbl subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; RShift1 ~Rbb2, SE &larr; 1, GOTO[setL0] {leave pre-Qmask in Rbb2}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[maskRet.bQ,10,MaskRet];<br><br>setL0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb0{skew} &larr; Rbb0{sb} - Rbb1{db}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[]{skew+2} &larr; Rbb0{skew} + 2, YDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; dtRet.L0, L0 &larr; 0, XDisp, DISP4[dT]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{dT subroutine here {1 cycle}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">scDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[dtRet.L0,10,dTRets];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UWidthM1, sc3DISP[FixQ]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; LRot1 Rbb2, GOTO[SavQval]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[0D,10,FixQ];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rbb2 &larr; RRot1 Rbb2, GOTO[SavQval]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[0F,10,FixQ];<br><br>SavQval:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UmaskL &larr; Rbb2, L2 &larr; sd.src</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; USrcBit + Q, NibCarryBr, {L2 &larr; sd.src},  LOOPHOLE[niblTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br><br><br>TouchSourcePages:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UWidthW, NegBr, BRANCH[oldWords,newWords]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dbsb0,4,SetUpAllC1];<br>oldWords:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">BRANCH[oldposchks,oldnegchks]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>newWords:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; Q + 1, PgCarryBr, BRANCH[newposchks1,newnegchks1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>oldposchks:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, GOTO[oldposs1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>oldnegchks:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, GOTO[oldnegs1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>newposchks1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, BRANCH[oldposs1,newposs1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>newnegchks1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, BRANCH[newnegs1,oldnegs1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>oldposs1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; USrcVALo + Q, PgCarryBr, DISP3[SrcsmallP,5], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>newposs1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,7]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, CANCELBR[pospgs,1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.notsmall,typeM,SrcsmallP];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; MapOne, BRANCH[posnopgs,pospgs]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.small,typeM,SrcsmallP];<br><br>newnegs1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; USrcVALo + Q , PgCarryBr, DISP3[SrcsmallN,5], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>oldnegs1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; 1, XDisp, DISP3[SrcsmallN,5]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; MapOne, BRANCH[negpgs,negnopgs]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.small,typeM,SrcsmallN];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, CANCELBR[pospgs,1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.notsmall,typeM,SrcsmallN];<br><br>pospgs:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; USrcVALo, grDisp, GOTO[smapmore]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>negpgs:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; USrcVALo, grDisp, GOTO[smapmore]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>smapmore:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; USrcBit, grDISP[schkgray]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; srcTP</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[gr.notgray,grM,schkgray];<br>callva:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; UWidthM1, CALL[VAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{VAMod subroutine here {2 or 3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; rhVS + TempBpl, GOTO[fixrhVS], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[Or[srcTP,1],8,VAModRet];<br><br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB{old} &larr; USrcVALo, GOTO[comA]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[srcTP,8,VAModRet];<br>comA:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q{new hi} &larr; Q and ~0FF, dirDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{old hi} &larr; TempB and ~0FF, dirDISP[comA.1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num hi} &larr; Q{new hi} - TempBpl{old hi}, GOTO[comX]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.forward,dirM,comA.1];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num hi} &larr; TempBpl{old hi} - Q{new hi}, GOTO[comX]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.backwards,dirM,comA.1];<br>comX:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB{old low} &larr; TempB{old} and 0FF</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB{old low} or Q{new hi}, sdDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num low} &larr; TempBpl LRot8, sdDISP[comB]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; TempB</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[sd.src,sdM,comB];<br>csrc:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; sdMap, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>sSnonewrhF:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; USrcVALoSav, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>sSnonewrhB:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; USrcVALoSav, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">SrcMapSpec subroutine here  2  clicks</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; TempBpl - 1, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[sdMap,10,SrcMapRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; 0FF + 1, dirDisp, BRANCH[srcmore,srcthru]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>srcmore:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; USrcVALoSav, dirDISP[y.f]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB - VS, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.forward,dirM,y.f];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcVALoSav &larr; TempB, BRANCH[sSnewrhF,sSnonewrhF]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>sSnewrhF:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; rhVS - 1, LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>y.c:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVS &larr; VS LRot0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CALL[SrcMap]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB + VS, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.backwards,dirM,y.f];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">USrcVALoSav &larr; TempB, BRANCH[sSnonewrhB,sSnewrhB]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>sSnewrhB:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; rhVS + 1, GOTO[y.c], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>srcthru:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,Sub[dirM,2]]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Mask2 &larr; Umask2 {Mask2 = VS}, GOTO[sss]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; MapOne, GOTO[posnopgs]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[gr.gray,grM,schkgray];<br><br>posnopgs:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; USrcVALo, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>negnopgs:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VS &larr; USrcVALo, CALL[SrcMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">SrcMapSpec subroutine here  2 clicks</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br>srcFin:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Mask2 &larr; Umask2 {Mask2 = VS}, GOTO[sss]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[MapOne,10,SrcMapRet];<br>sss:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UWidthM1</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; UDstBit + Q, NibCarryBr, L2 &larr; sd.dst, LOOPHOLE[niblTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>TouchDestPages:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UWidthW, NegBr, BRANCH[oldWordd,newWordd]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>oldWordd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">BRANCH[oldposchkd,oldnegchkd]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>newWordd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; Q + 1, PgCarryBr, BRANCH[newposchkd1,newnegchkd1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>oldposchkd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, GOTO[oldposd1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>oldnegchkd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, GOTO[oldnegd1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>newposchkd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, BRANCH[oldposd1,newposd1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>newnegchkd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, BRANCH[newnegd1,oldnegd1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>oldposd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; UDstVALo + Q, PgCarryBr, DISP3[DstsmallP,5], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>newposd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,7]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, CANCELBR[pospgd,1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.notsmall,typeM,DstsmallP];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; MapOne, BRANCH[posnopgd,pospgd]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.small,typeM,DstsmallP];<br><br>newnegd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; UDstVALo + Q, PgCarryBr, DISP3[DstsmallN,5], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br>oldnegd1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; 1, XDisp, DISP3[DstsmallN,5]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; MapOne, BRANCH[negpgd,negnopgd]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.small,typeM,DstsmallN];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, CANCELBR[pospgd,1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[type.notsmall,typeM,DstsmallN];<br><br>pospgd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UDstVALo, GOTO[dmapmore]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>negpgd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UDstVALo, GOTO[dmapmore]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>dmapmore:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; UDstBit</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; dstTP, GOTO[callva]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{callva:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; UWidthM1, CALL[VAMod]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{VAMod subroutine here {2 or 3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; rhVD + TempBpl, GOTO[fixrhVD], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[Or[dstTP,1],8,VAModRet];<br><br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB{old} &larr; UDstVALo, GOTO[comA]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dstTP,8,VAModRet];<br>{comA:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q{new hi} &larr; Q and ~0FF, dirDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{old hi} &larr; TempB and ~0FF, sdDisp, dirDISP[comA.1]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num hi} &larr; Q{new hi} - TempBpl{old hi}, GOTO[comX]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.forward,dirM,comA.1];}<br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num hi} &larr; TempBpl{old hi} - Q{new hi}, GOTO[comX]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.backwards,dirM,comA.1];}<br>{comX:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB{old low} &larr; TempB{old} and 0FF</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;}<br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB{old low} or Q{new hi}, sdDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl{num low} &larr; TempBpl LRot8, sdDISP[comB]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; TempB{first touch address}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2, at[sd.dst,sdM,comB];<br>cdst:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhRet &larr; sdMap, CALL[DstMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>dSnonewrhF:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; UDstVALoSav, CALL[DstMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>dSnonewrhB:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; UDstVALoSav, CALL[DstMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DstMapSpec subroutine here  2 clicks</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempBpl &larr; TempBpl - 1, NegBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[sdMap,4,DstMapRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; 0FF + 1, dirDisp, BRANCH[dstmore,dstthru]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>dstmore:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; UDstVALoSav, dirDISP[y.fx]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB - VD, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.forward,dirM,y.fx];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstVALoSav &larr; TempB, BRANCH[dSnewrhF,dSnonewrhF]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>dSnewrhF:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; rhVD - 1, LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>y.cx:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">rhVD &larr; VD LRot0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CALL[DstMap]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">TempB &larr; TempB + VD, CarryBr</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[dir.backwards,dirM,y.fx];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UDstVALoSav &larr; TempB, BRANCH[dSnonewrhB,dSnewrhB]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>dSnewrhB:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; rhVD + 1, GOTO[y.cx], LOOPHOLE[byteTiming]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>dstthru:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,Sub[dirM,2]]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; ULcntsav, GOTO[detLoop]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br>posnopgd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; UDstVALo, CALL[DstMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>negnopgd:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">VD &larr; UDstVALo, CALL[DstMapSpec]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DstMapSpec subroutine here  2 clicks</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1-c3;}<br><br>dstFin:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Lcount &larr; ULcntsav, GOTO[detLoop]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[MapOne,4,DstMapRet];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{determine loop and entry point}<br>detLoop:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Mask1 &larr; Umask1, grDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; UmaskL, grDISP[chooseLoop]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{if gray then Entry to L1 and L2D at L1I1lsar}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Entry to L4}<br>L4SetUp:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dirDisp, Dst &larr; UDstBit{Dbit}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[gr.notgray,grM,chooseLoop];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Src &larr; USrcBit{Sbit}, dirDISP[CheckL4Init]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{forward: fetch 1 if Dbit &gt;= Sbit, else fetch 2}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Dst{Dbit} - Src{Sbit}, NibCarryBr, GOTO[L4I1lsar]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.forward,dirM,CheckL4Init];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{backwards: fetch 1 if Sbit &gt;= Dbit, else fetch 2}<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; Src{Sbit} - Dst{Dbit}, NibCarryBr, GOTO[L4I1lsar]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[dir.backwards,dirM,CheckL4Init];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Exits}<br><br>Heighteq0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>bbNormExit:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[$,Sub[grM,1]]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>Widtheq0:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">[] &larr; rhType, XDisp, L0 &larr; restore.term</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">stackP &larr; 0, DISP3[LSEPReturn,2]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{will go to RestoreRandRHRegs if not LSEP}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{RestoreRandRHRegs subroutine {2 1/3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3-c3;}<br><br>BBExit:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Xbus &larr; uPCCross, XLDisp}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[restore.term,10,RestoreCallers];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop,{ DISP2[$, BBSetInt, 1]}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>{</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Noop, GOTO[BBThru]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;}<br>BBSetInt:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">MesaIntRq, GOTO[BBThru]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br><br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{Mesa Interrupt}<br><br>bbDoInt:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">stackP &larr; 0C</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">L0 &larr; restore.int</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; rhType, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DISP3[MoverhVToStkandRestore,3]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{RestoreRandRHRegs subroutine {2 1/3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2-c2;}<br><br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c3, at[restore.int,10,RestoreCallers];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">GOTO[SaveRegs]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{PAGE FAULTS}<br><br>DFault:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UVSsave &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">uFaultParm0 &larr; VD</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; rhVD, GOTO[pfCom]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br><br>SFault:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">UVSsave &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">uFaultParm0 &larr; VS, sdDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Q &larr; rhVS, sdDISP[pfCom]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>pfCom:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">stackP &larr; 0C, GOTO[bbDoFault]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[sd.src,sdM,pfCom];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">stackP &larr; 1, GOTO[bbDoFault]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[sd.spec,sdM,pfCom];<br><br>bbDoFault:<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">uFaultParm1 &larr; Q</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">L0 &larr; restore.pf</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; rhType, XDisp</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DISP3[MoverhVToStkandRestore,3]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{RestoreRandRHRegs subroutine {2 1/3 clicks}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2-c2;}<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">T &larr; UVSsave {Trap index}</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3, at[restore.pf,10,RestoreCallers];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Rx &larr; pFault, GOTO[SaveRegs]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="66"></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">{END}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
</div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
