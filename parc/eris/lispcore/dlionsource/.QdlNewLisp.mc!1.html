<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>File [eris]&lt;LispCore>DLionSource>QdlNewLisp.mc!1</title>
  </head>
  <body>
    <pre>
{File name QdlNewLisp.mc}SetTask[0];{******************************************************************	READFLAGS*******************************************************************}READFLAGS:	Xbus &larr; TOSH xor smallpl, NZeroBr,	c1, opcode[161'b]; {71}	rhTT &larr; TT &larr; TOS LRot8, BRANCH[$, rdfUfn],	c2;	TOSH &larr; smallpl,	c3;	Map &larr; [rhTT, TT],	c1;	TOS &larr; 60, L2 &larr; L2.0,	c2;	TOS &larr; MD and TOS, XRefBr,	c3;	TOS &larr; TOS LRot8, BRANCH[rmNoRef, rmRef],	c1;rmNoRef:	TOS &larr; TOS RShift1, SE&larr;0, IBDisp, GOTO[DNI.pc1],	c2;rmRef:	TOS &larr; TOS RShift1, SE&larr;1, IBDisp, GOTO[DNI.pc1],	c2;rdfUfn:	Rx &larr; 161'b, GOTO[ufn1],	c3;{******************************************************************	READRP*******************************************************************}READRP:	Xbus &larr; TOSH xor smallpl, NZeroBr,	c1, opcode[162'b];	rhTT &larr; TT &larr; TOS LRot8, BRANCH[$, rdrpUfn],	c2;	TOSH &larr; smallpl,	c3;	Map &larr; [rhTT, TT],	c1;	TOS &larr; ~0F0, L2 &larr; L2.0,	c2;	TOS &larr; MD and TOS,	XDirtyDisp, c3;	PC &larr; PC + PC16, BRANCH[$, rrpi, 1],	c1;	IBDisp, GOTO[rrpj],	c2;rrpi:	TOS &larr; TOS + 0F + 1, IBDisp, GOTO[rrpj],	c2;rrpj:	TOS &larr; TOS LRot8, L2 &larr; L2.0, DISPNI[OpTable],	c3;rdrpUfn:	Rx &larr; 162'b, GOTO[ufn1],	c3; {******************************************************************	WRITEMAP*******************************************************************}WRITEMAP:   {vp, rp, flag =&gt; vp}	MAR &larr; [rhS, S], S &larr; S -1,	c1, opcode[163'b];{73}	Ybus &larr; TOSH xor smallpl, NZeroBr, CANCELBR[$, 2],	c2;	Rx &larr; MD{rp}, BRANCH[$, ufnWM0],	c3;	MAR &larr; [rhS, S + 0],	c1;	S &larr; S -1, 	c2;	Q &larr; MD{rpH},	c3;	MAR &larr; [rhS, S], S &larr; S -1,	c1;	Ybus &larr; Q xor smallpl, NZeroBr, CANCELBR[$,2],	c2;	TT &larr; MD{vp}, BRANCH[$, ufnWM1],	c3;	MAR &larr; [rhS, S+0], L2 &larr; L2.0,	c1;	Rx &larr; Rx LRot8,	 XRefBr{&gt;2mb}, c2;	Q &larr; MD{vpH},	BRANCH[$, wmi], c3;		Noop, GOTO[wmj],	c1;wmi:	Rx &larr; Rx or 80, GOTO[wmj],	c1;wmj:	Ybus &larr; Q xor smallpl, NZeroBr,	c2;	rhTT &larr; TT &larr; TT LRot8, BRANCH[$, ufnWM2],	c3;	S &larr; S -1, Xbus &larr; TOS LRot4, XDisp,	c1;	Rx &larr; Rx and ~070, DISP4[wmf, 4],	c2;	Rx &larr; Rx or 0, GOTO[wMap],	c3, at[4, 10, wmf];	Rx &larr; Rx or 10, GOTO[wMap],	c3, at[0C,10,wmf];	Rx &larr; Rx or 20, GOTO[wMap], 	c3, at[5, 10, wmf];	Rx &larr; Rx or 30, GOTO[wMap],	c3, at[0D,10,wmf];	Rx &larr; Rx or 40, GOTO[wMap],	c3, at[6, 10, wmf];	Rx &larr; Rx or 50, GOTO[wMap],	c3, at[0E,10,wmf];	Rx &larr; Rx or 60, GOTO[wMap],	c3, at[7, 10, wmf];	Rx &larr; Rx or 70, GOTO[wMap], {reserved}	c3, at[0F,10,wmf];wMap:	Map &larr; [rhTT, TT],	c1;	MDR &larr; Rx, PC &larr; PC + PC16, IBDisp,	c2;	TOS &larr; TT LRot8, L2 &larr; L2.0, DISPNI[OpTable],	c3;ufnWM0:	S &larr; S+1, GOTO[ufnX2],	c1;ufnWM1:	S &larr; S+3, GOTO[ufnX2],	c1;ufnWM2:	S &larr; S+3, GOTO[ufnX2],	c1;{******************************************************************}PFault:	, at[BBFault],	rhRx &larr;  INTERFACEspace, 	c1;	Rx &larr; INTERFACEbasePage{20'b}{INTERFACEbase=10000'b},	c2;	Rx &larr; Rx LRot8, GOTO[PFaultcont],	c3;{******************************************************************}{% SHOULD CHECK IF ANY PENDING INTERRUPTS - CURRENTLY MAY MISS KEYSTROKES }opcode[176'b],{7E}	Ybus &larr; TOS xor FAULTFXP, ZeroBr{faultExit}, L2&larr; 0{NotInCall},	c1;	Rx&larr; TOS, BRANCH[$,  SwFault],	c2;	TOSH &larr; 0, CANCELBR[ConJn],	c3;SwFault:	TOSH &larr; 0,	c3;ConJn:	uWDC &larr; TOSH, PC&larr; PC + PC16 {advance PC}, GOTO[PuntFor2],	c1;{note that this code winds up storing the context number on the stack and thensetting the no-push bit in the frame. This is not exactly the same as the Dorado, but no code relies on the value returned "to" a context}{******************************************************************}MidPuntmar:	MAR &larr; [rhTT, Q + 0],	c1;	MDR{next} &larr; PV, Rx &larr; Rx{punt}-1, ZeroBr{KeyFXP},	c2;	PV &larr; MD, BRANCH[RTN2, RTN2K],	c3;{******************************************************************}	{ E N D }</pre>
  </body>
</html>
