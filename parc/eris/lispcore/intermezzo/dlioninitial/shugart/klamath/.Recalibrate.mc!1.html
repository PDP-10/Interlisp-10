<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;LispCore>Intermezzo>DlionInitial>Shugart>Klamath>Recalibrate.mc!1</title>
  </head>
  <body>
    <div style="width: 491pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{Recalibrate.mc  debugging hack for Initial.mc  <br>last edit by Jim Frandeen December 16, 1981  3:29 PM: remove stepCount RegDef}<br><br>SetTask[0];<br><br>{control bits, high byte}</span><span class="tab" val="314"></span><span style="font: 8pt serif">Set[driveSelectBit, 4], Set[faultClearBit, 2];<br>{useful combinations}</span><span class="tab" val="79"></span><span style="font: 8pt serif">Set[faultClearCmd, Or[driveSelectBit, faultClearBit]];</span></div>
<div style="width: 491pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>recal:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; 20, CANCELBR[$, 0F],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">stepCount&larr; rE,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; faultClearCmd,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl&larr; rE LRot8,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl&larr; 0,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>recal0:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus&larr; KStatus, XRefBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; driveSelectBit, BRANCH[$, recal1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2; {check for drive ready}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; KCtl&larr; rE LRot8, GOTO[recal0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{disk is ready}<br>recal1:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; driveSelectBit,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {step out first}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; rE LRot8,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; rE or inBit,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl&larr; rE LRot0,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{Step bit must be high for at least one microsecond and then low for at least one microsecond.  Since a click is 411 ns, stepBit can change only once every third click.}<br><br>check00:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; ~KStatus, CANCELBR[$, 1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[0B, 10, check00];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; rD LRot8, XDisp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2; {pick up status}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">[]&larr; rD and 2, ZeroBr, DISP4[check00, 0B],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {check for seek complete}<br><br>seekComplete:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; rE or stepBit, BRANCH[at00, $],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[0F, 10, check00];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl&larr; rE LRot0,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; 3,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br>seekWait:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; rE and ~stepBit,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; rD-1, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">BRANCH[seekWait, $],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; stepCount, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl&larr; rE LRot0, BRANCH[$, countedOut],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; rD-1,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">stepCount&larr; rD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[check00],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>countedOut:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; rE and inBit,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">[]&larr; rD, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rE&larr; rE xor inBit, BRANCH[$, recalLost],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; 0FF+1, {max is 256 cylinders  for SA1000}</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rD&larr; LShift1 rD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">stepCount&larr; rD, GOTO[check00],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>recalLost:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[recalLost],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>at00:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br>at000:</span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[at00],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
