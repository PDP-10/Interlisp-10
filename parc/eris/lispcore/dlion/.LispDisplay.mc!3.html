<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;LispCore>dlion>LispDisplay.mc!3</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: 8pt sans-serif">{File name:  LispDisplay.mc<br>Last Edit:  30-Jul-83 16:44:26<br>Fixed bank 0 core smash bug Purcell 30-Jul-83 16:44:20<br>Modified for variable display rate by don  1-Jul-83 14:54:22<br> Description: Dandelion Display Microcode: "Do not attempt to adjust your set.  We control the vertical, we control the horizontal."<br> Author: R. Garner (based on previous version by R. Crane, Pitts Jarvis)<br> Created: April 15 1980,<br> Edited: R. Garner, May 19, 1980  6:20 PM}<br>{Edited: Purcell, July 15, 1982  8:57 PM}{adapted for current use}<br><br>{NOTE: There is a good chance this code can be written without register "Line"!!<br><br>The number of refreshes per scan line required is<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">(128 Refreshes/2 mSec)(28.8 uSec/Line) = 1.8 Refreshes/Line<br><br>This code assumes a total of 897 (381&rsquo;x) Lines per Frame:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif"> 26</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Top Border<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">808</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Field<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif"> 28</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Bottom border<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">   4</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Blanking<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif"> 27</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Vert Sync (14 even, 13 odd) <br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">   4</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">End Vert Sync<br>}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">SetTask[1];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">StartAddress[DisplayStart];<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Initilization<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br>{Note: u7FF, u1FFF, and u3FFF should be initialized by the Emulator task}<br><br>DisplayStart:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; LShift1 0FF, SE&larr;1, CANCELBR[$, 0F]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; LShift1 dX, SE&larr;1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">r9u3FF &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; 14&rsquo;d,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uBBTime &larr; dX,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c2;{initialize for standard display rate}<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif"><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rhdY &larr; uIOPage, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; IOPage</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX LRot8</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX or DCBLoc</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDCBLoc &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX + cursorMapLoc</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uInitCurMapAddr &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; PicLenShifted</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; Line LRot8</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uInitCurBufAddr &larr; dX, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; LRot1 Line</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; LRot1 Line, rhLine &larr; 0</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rBuInitPicLength &larr; Line {328&rsquo;x}, ClrDPRq</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; 0, GOTO[EndVSync]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">End Vertical Sync<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>{1st line of "End Vertical Sync" (4 clicks): Init cursor copy loop count; fetch & load border register; fetch wakeup mask.}<br><br>EndVSync:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; 7, L5 &larr; L5.evs2, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[And[VSyncTime, 0F],10,HibernateRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCopyCount &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uDCBLoc</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY + cursorYLoc]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DCtl &larr; EndVSync, CANCELBR[$, 0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; MD{cursorY}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY + WakeupLoc]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; dX, CANCELBR[$, 0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; MD{WakeupMask}, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{2nd line of "End Vertical Sync" (4 clicks): Fetch exit length value and invert and blank bits.  If the display is turned off, the microcode executes as usual except there is border pattern everywhere instead of picture. Format of control bits:<br>  0: 1=&gt; off,<br>  4: 1=&gt; Invert,<br>  5: 1=&gt; disconnect (presently ignored),<br>  6-15: scan line wake count}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY + BorderLoc], L5 &larr; L5.tb1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.evs2,10,SleepRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDWakeup &larr; dX, CANCELBR[$, 0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; MD{BorderPattern}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY + DBitsLoc]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DBorder &larr; dX, dY &larr; ~1, CANCELBR[$, 0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; MD and dY{ScanLineWakeup and ~1}, XHDisp</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uExitLength &larr; dX, Refresh, DISP2[NormOn]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br>NormOn:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; Pic, GOTO[DisplayNorm]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[0,4,NormOn];<br>NormOff:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; NoPic, GOTO[DisplayNorm]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[1,4,NormOn];<br>InvOn:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; InvPic, GOTO[DisplayInv]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[2,4,NormOn];<br>InvOff:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; NoInvPic, GOTO[DisplayInv]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[3,4,NormOn];<br><br>DisplayNorm:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; NoPic, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br>DisplayInv:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; NoInvPic, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Top Border<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>{Border work involves initializing cursor related registers and copying the lines of the visible area within which the cursor appears into the Cursor Buffer.  The following compuations are made:<br><br>The Line number on which the visible region stops:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uPicLength &larr; rBuInitPicLength or oddField<br><br>The Line number on which a wakeup is caused.:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uExitLength &larr; MIN[(ScanLineWakeup AND ~1) + 2 OR oddField, uPicLength]<br><br>The Line number on which the cursor begins (If CursorY is greater than uPicLength, then no cursor will be displayed):<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; CursorY + ((CursorY xor oddField) and 1)<br><br>The Line number on which the cursor stops:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorStop &larr; uDoCursor + 14&rsquo;d<br><br>The word address of the first word of the cursor bit map in the DCB:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurMapAddr &larr; uInitCurMapAddr + ((CursorY xor oddField) and 1)<br><br>The word address of the first location of cursor in the Visible Region:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurVisAddr &larr; uDoCursor*wordsPerLine + (CursorX RShift4)<br><br>The word address of the first location of the cursor in the Cursor Buffer:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurBufAddr &larr; rBuInitPicLength*wordsPerLine + (CursorX RShift4)<br><br>The Fifo entries for a cursor line where the cursor is in the middle:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo0 &larr; [(CursorX RShift4) - 1,,0]<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo1 &larr; [(CursorX RShift4) + 1,,(rBuInitPicLength-uDoCursor)]<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo2 &larr; [63,,0]<br><br>The Fifo entries for a cursor line where the cursor is at an edge:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">LeftEdge = (CursorX RShift4)=0,<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">RightEdge = (CursorX RShift4)=62 or 63<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo0&rsquo; &larr; IF LeftEdge THEN uCursorFifo1 ELSE [1,,0]<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo1&rsquo; &larr; IF RightEdge THEN uCursorFifo0 ELSE [62,,0]<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo2&rsquo; &larr; IF RightEdge THEN [63,,(rBuInitPicLength-uDoCursor)] ELSE uCursorFifo2<br><br>The Fifo entry for a line without a cursor is [63,,0].<br><br>The mask & shift required to OR the cursor into the visible region are also computed.}<br><br><br>{1st line of "Top Border" (6 clicks): Set uExitLength to min of ScanLineWakeup & InitPicLength.}<br><br>TopBorder:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uStartPic &larr; dX, Refresh, L5 &larr; L5.tb2</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.tb1,10,SleepRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uNoPic &larr; dY</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; Line and 1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; rBuInitPicLength or dY{oddField}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uExitLength or dY{oddField}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY + 2</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY and r9u3FF</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dX - dY, CarryBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uPicLength &larr; dX, BRANCH[BadExitLen, ExitLenOK]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>BadExitLen:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uExitLength &larr; dX, GOTO[PicLen] </span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>ExitLenOK:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uExitLength &larr; dY </span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>PicLen:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uDoCursor {cursorY}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dY xor uClockBits {cursorY xor oddField}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX and 1  {(cursorY xor oddField) and 1}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dX + dY {((cursorY xor oddField) and 1)+cursorY}, DCtl &larr; uNoPic</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; dY, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{2nd line of "Top Border" (7 clicks): Compute uDoCursor, uCurMapAddr, init uCurVisAddr, uCursorStop,  rAuCursorMask, and the cursorShift in rhdX.}<br><br>TopB2:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uInitCurMapAddr or dX, Refresh, L5 &larr; L5.DCycle6</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.tb2,10,SleepRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurMapAddr &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; rBuInitPicLength</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX - dY {rBuInitPicLength - uDoCursor}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorDiff &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dY + 0E {uDoCursor +14&rsquo;d}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorStop &larr; dX, CALL[DCycle6]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{1 click of dX&larr;dY LRot1; dX&larr;dX LRot1; dX&larr;dX LRot4}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurVisAddr &larr; dX  {uDoCursor,,000000}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[L5.DCycle6,10,DCycleRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uDCBLoc</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY + cursorXLoc]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; ~0F, CANCELBR[$, 0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rhdX &larr; dX &larr; MD{cursorX} and dY, XDisp</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dX LRot12  {cursorX RShift4}, DISP4[DMask]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{1 cycle of "dX&larr;mask"</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;}<br>DMaskRet:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rAuCursorMask &larr; dX, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{3rd line of "Top Border" (6 clicks): Compute uCurVisAddr, uCurBufAddr, and preliminary uCursorFifo2.  Set uDoCursor to off screen if CursorX is off screen.}<br><br>TopB3:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; ~3F, L5 &larr; L5.DCycleA</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.DCycle6,10,SleepRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dY and dX {cursorX xor ~3F}, ZeroBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCurVisAddr {uDoCursor,,000000}, BRANCH[$, CursorOn]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; ~dY xor dY, GOTO[CurVisAddr]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>CursorOn:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>CurVisAddr:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurVisAddr &larr; dX or dY {uDoCursor,,cursorX}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uInitCurBufAddr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>CurBufAddr:<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{30-Jul-83 16:43:25 BUG FIX: neg cursorX caused out of range store}<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY and 03F,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif"><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurBufAddr &larr; dX or dY {rBuInitPicLength,,cursorX}, Refresh, CALL[DCycleA]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{1 click of dX&larr;LRot1 dY; dX&larr;LRot1 dX; dX&larr;dX LRot8}<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{dX = cursorX,,0000000000}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; r9u3FF</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2, at[L5.DCycleA,10,DCycleRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo2 &larr; ~dY {111111,,0000000000}, CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{4th line of "Top Border" (3 clicks cursor in middle, 4 clicks cursor on edge): Compute uCursorFifo0, uCursorFifo1, and uCursorFifo2.}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX - dY - 1, Xbus &larr; uStartPic, XDisp, L5 &larr; L5.tb5</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.DCycleA,10,SleepRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo0 &larr; dX {dX=cursorX-1,,0000000000}, BRANCH[SkipCopy, $, 0B]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX+dY+1 {dX=cursorX,,0000000000}, ZeroBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX+dY+1 {dX=cursorX+1,,0000000000}, ZeroBr, Refresh, BRANCH[$, CurAtLeft]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dX+dY+1 {dY=cursorX+2,,0000000000}, NZeroBr, BRANCH[$, CurAt3F0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX or uCursorDiff {cursorX+1,,PicLength - uDoCursor}, BRANCH[CurAt3E0, Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{Cursor is on left or right edge.}<br>CurAtLeft:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX or uCursorDiff {[1,PicLength - uDoCursor]}, CANCELBR[$]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; LShift1 ~dY  {dX=[62,0]}, GOTO[CurEdgeFin]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>CurAt3F0:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCursorDiff {[0,PicLength - uDoCursor]}, CANCELBR[$]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo2 &larr; ~dY xor dX {[63,PicLength - uDoCursor]}, GOTO[CurAtR]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br>CurAt3E0:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo2 &larr; dX {[63,PicLength - uDoCursor]}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>CurAtR:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dY+1 {dX=[1,0]}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uCursorFifo0 {cursorX-1,,0000000000}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>CurEdgeFin:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo0 &larr; dX</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dY</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">CALL[Sleep]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{5th-12th lines of "Top Border" (9 clicks/line): Copy 8 lines from the visible region into the cursor buffer while ORing the cursor bit map into the lines.}<br><br>CopyInit:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCursorFifo1 &larr; dX, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.tb5,10,SleepRet];<br>CopyCursor:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uCurMapAddr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; uCurVisAddr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhdY, dY], dY &larr; dY + 2, L5 &larr; L5.DCycle</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurMapAddr &larr; dY, [] &larr; rhdX, XDisp, CANCELBR[$, 2]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; MD{cursor word}, DISP4[DCycle]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">{1 click of dX&larr;LRot1 dY; dX&larr;LRot1 dX; dX&larr;dX LRotn}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhLine, Line+0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[L5.DCycle,10,DCycleRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dX and rAuCursorMask</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr;MD or dY {visible or Left cursor}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhLine, Line + 1]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX and ~rAuCursorMask, CANCELBR[$, 2]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr;MD or dX {visible or Right cursor}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; Line + 80</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurVisAddr &larr; Line</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; uCurBufAddr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhLine, Line+0]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MDR &larr; dY, dY &larr; uClockBits</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr;dY + 2</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MAR &larr; [rhLine, Line + 1]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">MDR &larr; dX, WriteOK, CANCELBR[$, 2]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; Line + 80 </span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; dY, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCopyCount-1, NibCarryBr, SuppressTimingWarning,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCurBufAddr &larr; Line, ClrDPRq, BRANCH[CopyDone, $] </span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uCopyCount &larr; dX, Refresh, GOTO[CopyCursor]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br>{13th Line of "Top Border" (3+Field clicks):  Update the clock, reset the line number, and preload the CtlFifo (It should be loaded 1 line in advance).  The clock registers must be updated in the same click.}<br><br>CopyDone:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>CDone:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; RShift1 dY {uClockBits/2}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY and 1 {zero line count, preserve oddField}</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uClockLow</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX+Line {uClockLow+uClockBits/2}, CarryBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; uClockHigh, BRANCH[$, UpClkHigh]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockLow &larr; dX, GOTO[CUC]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>UpClkHigh:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockLow &larr; dX, Line &larr; Line + 1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>CUC:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockHigh &larr; Line, L5 &larr; L5.FieldStart</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; dY, CALL[Field]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br><br><br>{If the display is off, do not write into low bank.}<br><br>SkipCopy:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rhdX &larr; dX &larr; OffTime, CALL[Snore]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>CopySkipped:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uClockBits, GOTO[CDone]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[OffTime,10,HibernateRet];<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Visible Field<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>{Line without cursor is 2 clicks, cursor line is 4 clicks, interrupt line is 2 additional clicks.}<br><br>FieldStart:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DCtl &larr; uStartPic, L5 &larr; L5.Field, BRANCH[FieldC, FieldExit]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br><br>Field:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; ~r9u3FF{normal fifo entry}, Refresh, BRANCH[FieldC, FieldExit]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br>FieldC:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dY xor uDoCursor, ZeroBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br>CursorDone:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; dY, BRANCH[$, Cursor]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DCtlFifo &larr; dX + dY, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY + 2, ClrDPRq, pRet5</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dY xor uExitLength, ZeroBr, BRANCH[Field, FieldStart]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br><br><br>Cursor:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dY xor uCursorStop, ZeroBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dY + 2, BRANCH[$, CursorLast]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; dX, GOTO[Curse]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br>CursorLast:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uDoCursor &larr; ~dY xor dY</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>Curse:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCursorFifo0</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DCtlFifo &larr; dX + dY</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCursorFifo1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">DCtlFifo &larr; dX + dY</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uCursorFifo2, GOTO[CursorDone]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br><br><br><br>FieldExit:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uPicLength, CANCELBR[$]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">[] &larr; dY xor dX, ZeroBr</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uExitLength &larr; dX, BRANCH[$, FieldDone]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Noop</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uWP</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; dX or uDWakeup, MesaIntRq</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uWP &larr; dX, GOTO[Field]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>FieldDone:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dY + 2</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; dY, GOTO[BotBorder]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Bottom border<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>BotBorder:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; uNoPic, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;{alu ops in c1 and c2 swapped}<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; uBBTime, ClrDPRq</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">rhdX &larr; BotBordTime,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">CALL[Hibernate],</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">c2;<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Start Vertical Retrace<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br>StartBlk:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; rhdX &larr; BlankTime, Refresh</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[BotBordTime,10,HibernateRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; Blank, CALL[Hibernate]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Vertical Sync<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>StartVSync:</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">uClockBits &larr; Line &larr; Line xor dY{1}, Refresh,</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1, at[BlankTime,10,HibernateRet];<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">Line &larr; Line and 1</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; Line LRot4</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dY &larr; dX or StartVSync</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">dX &larr; VSyncTime + Line, rhdX &larr; VSyncTime, CALL[Hibernate]</span><span class="tab" val="79"></span><span style="font: 8pt sans-serif">,c2;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt sans-serif"><br>{</span><span style="font: 8pt sans-serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt sans-serif"><br></span><span class="tab" val="66"></span><span style="font: bold 8pt sans-serif">Hiber</span><span style="font: 8pt sans-serif">n</span><span style="font: 8pt sans-serif">ate, Sleep<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</span><span style="font: 8pt sans-serif">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>Hibernate:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DCtl &larr; dY LRot0</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br>Snore:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dX - 1, NegBr, Refresh, L5 &larr; L5.Hibernate</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1, at[L5.Hibernate,10,SleepRet];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Xbus &larr; rhdX, XDisp, BRANCH[Winter, Spring]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br>Winter:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">CANCELBR[Sleep, 0F]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br>Spring:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dY &larr; 1, RET[HibernateRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br><br>Sleep:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Line &larr; uClockBits, Refresh</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c1;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">Line &larr; Line + 2, pRet5</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c2;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">uClockBits &larr; Line, ClrDPRq, RET[SleepRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c3;<br><br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DCycle<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}<br><br>DCycle:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dY, Xbus &larr; 0, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 0, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0F,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 0, XDisp, GOTO[DRot1],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0E,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; RRot1 dY, Xbus &larr; 1, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0D,10,DCycle];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dY, Xbus &larr; 1, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0C,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 1, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0B,10,DCycle];<br>DCycle6:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 1, XDisp, GOTO[DRot1],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[0A,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; RRot1 dY, Xbus &larr; 2, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[9,10,DCycle];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dY, Xbus &larr; 2, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[8,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 2, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[7,10,DCycle];<br>DCycleA:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 2, XDisp, GOTO[DRot1],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[6,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; RRot1 dY, Xbus &larr; 3, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[5,10,DCycle];<br><br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dY, Xbus &larr; 3, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[4,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 3, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[3,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dY, Xbus &larr; 3, XDisp, GOTO[DRot1],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[2,10,DCycle];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; RRot1 dY, Xbus &larr; 0, XDisp, GOTO[NoRot],</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">c*, at[1,10,DCycle];<br><br>NoRot:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">pRet5, DISP2[DLRot]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*;<br>DRot1:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; LRot1 dX, pRet5, DISP2[DLRot]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*;<br><br>DLRot:</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">RET[DCycleRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*, at[0,4,DLRot];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dX LRot4, RET[DCycleRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*, at[1,4,DLRot];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dX LRot8, RET[DCycleRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*, at[2,4,DLRot];<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">dX &larr; dX LRot12, RET[DCycleRet]</span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">,c*, at[3,4,DLRot];<br><br><br>{&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;<br></span><span class="tab" val="66"></span><span style="font: 8pt sans-serif">DMask<br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;}</span></div>
<span style="font: 10pt serif"><br>DMask:	dX &larr; 1, GOTO[DMaskRet],	c2, at[0F,10,DMask];<br>	dX &larr; 3, GOTO[DMaskRet],	c2, at[0E,10,DMask];<br>	dX &larr; 7, GOTO[DMaskRet],	c2, at[0D,10,DMask];<br>	dX &larr; 0F, GOTO[DMaskRet],	c2, at[0C,10,DMask];<br>	dX &larr; 1F, GOTO[DMaskRet],	c2, at[0B,10,DMask];<br>	dX &larr; 3F, GOTO[DMaskRet],	c2, at[0A,10,DMask];<br>	dX &larr; 7F, GOTO[DMaskRet],	c2, at[9,10,DMask];<br>	dX &larr; 0FF, GOTO[DMaskRet],	c2, at[8,10,DMask];<br>	dX &larr; LShift1 0FF, SE&larr;1, GOTO[DMaskRet] {dX &larr; 1FF},	c2, at[7,10,DMask];<br>	dX &larr; RShift1 u7FF, GOTO[DMaskRet] {dX &larr; 3FF},	c2, at[6,10,DMask];<br>	dX &larr; u7FF, GOTO[DMaskRet] {dX &larr; 7FF},	c2, at[5,10,DMask];<br>	dX &larr; RShift1 u1FFF, GOTO[DMaskRet] {dX &larr; FFF},	c2, at[4,10,DMask];<br>	dX &larr; u1FFF, GOTO[DMaskRet] {dX &larr; 1FFF},	c2, at[3,10,DMask];<br>	dX &larr; u3FFF, GOTO[DMaskRet] {dX &larr; 3FFF},	c2, at[2,10,DMask];<br>	dX &larr; RShift1 (~dX xor dX), GOTO[DMaskRet] {dX &larr; 7FFF},	c2, at[1,10,DMask];<br>	dX &larr; ~dX xor dX, GOTO[DMaskRet] {dX &larr; FFFF},	c2, at[0,10,DMask];<br><br></span><script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
