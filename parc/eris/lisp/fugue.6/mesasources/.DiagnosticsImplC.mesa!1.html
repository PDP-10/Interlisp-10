<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>File [eris]&lt;Lisp>Fugue.6>MesaSources>DiagnosticsImplC.mesa!1</title>
  </head>
  <body>
    <pre>
-- DiagnosticsImplC.mesa  -  edited by:-- Poskanzer	27-Apr-83 10:31:52DIRECTORY  Address USING [AddressTrouble, StringsToNetworkAddress],  DiagnosticsOps USING [    CheckForAbort, PutCR, PutChar, PutLine, PutLongNumber, PutText],  OISCPConstants USING [echoerSocket],  OnlineDiagnostics USING [    EchoResults, EchoUserTest, EchoUserTestFeedbackType, PrintFeedbackProc],  System USING [NetworkAddress, nullNetworkAddress];DiagnosticsImplC: PROGRAM  IMPORTS Address, DiagnosticsOps, OnlineDiagnostics  EXPORTS DiagnosticsOps =  BEGIN  EchoUserTest: PUBLIC PROCEDURE [net: LONG STRING, host: LONG STRING] =    BEGIN    destAddr: System.NetworkAddress;    errFlag: BOOLEAN &larr; FALSE;    echoResults: OnlineDiagnostics.EchoResults;    destAddr &larr; Address.StringsToNetworkAddress[      host, OISCPConstants.echoerSocket, net !      Address.AddressTrouble =&gt;        BEGIN        DiagnosticsOps.PutText["Address translation troubles: "L];        DiagnosticsOps.PutLine[reason];        errFlag &larr; TRUE;        CONTINUE;        END];    IF errFlag THEN RETURN;    DiagnosticsOps.PutCR[];    DiagnosticsOps.PutLine["               Ethernet Diagnostics"L];    DiagnosticsOps.PutLine["Each '!' represents a successful echo operation."L];    DiagnosticsOps.PutLine[      "Each '?' represents no packet echoed back during waiting period."L];    DiagnosticsOps.PutLine["Each '#' represents a packet echoed back late."L];    DiagnosticsOps.PutLine[      "Each '~' represents a packet which was echoed with bad data but a good CRC."L];    DiagnosticsOps.PutLine[      "Each ':' marks largest size packet has just been transmitted."L];    echoResults &larr; OnlineDiagnostics.EchoUserTest[      destAddr: destAddr, printFeedback: PrintFeedback,      sourceAddr: System.nullNetworkAddress, echoParams: []];    DiagnosticsOps.PutCR[];    DiagnosticsOps.PutText["Total packets to be echoed: "L];    DiagnosticsOps.PutLongNumber[echoResults.totalAttempts, 10];    DiagnosticsOps.PutCR[];    DiagnosticsOps.PutText["Packets echoed successfully: "L];    DiagnosticsOps.PutLongNumber[echoResults.subtotals[goodEcho], 10];    DiagnosticsOps.PutCR[];    DiagnosticsOps.PutText["Percentage of packets echoed successfully: "L];    DiagnosticsOps.PutLongNumber[      IF echoResults.totalAttempts = 0 THEN 0      ELSE (echoResults.subtotals[goodEcho]*100)/echoResults.totalAttempts, 10];    DiagnosticsOps.PutLine["%"L];    DiagnosticsOps.PutCR[];    END;  -- EchoUserTest --        PrintFeedback: OnlineDiagnostics.PrintFeedbackProc =      BEGIN      DiagnosticsOps.PutChar[        SELECT feedbackType FROM          goodEcho =&gt; '!,          noEcho =&gt; '?,          lateEcho =&gt; '#,          badDataGoodCRC =&gt; '~,          bigPacket =&gt; ':,          ENDCASE =&gt; '@];      DiagnosticsOps.CheckForAbort[ ! ABORTED =&gt; GOTO aborted];      RETURN[TRUE];      EXITS aborted =&gt; RETURN[FALSE];      END;  END.        </pre>
  </body>
</html>
