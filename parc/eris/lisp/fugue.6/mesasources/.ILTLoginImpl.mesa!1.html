<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>File [eris]&lt;Lisp>Fugue.6>MesaSources>ILTLoginImpl.mesa!1</title>
  </head>
  <body>
    <pre>
--ILTLoginImpl.mesa--Created by--   JFung.PASA	  	29-Sep-83 14:53:01-- Modified version taken from Profile.mesa--last edited by--   JFung.PASA	   	  7-Oct-83  9:58:07DIRECTORY     FormSW USING [Display, FindItem, ItemHandle, ProcType],     Heap USING [systemZone],     LispToolOps,     Process,     Profile USING [          debugging, GetDefaultDomain, GetDefaultOrganization, GetDefaultRegistry,          GetLibrarian, GetLibrarianNames, GetUser, SetDebugging, SetDefaultDomain,          SetDefaultOrganization, SetDefaultRegistry, SetLibrarian, SetUser],     Put,     String USING [CopyToNewString, EquivalentString, Replace],     Supervisor USING [AgentProcedure, CreateSubsystem, SubsystemHandle];ILTLoginImpl: PROGRAM     IMPORTS FormSW, Heap, LispToolOps, Process, Profile, Put, String     EXPORTS LispToolOps =     BEGIN OPEN ILT: LispToolOps;     z: UNCOUNTED ZONE = Heap.systemZone;     ProfileItem: TYPE = {          apply, user, password, registry, abort, domain, organization, debug,          librarian, prefix, suffix};  -- if the positions of apply  and abort change, you must edit ToggleCommands     dirty: PACKED ARRAY ProfileItem OF BOOLEAN &larr; ALL[FALSE];     ProfileFields: TYPE = RECORD [          userName: LONG STRING &larr; NIL,          userPassword: LONG STRING &larr; NIL,          domain: LONG STRING &larr; NIL,          organization: LONG STRING &larr; NIL,          registry: LONG STRING &larr; NIL,          librarianName: LONG STRING &larr; NIL,          librarianNamePrefix: LONG STRING &larr; NIL,          librarianNameSuffix: LONG STRING &larr; NIL];     ProfileData: TYPE = RECORD [          --formSW: Window.Handle &larr; NIL,          debugging: BOOLEAN &larr; NULL,          strings: ARRAY ProfileItem OF LONG STRING &larr; ALL[NIL],          busy: BOOLEAN &larr; FALSE];     --agent: Supervisor.SubsystemHandle = Supervisor.CreateSubsystem[Notify];     data: LONG POINTER TO ProfileData &larr; NIL;     debug: BOOLEAN &larr; FALSE;     profileInfo: ProfileFields &larr; [];     GetUser: PROCEDURE [name, password: LONG STRING] = {          profileInfo.userName &larr; String.CopyToNewString[name, z];          profileInfo.userPassword &larr; String.CopyToNewString[password, z]};     GetDefaultDomain: PROCEDURE [domain: LONG STRING] = {          profileInfo.domain &larr; String.CopyToNewString[domain, z]};     GetDefaultOrganization: PROCEDURE [organization: LONG STRING] = {          profileInfo.organization &larr; String.CopyToNewString[organization, z]};     GetDefaultRegistry: PROCEDURE [registry: LONG STRING] = {          profileInfo.registry &larr; String.CopyToNewString[registry, z]};     GetLibrarian: PROCEDURE [librarian: LONG STRING] = {          profileInfo.librarianName &larr; String.CopyToNewString[librarian, z]};     GetLibrarianNames: PROCEDURE [prefix, suffix: LONG STRING] = {          profileInfo.librarianNamePrefix &larr; String.CopyToNewString[prefix, z];          profileInfo.librarianNameSuffix &larr; String.CopyToNewString[suffix, z]};     GetProfileInfo: PROCEDURE = {          Profile.GetUser[GetUser];          Profile.GetDefaultDomain[GetDefaultDomain];          Profile.GetDefaultOrganization[GetDefaultOrganization];          Profile.GetDefaultRegistry[GetDefaultRegistry];          Profile.GetLibrarianNames[GetLibrarianNames];          Profile.GetLibrarian[GetLibrarian]};     FreeProfileInfo: PROCEDURE =          BEGIN          z.FREE[@profileInfo.userName];          profileInfo.userName &larr; NIL;          z.FREE[@profileInfo.userPassword];          profileInfo.userPassword &larr; NIL;          z.FREE[@profileInfo.domain];          profileInfo.domain &larr; NIL;          z.FREE[@profileInfo.organization];          profileInfo.organization &larr; NIL;          z.FREE[@profileInfo.registry];          profileInfo.registry &larr; NIL;          z.FREE[@profileInfo.librarianName];          profileInfo.librarianName &larr; NIL;          z.FREE[@profileInfo.librarianNamePrefix];          profileInfo.librarianNamePrefix &larr; NIL;          z.FREE[@profileInfo.librarianNameSuffix];          profileInfo.librarianNameSuffix &larr; NIL;          END;     DataChanged: FormSW.ProcType =          BEGIN          dirty[VAL[index]] &larr; TRUE;          IF ~commandsShowing THEN {               FormSW.FindItem[sw, ORD[ProfileItem.abort]].flags.invisible &larr; FALSE;               FormSW.FindItem[sw, ORD[ProfileItem.apply]].flags.invisible &larr; FALSE;               FormSW.Display[sw]};          commandsShowing &larr; TRUE;          END;     commandsShowing: BOOLEAN &larr; FALSE;     -- since everything is done in the Notifier, no monitor is needed to protect this boolean     LoginProc: PUBLIC PROCEDURE =          BEGIN          data &larr; Heap.systemZone.NEW[ProfileData];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "Enter LoginProc..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          data.strings[user] &larr; ILT.toolData.userName;          data.strings[password] &larr; ILT.toolData.userPassword;          data.strings[domain] &larr; ILT.toolData.domainName;          data.strings[organization] &larr; ILT.toolData.organizationName;          Apply;          Heap.systemZone.FREE[@data];          END;     Apply: PROCEDURE =          BEGIN          ENABLE UNWIND =&gt; FreeProfileInfo[];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "Enter Apply..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF data = NIL THEN RETURN;          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "GetProfileInfo..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          GetProfileInfo[];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "UpdatePrimary..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF ~Equal[profileInfo.userName, user]               OR ~Equal[profileInfo.userPassword, password] THEN UpdatePrimary[];          &lt;&lt;  	IF data.debugging # Profile.debugging THEN      		Profile.SetDebugging[data.debugging];  &gt;&gt;          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "SetDefaultDomain..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF ~Equal[profileInfo.domain, domain] THEN               Profile.SetDefaultDomain[data.strings[domain]];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "SetDefaultOrganization..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF ~Equal[profileInfo.organization, organization] THEN               Profile.SetDefaultOrganization[data.strings[organization]];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "SetDefaultRegistry..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF ~Equal[profileInfo.registry, registry] THEN               Profile.SetDefaultRegistry[data.strings[registry]];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "UpdateLibrarian..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          IF ~Equal[profileInfo.librarianName, librarian]               OR ~Equal[profileInfo.librarianNamePrefix, prefix]               OR ~Equal[profileInfo.librarianNameSuffix, suffix] THEN               UpdateLibrarian[];          IF debug THEN {               Put.Line[ILT.toolData.fileSW, "FreeProfileInfo..."L];               --Process.Pause[Process.SecondsToTicks[5]];               };          FreeProfileInfo[];          END;     UpdatePrimary: PROC =          BEGIN Profile.SetUser[data.strings[user], data.strings[password]]; END;     UpdateLibrarian: PROC =          BEGIN          Profile.SetLibrarian[               data.strings[librarian], data.strings[prefix], data.strings[               suffix]];          END;     ResetData: PROC [display: BOOLEAN] =          BEGIN          ENABLE UNWIND =&gt; FreeProfileInfo[];          IF data = NIL OR data.busy THEN RETURN;          GetProfileInfo[];          Update[profileInfo.userName, user, display];          Update[profileInfo.userPassword, password, display];          Update[profileInfo.registry, registry, display];          Update[profileInfo.domain, domain, display];          Update[profileInfo.organization, organization, display];          Update[profileInfo.librarianName, librarian, display];          Update[profileInfo.librarianNamePrefix, prefix, display];          Update[profileInfo.librarianNameSuffix, suffix, display];          &lt;&lt;    	IF data.debugging # Profile.debugging THEN {      	data.debugging &larr; Profile.debugging;        IF display THEN FormSW.DisplayItem[data.formSW, ORD[ProfileItem.debug]]};&gt;&gt;          FreeProfileInfo[];          END;     Equal: PROC [s: LONG STRING, index: ProfileItem] RETURNS [BOOLEAN] =          BEGIN RETURN[String.EquivalentString[data.strings[index], s]]; END;     Update: PROC [profile: LONG STRING, index: ProfileItem, display: BOOLEAN] =          BEGIN          IF Equal[profile, index] THEN RETURN;          String.Replace[@data.strings[index], profile, z];          --IF display THEN FormSW.DisplayItem[data.formSW, ORD[index]];          END;     --Notify: Supervisor.AgentProcedure = {ResetData[display: TRUE]};     END.</pre>
  </body>
</html>
