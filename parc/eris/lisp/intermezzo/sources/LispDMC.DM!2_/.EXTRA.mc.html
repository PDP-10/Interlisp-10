<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>INTERMEZZO>SOURCES>LispDMC.DM!2>EXTRA.mc</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt monospace"><br><br>% - - - more crufty debugging version  - - -<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">rbase&larr; rbase[TSP];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP0&larr; Link;<br><br><br>TOP LEVEL;<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">rbase&larr; rbase[InstCount];<br>InstBreakCheck:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; InstCount&larr; (InstCount) + 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, carry&rsquo;], pd&larr; T - (InstBreak);<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.nextok];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu#0];<br>:if[BreakPoints];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">nop, breakpoint;<br>:else;<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">RESCHEDULE;<br>:endif;<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">nop;<br>.nextok:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">call[CHECKREGS];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">rbase&larr; rbase[RANDNUM], call[.Random];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP0&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP1&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">Q&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP3&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP4&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">NARGS&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">DEFHI&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">DEFLO&larr; T, call[.Random];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">Cnt&larr; T;<br><br> - - - - - end crufty debugging version<br><br>% <br>SUBROUTINE;<br><br>CHECKREGS:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">rbase&larr; rbase[LTEMP1];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP1&larr; Link;<br><br>TOP LEVEL;<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, R even], TSP, memBase&larr; StackBR;<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">UCodeCheck[TSPODD];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (PVAR) - (FX.PVAR);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">fetch&larr; T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; Md;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; T and (StackMask);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; T xor (FxtnBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu=0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">uCodeCheck[BadFrame];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; ESP;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; T - (TSP);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T &larr; T rsh 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; T - (</span><span style="font: 10pt serif">LEFT</span><span style="font: 10pt monospace">Offset);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (</span><span style="font: 10pt serif">LEFT</span><span style="font: 10pt monospace">) - T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu=0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">UCodeCheck[LEFTWRONG];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (PSTATE) and not (PS.PCXBAD);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu=0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">UCodeCheck[PSTATEWRONG];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (PVAR) - (FXBACK[IVAR]);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">fetch&larr; T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (IVAR) - (Md);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu=0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">UCodeCheck[IVARMISMATCH];<br><br>SUBROUTINE;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">Link&larr; LTEMP1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">return;<br><br>SCANSTACK:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">rbase&larr; rbase[LTEMP1];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP1&larr; Link;<br><br>TOP LEVEL;<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (PVAR) - (10000c);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, carry];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.endcheck];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; A0, memBase&larr; StackBR;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP3&larr; A0, branch[.scanstk0];<br><br>.scanstack:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; LTEMP2;</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">* new frame<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; T - (LTEMP3);</span><span class="tab" val="67"></span><span style="font: 10pt monospace">* old frame<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, carry]; * new must be greater than old<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">ucodecheck[BadFrame];<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP3&larr; T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace"><br>.scanstk0:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, R even], LTEMP2&larr; (fetch&larr; LTEMP2) + 1;<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">ucodecheck[BadFrame];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; Md;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; (fetch&larr; LTEMP2) - 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (T) and (StackMask);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; T - (FreeStackBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanfree, alu=0], pd&larr; T - (BFBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanbf, alu=0], pd&larr; T - (FxtnBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanfx, alu=0], pd&larr; T - (GuardBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanend, alu=0];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanbf];<br><br>.scanfree:<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; (LTEMP2) + (Md), branch[.scanstack];<br><br>.scanfx:</span><span class="tab" val="67"></span><span style="font: 10pt monospace">* LTEMP2 points to a FX. Could check it here<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (PVAR) - (FX.PVAR);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (LTEMP2) - T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu#0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; ESP, branch[.scanstack];</span><span class="tab" val="67"></span><span style="font: 10pt monospace">* was current frame<br><br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (LTEMP2) + (FX.NEXT);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">fetch&larr; T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; Md, branch[.scanstack];<br><br>.scanbf:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; (fetch&larr; LTEMP2) + 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP4&larr; Md;</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">* flags<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">LTEMP2&larr; (fetch&larr; LTEMP2) + 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (LTEMP4) and (StackMask);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; T - (BFBlock);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanbfend, alu=0], T&larr; Md, pd&larr; T;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu=0];<br>.bfbad: </span><span class="tab" val="67"></span><span style="font: 10pt monospace">uCodeCheck[StackBad];<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanbf];<br><br>.scanbfend:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (LTEMP4) and (BFResidual);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanresid, alu#0], pd&larr; T - (LTEMP3);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanstack, alu=0];<br><br>.scanbadstack:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">uCodeCheck[StackBad];<br><br>.scanresid:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (LTEMP3) + (2c);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; T - (LTEMP2);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.+2, alu#0];<br></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.scanstack];<br><br>.badresid:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">ucodecheck[StackBad];<br><br>.scanend:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">memBase&larr; InterfaceBR;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">fetch&larr; 7s;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">pd&larr; (LTEMP2) - (Md);<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">branch[.endcheck, alu=0], memBase&larr; StackBR;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">T&larr; (LTEMP2) + 1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">fetch&larr; T, branch[.scanfree];<br><br><br>SUBROUTINE;<br>.endcheck:<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">Link&larr; LTEMP1;<br></span><span class="tab" val="67"></span><span style="font: 10pt monospace">return;<br></span><span style="font: 10pt serif"><br><br>KnowRBase[</span><span style="font: 10pt monospace">RANDNUM</span><span style="font: 10pt serif">];<br><br>.Random:</span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; LSH[</span><span style="font: 10pt monospace">RANDNUM</span><span style="font: 10pt serif">, 11];</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt serif">* T&larr; 2&uarr;9 * R<br></span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; T+(</span><span style="font: 10pt monospace">RANDNUM</span><span style="font: 10pt serif">);</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt serif">* (2&uarr;9 + 2&uarr;0)* R<br></span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; LSH[T, 2];</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt serif">* (2&uarr;11 + 2&uarr;2)* R<br></span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; T+(</span><span style="font: 10pt monospace">RANDNUM</span><span style="font: 10pt serif">);</span><span class="tab" val="67"></span><span class="tab" val="67"></span><span class="tab" val="67"></span><span style="font: 10pt serif">* (2&uarr;11 + 2&uarr;2 + 2&uarr;0)* R<br></span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; T + (33000c);<br></span><span class="tab" val="67"></span><span style="font: 10pt serif">T&larr; </span><span style="font: 10pt monospace">RANDNUM</span><span style="font: 10pt serif">&larr; T+(31c), Return;</span><span class="tab" val="67"></span><span style="font: 10pt serif">* +13849<br><br></span><span style="font: 10pt monospace"><br>:endif;* end of checking code<br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
