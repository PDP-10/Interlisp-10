<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>INTERMEZZO>SOURCES>LispDMC.DM!2>LTRAPS.mc</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt monospace">:Title[LTraps.dmc, June 27, 1982  2:48 PM, Masinter];<br><br>* this file is a modified version of:<br><br>*-----------------------------------------------------------<br>* Title[ATraps.mc...August 15, 1981  10:20 PM...Taft];<br>* This file contains emulator-specific microcode for:<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">S-group opcodes that ordinarily trap;<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Default disk region;<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Map parameters.<br>* This is the version for the strictly Alto emulator.<br>* It should be renamed and edited for other emulators<br>*-----------------------------------------------------------<br><br>TopLevel;<br>KnowRBase[AEmRegs];<br>Set[XTask, IP[EMU]];<br>InsSet[AEmuInsSet, 1];<br><br>*-----------------------------------------------------------<br>GetEmulatorMapParams:<br>* Returns in T some emulator-specific information for setting up the map:<br>*    T[0] = 1 to write-protect page 377, for XM Alto emulation;<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">    0 to emulate a non-XM Alto.<br>*    T[4:15] = the VA[4:15] to be used to define the main 64K memory<br>*           region for Alto emulation (i.e., loaded into the high<br>*           part of MDS).  Should be 0 in all emulators except Lisp.<br>*-----------------------------------------------------------<br>Subroutine;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; LEmuBrHiVal, Return;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* Lisp AEMU region<br><br>TopLevel;<br><br><br>*-----------------------------------------------------------<br>VERS: * Alto Version instruction<br>* structure VERS:<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">eng bit 4</span><span class="tab" val="24"></span><span style="font: 10pt monospace">// engineering number<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">build bit 4</span><span class="tab" val="24"></span><span style="font: 10pt monospace">// build number<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">microcode bit 8</span><span class="tab" val="24"></span><span style="font: 10pt monospace">// microcode version<br>* For Dorado, the engineering number is 5.<br>* The build number (use of which has been discontinued on the Alto) is<br>* taken over to indicate the emulator(s) included in the current microcode:<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">0</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto emulator only<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">1</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + Alto Mesa<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">2</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + PrincOps Mesa<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">3</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + Cedar Mesa<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">4</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + Lisp<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">5</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + Smalltalk 76<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">6</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Alto + Smalltalk 78<br>*-----------------------------------------------------------<br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Stack&larr; add[lshift[5,14],</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* eng# 5<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">           lshift[4,10]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* build# 4<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">          ]C, At[SD400, 14], IFUJump[0];<br><br>*-----------------------------------------------------------<br>* Parameterless Alto instructions (NOPAR group) that are<br>* undefined on the Dorado<br>*-----------------------------------------------------------<br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">IFUJump[0],</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 7];</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61007, StartIntervalTimer<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 10];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61010, JumpRAM<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Stack&larr; A0,<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace"> IFUJump[0],</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 11];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61011, ReadRAM<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">IFUJump[0],</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 12];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61012, WriteRAM<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 15];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61015, Double Read<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 16];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61016, Double Write<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 17];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61017, Double Exchange<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 22];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61022, Diagnostic<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 23];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61023, Diagnostic<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 27];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61027, SET DISPLAY RATE<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 30];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61030, not used<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 31];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61031, not used<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Branch[NPTrap],</span><span class="tab" val="24"></span><span style="font: 10pt monospace">At[SD400, 35];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">*61035, not used<br><br>*-----------------------------------------------------------<br>* S-Group opcodes that trap<br>* Note: Trap## uses dispatch word at 530+##+ID (## = 00, 17, or 36).<br>* Trapx uses dispatch word at 400+T.<br>* All of these trap routines expect RBase = rbAEmRegs.<br>*-----------------------------------------------------------<br><br>* EmIFUTrap[opcode, IMaddress, N]<br>M[EmIFUTrap, IFUPause[#1, 2, MDS, rbAEmRegs, #2, #3, 0, 0]];<br><br>EmIFUTrap[141, Trap00, 01];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 60400-60777<br>EmIFUTrap[143, Trap00, 03];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 61400-61777<br>EmIFUTrap[144, Trap00, 04];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 62000-62377<br>EmIFUTrap[145, Trap00, 05];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 62400-62777<br>EmIFUTrap[146, Trap00, 06];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 63000-63377<br>EmIFUTrap[147, Trap00, 07];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 63400-63777<br>EmIFUTrap[150, Trap00, 10];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 64000-64377<br>EmIFUTrap[153, Trap00, 13];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 65400-65777<br>EmIFUTrap[154, Trap00, 14];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 66000-66377<br>EmIFUTrap[155, Trap00, 15];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 66400-66777<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">EmIFUTrap[157, Trap17, 00];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 67400-67777<br>EmIFUTrap[160, Trap17, 01];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 70000-70377<br>EmIFUTrap[161, Trap17, 02];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 70400-70777<br>EmIFUTrap[162, Trap17, 03];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 71000-71377<br>EmIFUTrap[163, Trap17, 04];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 71400-71777<br>EmIFUTrap[164, Trap17, 05];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 72000-72377<br>EmIFUTrap[165, Trap17, 06];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 72400-72777<br>EmIFUTrap[166, Trap17, 07];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 73000-73377<br>EmIFUTrap[167, Trap17, 10];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 73400-73777<br>EmIFUTrap[170, Trap17, 11];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 74000-74377<br>EmIFUTrap[171, Trap17, 12];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 74400-74777<br>EmIFUTrap[172, Trap17, 13];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 75000-75377<br>EmIFUTrap[173, Trap17, 14];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 75400-75777<br>EmIFUTrap[174, Trap17, 15];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 76000-76377<br>EmIFUTrap[175, Trap17, 16];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 76400-76777<br>EmIFUTrap[176, Trap36, 00];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 77000-77377<br>EmIFUTrap[177, Trap36, 01];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 77400-77777<br><br><br>IFUPause[157, 2, MDS, rbAEmRegs, LTrap, noNData, 0, 0]; * 67400-67777<br><br>*-----------------------------------------------------------<br>* Dummy BCPL runtime routines, if BCPLRuntime.dib not loaded.<br>* These labels are redefined if BCPLRuntime is actually loaded.<br>* This code is here because it gets bound too early if included in<br>* AEmu assembly.  It must be loaded before BCPLRuntime.<br>*-----------------------------------------------------------<br>JSRz300: Q&larr; PCX&rsquo;, Branch[JSRx];<br>JSRiz340: Fetch&larr; T, FlipMemBase, Branch[JSRix];<br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
