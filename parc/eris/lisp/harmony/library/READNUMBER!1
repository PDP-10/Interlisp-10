(FILECREATED "24-Aug-84 09:30:16" {ERIS}<LISPCORE>LIBRARY>READNUMBER.;5 9992         changes to:  (FNS NUMBERPAD.READ)      previous date: "10-Apr-84 12:25:32" {ERIS}<LISPCORE>LIBRARY>READNUMBER.;2)(* Copyright (c) 1982, 1983, 1984 by Xerox Corporation. All rights reserved.)(PRETTYCOMPRINT READNUMBERCOMS)(RPAQQ READNUMBERCOMS ((FNS \READNUMBER.FLASHAREA RNUMBER NUMBERPAD.READ CREATE.NUMBERPAD.READER 			    REGIONONSCREEN DISPLAY/NUMBER/READER/TOTAL NUMBER.READER.HANDLER 			    NUMBERPAD.HELDFN \READNUMBER.OUTLINEREGION)))(DEFINEQ(\READNUMBER.FLASHAREA  [LAMBDA (LFT BTM WDTH HGHT WIN)                            (* rrb "28-JUN-82 19:17")                                                             (* flashes a region of a window.)    (BITBLT NIL NIL NIL WIN LFT BTM WDTH HGHT (QUOTE TEXTURE)	    (QUOTE INVERT)	    BLACKSHADE)    (DISMISS 60)    (BITBLT NIL NIL NIL WIN LFT BTM WDTH HGHT (QUOTE TEXTURE)	    (QUOTE INVERT)	    BLACKSHADE])(RNUMBER  [LAMBDA (MSG POSITION MSGFONT DIGITFONT)                   (* rrb "28-JUN-82 19:26")                                                             (* creates a numberpad window menu and lets the user 							     enter a number.)                                                             (* it is substantially more efficient to save the 							     NUMBERPAD/READER and call NUMBERPAD.READ directly.)    (NUMBERPAD.READ (CREATE.NUMBERPAD.READER MSG POSITION MSGFONT DIGITFONT])(NUMBERPAD.READ  [LAMBDA (NUMBERPAD/READER)                                 (* rrb "24-Aug-84 09:27")                                                             (* allows the user to enter a number with the 							     numberpad.)                                                             (* position the number pad near the current reading 							     location.)    (WINDOWPROP NUMBERPAD/READER (QUOTE TOTAL)		0)    (SPAWN.MOUSE)    (RESETLST (RESETSAVE (OPENW NUMBERPAD/READER)			 (LIST (QUOTE CLOSEW)			       NUMBERPAD/READER))	      (DISPLAY/NUMBER/READER/TOTAL NUMBERPAD/READER)                                                             (* start a mouse process in case this one is it.)                                                             (* wait for the menu handler to set that it is 							     finished.)	      (until (WINDOWPROP NUMBERPAD/READER (QUOTE FINISHEDFLG)				 NIL)		 do (TOTOPW NUMBERPAD/READER)		    (DISMISS 100))	      (WINDOWPROP NUMBERPAD/READER (QUOTE TOTAL])(CREATE.NUMBERPAD.READER  [LAMBDA (MSG WPOSITION MSGFONT DIGITFONT)                  (* rrb "10-Apr-84 12:22")          (* creates a window menu that displays the digits in a numberpad and lets the user enter a number.	  It also includes a backspace and a enter)    (RESETFORM (RADIX 12Q)	       (PROG ((NUMBER/READER/MAXDIGITS 6)		      WIN READERWIDTH PADLEFT TOTALREGION [DIGITFONT (OR DIGITFONT									 (FONTCREATE (QUOTE GACHA)										     14Q										     (QUOTE BOLD]		      [MSGFONT (OR MSGFONT (FONTCREATE (QUOTE GACHA)						       14Q						       (QUOTE BOLD]		      NUMBERPAD TOTALWIDTH)		     [SETQ NUMBERPAD		       (create MENU			       ITEMS _(QUOTE (- %  clr 1 2 3 4 5 6 7 10Q 11Q bs 0 ok))			       MENUCOLUMNS _ 3			       CENTERFLG _ T			       MENUFONT _ DIGITFONT			       WHENHELDFN _(FUNCTION NUMBERPAD.HELDFN)			       WHENSELECTEDFN _(FUNCTION NUMBER.READER.HANDLER)			       MENUOUTLINESIZE _ 2			       ITEMHEIGHT _(IPLUS 2 (FONTPROP DIGITFONT (QUOTE HEIGHT]                                                             (* leave room for three lines at the top and the number 							     at the left.)		     (SETQ WIN		       (CREATEW [REGIONONSCREEN				  WPOSITION				  [WIDTHIFWINDOW (SETQ READERWIDTH						   (IPLUS [SETQ PADLEFT							    (IPLUS 14Q (SETQ TOTALWIDTH								     (ITIMES (ADD1 									  NUMBER/READER/MAXDIGITS)									     (CHARWIDTH (CHARCODE											  0)											DIGITFONT]							  (fetch (MENU IMAGEWIDTH) of NUMBERPAD]				  (HEIGHTIFWINDOW (IPLUS (COND							   [MSG                                                              (* if there is a msg, leave room for it at the top.)								(ITIMES (IPLUS (IQUOTIENT										 (STRINGWIDTH MSG 											  MSGFONT)										 READERWIDTH)									       2)									(FONTPROP MSGFONT										  (QUOTE HEIGHT]							   (T 0))							 (fetch (MENU IMAGEHEIGHT) of NUMBERPAD]				NIL NIL T))		     [COND		       (MSG                                  (* if there is a msg, print it at the top.)			    (DSPFONT MSGFONT WIN)			    (MOVETOUPPERLEFT WIN)			    (COND			      [(LISTP MSG)				(PROG ((RMARG (DSPRIGHTMARGIN NIL WIN)))				      (for X in MSG					 do (COND					      ((IGREATERP (IPLUS (DSPXPOSITION NIL WIN)								 (STRINGWIDTH X WIN))							  RMARG)						(TERPRI WIN)))					    (PRIN3 X WIN)					    (SPACES 1 WIN]			      (T (PRIN1 MSG WIN]		     (OPENW WIN)                             (* window is opened because of bug in ADDMENU that it 							     doesn't work unless window is open.)		     (ADDMENU NUMBERPAD WIN (create POSITION						    XCOORD _ PADLEFT						    YCOORD _ 0))		     [WINDOWPROP WIN (QUOTE TOTALREG)				 (SETQ TOTALREGION (create REGION							   LEFT _ 6							   BOTTOM _(IQUOTIENT (fetch (MENU 										      IMAGEHEIGHT)										 of NUMBERPAD)									      2)							   WIDTH _ TOTALWIDTH							   HEIGHT _(FONTPROP DIGITFONT (QUOTE HEIGHT]		     (\READNUMBER.OUTLINEREGION TOTALREGION WIN 2)		     (DSPFONT DIGITFONT WIN)		     (WINDOWPROP WIN (QUOTE TOTAL)				 0)		     (WINDOWPROP WIN (QUOTE MAXDIGITS)				 NUMBER/READER/MAXDIGITS)		     (DISPLAY/NUMBER/READER/TOTAL WIN)		     (CLOSEW WIN)		     (RETURN WIN])(REGIONONSCREEN  [LAMBDA (POS WIDTH HEIGHT)                                 (* rrb "28-JUN-82 18:58")                                                             (* returns the region WIDTH by HEIGHT that is nearest to							     POS or the cursor position while still being on the 							     screen.)    (PROG (LEFT BOTTOM)          (COND	    ((POSITIONP POS)	      (SETQ LEFT (fetch (POSITION XCOORD) of POS))	      (SETQ BOTTOM (fetch (POSITION YCOORD) of POS)))	    (T (GETMOUSESTATE)	       (SETQ LEFT LASTMOUSEX)	       (SETQ BOTTOM LASTMOUSEY)))          [COND	    ((IGREATERP (IPLUS LEFT WIDTH)			SCREENWIDTH)	      (SETQ LEFT (IMAX 0 (IDIFFERENCE SCREENWIDTH WIDTH]          [COND	    ((IGREATERP (IPLUS BOTTOM HEIGHT)			SCREENHEIGHT)	      (SETQ BOTTOM (IMAX 0 (IDIFFERENCE SCREENHEIGHT HEIGHT]          (RETURN (create REGION			  LEFT _ LEFT			  BOTTOM _ BOTTOM			  WIDTH _ WIDTH			  HEIGHT _ HEIGHT])(DISPLAY/NUMBER/READER/TOTAL  [LAMBDA (WIN)                                              (* rrb "10-Apr-84 12:24")                                                             (* displays the number total in the box in the window.)    (PROG [(TOTALREG (WINDOWPROP WIN (QUOTE TOTALREG]          (DSPFILL TOTALREG WHITESHADE (QUOTE REPLACE)		   WIN)          (RESETFORM (RADIX 12Q)		     (CENTERPRINTINREGION (WINDOWPROP WIN (QUOTE TOTAL))					  TOTALREG WIN])(NUMBER.READER.HANDLER  [LAMBDA (DIGIT MENU BUTTON)                                (* edited: "29-SEP-82 10:01")                                                             (* selected fn for a numberpad reader.							     adds the digit to the current total and updates the 							     display.)    (PROG (TOTAL (WIN (WFROMMENU MENU)))          (SETQ TOTAL (WINDOWPROP WIN (QUOTE TOTAL)))          [WINDOWPROP WIN (QUOTE TOTAL)		      (SELECTQ DIGIT			       (bs (IQUOTIENT TOTAL 10))			       (clr 0)			       (- (IMINUS TOTAL))			       (%                            (* empty key)				   TOTAL)			       (ok (WINDOWPROP WIN (QUOTE FINISHEDFLG)					       T)				   (RETURN))			       (COND				 ((EQ (WINDOWPROP WIN (QUOTE MAXDIGITS))				      (NCHARS (ABS TOTAL)))                                                             (* don't take any more.)				   (\READNUMBER.FLASHAREA 0 0 1000 1000 WIN)				   TOTAL)				 ((IGEQ TOTAL 0)				   (IPLUS (ITIMES TOTAL 10)					  DIGIT))				 (T (IDIFFERENCE (ITIMES TOTAL 10)						 DIGIT]          (DISPLAY/NUMBER/READER/TOTAL WIN])(NUMBERPAD.HELDFN  [LAMBDA (ITEM MENU BUTTON)                                 (* rrb "26-MAY-82 18:01")                                                             (* prints the help information for a numberpad.)    (PROMPTPRINT (SELECTQ ITEM			  (bs "Will erase the last digit entered.")			  (ok "Indicates that you are through entering the number.")			  (clr "Will reset the total to 0")			  (- " will change the sign of the total")			  (%  "doesn't do anything.")			  "Will put this digit on the right of the total."])(\READNUMBER.OUTLINEREGION  [LAMBDA (REG WIN OUTLINESIZE)                              (* rrb "19-MAY-82 15:26")                                                             (* puts a black outline around REG.)    (PROG ((N (OR (FIXP OUTLINESIZE)		  2)))          (BITBLT NIL NIL NIL WIN (IDIFFERENCE (fetch LEFT of REG)					       N)		  (IDIFFERENCE (fetch BOTTOM of REG)			       N)		  (IPLUS (fetch WIDTH of REG)			 (ITIMES N 2))		  (IPLUS (fetch HEIGHT of REG)			 (ITIMES N 2))		  (QUOTE TEXTURE)		  (QUOTE REPLACE)		  BLACKSHADE)          (BITBLT NIL NIL NIL WIN (fetch LEFT of REG)		  (fetch BOTTOM of REG)		  (fetch WIDTH of REG)		  (fetch HEIGHT of REG)		  (QUOTE TEXTURE)		  (QUOTE REPLACE)		  (DSPTEXTURE NIL WIN]))(PUTPROPS READNUMBER COPYRIGHT ("Xerox Corporation" 1982 1983 1984))(DECLARE: DONTCOPY  (FILEMAP (NIL (549 9901 (\READNUMBER.FLASHAREA 559 . 991) (RNUMBER 993 . 1518) (NUMBERPAD.READ 1520 . 2587) (CREATE.NUMBERPAD.READER 2589 . 5936) (REGIONONSCREEN 5938 . 6916) (DISPLAY/NUMBER/READER/TOTAL 6918 . 7395) (NUMBER.READER.HANDLER 7397 . 8532) (NUMBERPAD.HELDFN 8534 . 9076) (\READNUMBER.OUTLINEREGION 9078 . 9899)))))STOP