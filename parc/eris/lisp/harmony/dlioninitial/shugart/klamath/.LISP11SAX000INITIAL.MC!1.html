<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>Harmony>DlionInitial>Shugart>Klamath>LISP11SAX000INITIAL.MC!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: 10pt serif">{File name:  Lisp11SAx000Initial.mc<br>  Lichtenberg   2-Aug-84  1:28:03 fixed obscure leader pages bug.<br>  Lichtenberg  13-Jul-84 18:15:31 uIOPage finally right this time.<br>  Purcell     13-Jul-84 18:02:02  uIOPage was incorrectly set for lisp <br>  Purcell     2-Jul-84 14:15:55  zero oldIOPage <br>  Purcell    2-Jul-84  4:44:35  set uIOPage like mesa 10 before lisp {??}<br>Purcell   1-Jul-84 23:37:15  use newIOPage and buffer it in oldIOPage <br> Purcell  1-Jul-84 22:25:58  Added support for Quantum Q2080<br> Purcell  1-Jul-84 22:25:58  Accomodate changes for Germ as a result of going over to 32-bit procedure descriptors<br> Purcell  1-Jul-84 22:25:58  Use IOPage offsets from Dandelion.df!<br> Purcell 14-May-84 22:03:08  Mesa 11.0 Upgrade 2080 & germ<br> Purcell 23-Feb-84 23:23:07  detect multibanks<br>Purcell 15-Feb-84  2:29:05  load 4mb; scrap to page 0FF<br> Purcell February 14, 1984  8:03 PM  skip "zero banks" in FPTOVP<br> Purcell February 6, 1984  12:40 PM  Lisp MCtl &larr; 8002h<br> Purcell January 19, 1984  7:53 PM; MIN[topPage, AC0] removed<br> Purcell January 18, 1984  4:14 PM; mesa: MCtl 0, MIN[topPage, AC0]<br> Purcell January 17, 1984  11:21 AM; added NewInit section<br> Purcell January 17, 1984; renamed from nLispSAx000Initial.mc<br> Purcell January 16, 1984  6:34 PM; correct test of vp&gt;2&uarr;14<br> Purcell December 30, 1983  3:53 PM; max real mem 3-8MB<br> Purcell December 27, 1983  3:06 PM; max real mem 2.0MB<br> Purcell November 26, 1983  2:25 PM; {*0} max real mem 1.5MB<br> Purcell April 16, 1983  5:32 PM; uses password 15e3 at 17<br> Purcell April 16, 1983  4:22 PM; try 800h pages $$<br> Purcell April 16, 1983  1:16 PM; don&rsquo;t bother refresh<br> Purcell April 13, 1983  10:47 AM; uLispBootMsg{0DE}=55 to boot mesa<br> Purcell April 6, 1983  8:44 AM; skip over interface page<br> Purcell April 1, 1983  4:53 PM; new sysout booting<br> Purcell March 21, 1983  10:27 PM; Quantum support<br> Purcell March 6, 1983  2:56 PM; define uLinkPtr<br> Purcell March 6, 1983  9:45 AM; store boot disk address in IOCBs.cpr<br> Purcell December 6, 1982  6:39 PM: map for 4MB boot file<br> Purcell November 28, 1982  1:18 PM: LispSAx000Initial: save boot link for Lisp<br> Purcell November 22, 1982  9:03 AM: link &larr; 0D for BLT<br> Purcell November 19, 1982  4:54 PM: boot Lisp instead of diagnostics<br>File name:  [Idun]&lt;WDLion&gt;SAx000Initial.mc<br> Description: first microcode read from the disk, gets emulator microcode into CP memory,<br> Author: Jarvis,<br> Created: August 25, 1980,<br> JGS November 18, 1981  8:58 AM: move germ to mds 0.<br> Last Edited by Neely January 14, 1982  2:40 PM - change cons. for extracting filePageHi from BootId from 7 to 7F.<br> Last Edited by Jim Frandeen October 22, 1981  1:12 PM: If diagnostics are not installed, boot Emulator instead of crashing.<br> Last Edited by Fasnacht June 18, 1981  10:30 AM: delete SetGerm1000 at<br> Last Edited by DDavies February 14, 1981  4:35 PM<br> Last Edited by Jarvis March 24, 1981  11:46 AM}</span></div>
<div style="width: 491pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: 10pt serif"><br>{disk definitions}<br><br>{RegDef[uLispBootMsg, U, 0DE];} {also in Dandelisp.df}</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>RegDef[uLinkPtr, U, 27{uTT}];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{uLinkPtr}<br>RegDef[uFirstPage,U,49];<br><br>Set[hardMicrocodeFirstPage,13&rsquo;d];<br><br>{null findSectorCmd for SA1000} Set[SA1000FindSectCmd, 20];<br>{have SA1000 reject Label and Data fields when looking for Head</span><span style="font: 10pt serif; color: aqua">e</span><span style="font: 10pt serif">rs}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Set[SA1000HeaderLoopMsk, 43];<br>{control bits, low byte}</span><span class="tab" val="79"></span><span style="font: 10pt serif">{Set[stepBit, 80], Set[inBit, 40], Set[firmwareEnable, 20];}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Set[S</span><span style="font: 10pt serif; color: aqua">A</span><span style="font: 10pt serif">4FindSect, 6], Set[SA1FindSect, 0];<br>{control bits, high byte}</span><span class="tab" val="79"></span><span style="font: 10pt serif">{Set[driveSelectBit, 4], Set[faultClearBit, 2];}<br>{IOCB status error ind</span><span style="font: 10pt serif; color: aqua">i</span><span style="font: 10pt serif">cators}</span><span class="tab" val="79"></span><span style="font: 10pt serif">Set[badBits, 3F]; Set[verifyBit, 1];<br><br>{IO page of</span><span style="font: 10pt serif; color: aqua">f</span><span style="font: 10pt serif">sets}</span><span class="tab" val="79"></span><span style="font: 10pt serif">{Set[dis</span><span style="font: 10pt serif; color: aqua">k</span><span style="font: 10pt serif">CSB, 1];}{%}<br><br>{IOCB page offsets}<br>Set[statusAddr, 3];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{status word}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">{n</span><span style="font: 10pt serif; color: aqua">o</span><span style="font: 10pt serif">t used, used to be pointer to next IOCB, alw</span><span style="font: 10pt serif; color: aqua">a</span><span style="font: 10pt serif">ys 0}<br>Set[seekAddr, 5];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{pointer to seek IO</span><span style="font: 10pt serif; color: aqua">C</span><span style="font: 10pt serif">B}<br>Set[transferAddr, 6];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{pointer to transfer IO</span><span style="font: 10pt serif; color: aqua">C</span><span style="font: 10pt serif">B}<br>Set[vrrAddr, 7];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{pointer to vrr parameter area}</span><span style="font: 10pt serif; color: aqua"><br></span><span style="font: 10pt serif">Set[vvrAddr, 8];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{pointer to vrr parame</span><span style="font: 10pt serif; color: aqua">t</span><span style="font: 10pt serif">er area}<br>Set[headerAddr, 9];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{header -- 2 words}<br>Set[labelAddr, 0B];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{label -- 0A words}<br>    Set[labelPageLow, 10];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{low 16 bits of file page number}<br>    Set[miscBitsAddr, 11];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{filePageHi[0..6], unused[0..5], immutable[0], temporary[0], zeroSize[0]}<br>    Set[bootLink, 13];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{disk address of next run of pages in boot fil</span><span style="font: 10pt serif; color: aqua">e</span><span style="font: 10pt serif">}<br>    Set[labelSize, 0A];<br><br>{parameter area offsets}<br>Set[sectors, 0];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{number of sectors to transfer}<br>Set[headerLoopMsk, 6];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{spe</span><span style="font: 10pt serif; color: aqua">c</span><span style="font: 10pt serif">ifies non-fatal errors when looking for a header}<br>Set[dataPag</span><span style="font: 10pt serif; color: aqua">e</span><span style="font: 10pt serif">, 0D];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{page number of data area in main storage}</span><span style="font: 10pt serif; color: aqua"><br></span><span style="font: 10pt serif">Set[haltWord, 0F];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{requires head in high 5 bits}<br>Set[findWord, 10];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{requi</span><span style="font: 10pt serif; color: aqua">r</span><span style="font: 10pt serif">es head in high 5 bits}<br><br>{transfer IOCB offsets}<br>Set[parameters, 1]</span><span style="font: 10pt serif; color: aqua">;</span><span class="tab" val="79"></span><span style="font: 10pt serif">{pointer to parameter area}<br><br>{seek IOCB offsets}<br>Set[cy</span><span style="font: 10pt serif; color: aqua">l</span><span style="font: 10pt serif">inders, 0];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{-(number of cylinders to </span><span style="font: 10pt serif; color: aqua">m</span><span style="font: 10pt serif">ove heads)}<br>Set[stepHigh, 6];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{set step level high}<br>Set[stepLow, 8];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{set step level low}<br><br>{Miscellaneous disk constants}<br>Set[SA1000HeadCount,</span><span class="tab" val="79"></span><span style="font: 10pt serif">Sub[4,1]];<br>Set[SA4000HeadCount,</span><span class="tab" val="79"></span><span style="font: 10pt serif">Sub[4,1]];<br>Set[Q2040HeadCount,</span><span class="tab" val="79"></span><span style="font: 10pt serif">Sub[8,1]];<br>Set[Q2080HeadCount,</span><span class="tab" val="79"></span><span style="font: 10pt serif">Sub[7,1]];<br><br>{physical volume boot files}<br>{useful data formats extracted from Boot.mesa<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BootFileType: TYPE= {hardMicrocode, softMicrocode, germ, pilot, debugger, debugee};<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DiskFileID: TYPE= RECORD[fID: Fil</span><span style="font: 10pt serif; color: aqua">e</span><span style="font: 10pt serif">.ID, firstPage: File.PageNumber, da: DiskAddress];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">PVBootFiles: POINTER TO ARRAY BootFileType[hardMicrocode..pilot] OF DiskFileID= 2;<br><br>After reading from the disk, PVBootFiles moved to memory location 2}<br><br>Set[bootingInfo, 8];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{origin of PVBootFiles in physical volume root page}<br>Set[DiskFileIDSize, 9];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{number of words in DiskFileID}<br>Set[bootingInfoSize, Mul[DiskFil</span><span style="font: 10pt serif; color: aqua">e</span><span style="font: 10pt serif">IDSize, 4]];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{size of PVBootFiles}<br><br>{things salted away in page 0}<br>Set[availableDevices, 0];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{devices available for booting, set up by Phase 0}<br>Set[bootReadyFlag, 1];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{non-zero indicates boot file is ready}<br>Set[hardFileID, 2];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{hard microcode DiskFileID, copied</span><span style="font: 10pt serif; color: aqua"> </span><span style="font: 10pt serif">from physical volume root page}<br>Set[emulatorFileID, 0B];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{emulator microcode DiskFileID, copied from physical volume root page}<br>Set[germFileID, 14];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{germ DiskFileID, copied from physical volume root page}<br>Set[bootFileID, 1D];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{working DiskFileID, copied from one of the above fileID&rsquo;s}<br>Set[bootPage, 22];<br>Set[bootDiskAddr, 24];<br>Set[labelTemplate, 26];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{template label used by boot loading routines}<br><br>{germ definitions Mesa 11}<br>{<br>Set[germMapOffset,                         2];  <br>Set[germPageHigh,                          0];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{virtual page number of origin of germ -- 1B}<br>Set[germPageLow,                           1];<br>Set[sFirstGermRequestHigh,             001&rsquo;b];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{start of germ request in SD - high byte}<br>Set[sFirstGermRequestLow,              240&rsquo;b];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{start of germ request in SD - low byte}<br>}<br><br>Set[sLastGermRequest,                  Add[sFirstGermRequestLow, 57&rsquo;b]];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{end of germ request in SD}<br>Set[RequestSize,                        60&rsquo;b];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{size of germ request in SD}<br><br>Set[SD.Request.version,                Add[sFirstGermRequestLow, 00&rsquo;b]];<br><br>  Set[RequestVersionHigh,                  7];<br>  Set[RequestVersionLow,                56&rsquo;b];<br><br>Set[SD.Request.action,                 Add[sFirstGermRequestLow, 01&rsquo;b]];<br>  Set[bootPhysicalVolume,                  2];<br>Set[SD.Request.location,               Add[sFirstGermRequestLow, 02&rsquo;b]];<br>Set[SD.Request.location.deviceType,    Add[sFirstGermRequestLow, 02&rsquo;b]];<br>  Set[germPilotDisk,                    64&rsquo;d];<br>Set[SD.Request.location.deviceOrdinal, Add[sFirstGermRequestLow, 03&rsquo;b]];<br><br>{germ definitions mesa10}<br>{<br>{Set[germPageHigh, 0];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{virtual page number of origin of germ -- 1B}<br>Set[germPageLow, 1];}<br>Set[sFirstGermRequest, 320&rsquo;b];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{start of germ request in SD}<br>Set[sLastGermRequest, 377&rsquo;b];</span><span class="tab" val="79"></span><span style="font: 10pt serif">{end of germ request in SD}<br>Set[RequestSize, 60&rsquo;b];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">{size of germ request in SD}<br>Set[SD.Request.version, 320&rsquo;b];<br> { Set[RequestVersionHigh, 7];<br>  Set[RequestVersionLow, 56&rsquo;b];<br>}Set[SD.Request.action, 321&rsquo;b];<br>  Set[bootPhysicalVolume, 2];<br>Set[SD.Request.location, 322&rsquo;b];<br>Set[SD.Request.location.deviceType, 322&rsquo;b];<br>  Set[germPilotDisk, 64&rsquo;d];<br>Set[SD.Request.location.deviceOrdinal, 323&rsquo;b];<br>}<br><br>DoneOnceOnlyInit:<br>{For the four disk drives, the following applies:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q2040 - ~HeadSlelect16 = ~Sector. The two pins are connected physically.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q2040 - ~Sector = TRUE. Using positive logic.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SA4000- ~SA1000/SA4000 = TRUE. Positive logic.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SA1000- ~SA1000/SA4000 = FALSE & ~Sector = FALSE. Also positive logic.}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{First modify the IOCB for an SA1000 if necessary}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Xbus &larr; KStatus, XwdDisp,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {what type of disk is this?}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 0FF+1, DISP2[SetSA1IOCB, 2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {Point to table of IOCBs}<br>{there is an SA1000 drive connected.  Set the LabelDataTag bit in the HeaderLoopMsk and turn off the "Wait for Sector mark" command in the FindWord}<br>SetSA1IOCB:<br>{Test for SA1000 or Quantum depending on bit 9 of KTest after writing to<br> bit H16 of KCtl:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">KTest[9]=0 =&gt; SA1000<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">KTest[9]=1 =&gt; Quantum Q2040. For the Quantum Q2080 KCtl[0]=~KTest[9]}<br><br>{MESA 10:<br>        Xbus &larr; KTest, XwdDisp, </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[2,4,SetSA1IOCB]; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DISP2[IsSA1000orQuantum,1],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br>IsSA1000orQuantum:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 7 {sa1000}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[3,4,IsSA1000orQuantum]; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 3 {quantum}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[1,4,IsSA1000orQuantum]; <br><br>FinishIsSA1000orQuantum:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uQuantumSA1000MaxHeadNum &larr; rB,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>        acRrh &larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; <br><br><br>}{MESA 11:<br>}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 80,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[2,4,SetSA1IOCB];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">KCtl &larr; rB LRot8,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{Test for an SA1000 or Quantum}<br>        Xbus &larr; KTest, XwdDisp, </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DISP2[IsSA1000orQuantum,1],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{        Xbus &larr; KTest, XwdDisp, </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[2,4,SetSA1IOCB]; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DISP2[IsSA1000orQuantum,1],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>}<br><br>IsSA1000orQuantum:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; SA1000HeadCount {sa1000</span><span style="font: 8pt serif">}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[1,4,IsSA1000orQuantum];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif"><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">KCtl &larr; 0,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[3,4,IsSA1000orQu</span><span style="font: 10pt serif">antum]; {Test for a Quantum Q2040 or Q2080}<br>        Xbus &larr; KTest, XwdDisp, </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DISP2[IsQ2040orQ2080,1],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>IsQ2040orQ2080:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; Q2080HeadCount {Q2080}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[1,4,IsQ2040orQ2080];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; Q2040HeadCount {Q2040}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[3,4,IsQ2040orQ2080]; <br><br>{IsSA1000orQuantum:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 7 {sa1000}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[3,4,IsSA1000orQuantum]; <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 3 {quantum}, GOTO[FinishIsSA1000orQuantum], </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[1,4,IsSA1000orQuantum];} <br><br>FinishIsSA1000orQuantum:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uQuantumSA1000MaxHeadNum &larr; rB,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>        acRrh &larr; 0 {Point to table of IOCBs},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; <br><br>{JOIN}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [acRrh, vrrAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {get addr of vrr parameters}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE &larr; SA1FindSect,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {prepare to set FindSectCmd}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [acRrh, acR+headerLoopMsk],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set up new HeaderLoopMsk}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; SA1000HeaderLoopMsk, LOOPHOLE[wok], CANCELBR[$,2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">UFindSect &larr; rE</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {set FindSect mark cmd for<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">SA1000.}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [acRrh, vvrAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {get addr of vvr parameters}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {set up source of 0 for<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">below}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [acRrh, acR+headerLoopMsk],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set up new HeaderLoopMsk}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; SA1000HeaderLoopMsk, LOOPHOLE[wok], CANCELBR[DiskInitDone,2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{Connected to an SA4000 so set the Find Sector Mark command properly}<br>SetSA4IOCB: acR &larr; SA4FindSect,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[3,4,SetSA1IOCB];<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">UFindSect &larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {source of 0}<br>DiskInitDone:</span><span class="tab" val="79"></span><span style="font: 10pt serif">germStart&larr; rE,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acRrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set up stuff for IO page}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">currentCylinder&larr; rE,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; badBits,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uBadBits&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; driveSelectBit,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or firmwareEnable,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">seekMask&larr; acR, {seek Mask&larr; drive select or firmwareEnable}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or 20,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">haltBits&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {halt bits&larr; 420}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0F8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">headMask&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {headMask&larr; F800}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uBootStart&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {boot file starts at 200}<br><br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR{uDiagnostic} - 1, NZeroBr, BRANCH[pLispBoot, pMesaBoot],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>pLispBoot:</span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[LispBoot, MesaBoot],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>pMesaBoot: CANCELBR[MesaBoot, 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{map virtual pages 0-255 to real pages 0-255, first we must save the current mapping of the lowest virtual pages}<br><br>MesaBoot2: uDiagnostic&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>MesaBoot:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 0AA{Lisp},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uLispBootMsg &larr; rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">{MCtl &larr; 0} Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{{topPage &larr; MIN[topPage, AC0]}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 0AC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rB{topPage} - rC{AC0}, CarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">{MCtl &larr; 0, }BRANCH[$, trim],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; topPage, GOTO[mbjoin],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>trim:</span><span class="tab" val="79"></span><span style="font: 10pt serif">topPage &larr; rC, GOTO[mbjoin],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>}<br>mbjoin:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; topPage, L0&larr; 4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0FF+1, CALL[BLT3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{BLT3[from: 10000, to: 1topPage, cnt: 100h]}<br>{block transfer, takes count in acR, from in rB, and to in rC, returns first word past from block in rE}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; present,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[4, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 0FF+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{set up identity map for benefit of the disk microcode}<br>identityMap:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0], BRANCH[$, idDone],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, rB&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+rC, CarryBr, GOTO[identityMap],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>idDone:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, GOTO[rootPage],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br><br>{** Lisp uses identity map for all of real memory for benefit of the disk microcode}<br><br>LispBoot:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; 55{Mesa},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; Q xor uLispBootMsg, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 03{B}0{dirtyRef}, BRANCH[$, MesaBoot2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q{100}&larr; 0FF+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>nextId3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{acR{dirtyRef}, rB{10000}, Q{100},   map 2&uarr;12 pages as identity}<br><br>nextId:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, acR &larr; acR + Q{100}, CarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+1, BRANCH[nextId, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>incSeg:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR + 1, NibCarryBr{2&uarr;12 pages},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; topPage{virtual}, BRANCH[nextId3, Zdone],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>Zdone:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; 0E - rC, PgCarryBr{if rC is low or eq},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 0B0{2mb+dirty}, BRANCH[ZnextId3, doneId],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;{%%}<br><br>{acR{2mb+dirty}, rB{11000}, Q{100},   map next 2&uarr;12 pages as identity}<br><br>ZnextId:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, acR &larr; acR + Q{100}, CarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+1, BRANCH[ZnextId, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>ZincSeg:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; acR + 1{9}, NibCarryBr{2&uarr;12{11} more pages},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR + 1, BRANCH[ZnextId3, doneId],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>ZnextId3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, GOTO[ZnextId],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>doneId:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR{dirty;page FF}&larr; ~0DF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh&larr;1{FirstRealPageToMapHigh},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 040{FirstRealPageToMap},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{14000} &larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{acR{FF20}, rB{12000}, rCrh,rC{14000},  remaining vp&rsquo;s mapped to FF}<br><br>Scrap:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0], BRANCH[$, doneScrp],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>Scrap2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR{-1}, rB&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rB - rC{4000}, ZeroBr, GOTO[Scrap],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>doneScrp:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{acR{-1}, rCrh,rC{14000},  change 65 map entries to protect the map and old iopage (as known to sysout) to point to FF{-1}}<br><br>Protect65:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Map{14000}&larr; [rCrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR{-1}, rC&larr; rC, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC - 0FF - 1, BRANCH[Protect65, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{Mesa11: Real Page 20000 is IOPage for Mesa11 but stack for Lisp}<br>{Divert the reading of page 20000 from newIOPage to oldIOPage}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh &larr; 2{IOPageHigh},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 40,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Map{20000} &larr; [rCrh{2}, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR{4031} &larr; acR or 31,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br><br>{Start flailing away at the disk.  First read the physical volume root page}<br>rootPage:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rDrh&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rErh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD&larr; 0FF+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {base address of IOCB page}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; headerAddr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh,  rE+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {cylinder 0}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {read starting at page 2}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {head 0, sector 0}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; 0, CANCELBR[$, 0], L1&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVrr],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {read 1 sector}<br><br>transferRet:  Ybus&larr; acR and uBadBits, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">transferIOCB&larr; rE, BRANCH[$, here1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceError, GOTOABS[Maintenance1Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{save the useful stuff from the physical volume root page}<br>here1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {copy PVBootFiles}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+bootingInfo, L0&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; bootingInfoSize, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 2, c1, at[0, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot8, c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh &larr; 0, c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rCrh, hardMicrocodeFirstPage + 0], c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">, c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; MD, c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uFirstPage &larr; rC, c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">, c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">, c3;<br><br>{read the emulator boot file or the hard microcode}<br>emuHard:</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 ;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; bootFileID, BRANCH[$, emuHard0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  rB&larr; hardFileID, L0&larr; 8, GOTO[emuHard1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>emuHard0:</span><span class="tab" val="79"></span><span style="font: 10pt serif">  rB&larr; emulatorFileID, L0&larr; 8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>emuHard1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; DiskFileIDSize, CALL[BLT2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 2, L2&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[8, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPage&larr; acR, CALL[readBoot3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0, 10, readBootRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; nextPage, BRANCH[$, readGerm],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybu</span><span style="font: 10pt serif; color: cyan">s&larr; rC{u</span><span style="font: 10pt serif">Diagnostic}-1, NZeroBr,</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c2;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">Noo</span><span style="font: 10pt serif">p, BR</span><span style="font: 10pt serif; color: cyan">ANCH[$, </span><span style="font: 10pt serif">doDiag],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{test if w</span><span style="font: 10pt serif; color: cyan">e have li</span><span style="font: 10pt serif">sp or</span><span style="font: 10pt serif; color: cyan"> diagnos</span><span style="font: 10pt serif">tics in real memory}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r</span><span style="font: 10pt serif; color: cyan">C</span><span style="font: 10pt serif"> &larr; 15{passH},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 3,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh{0} &larr; rB{300} &larr; rB LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0F{passA}],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{passH} &larr; rC LRot8, CANCELBR[$, 2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; MD xor rC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC xor 0E3{passL},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rC, NZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, BRANCH[$, notLisp],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{ We have Lisp; Restore the map.}<br>{set map[0..3FFFF] to vac</span><span style="font: 10pt serif; color: cyan">a</span><span style="font: 10pt serif">nt and interpret F</span><span style="font: 10pt serif; color: cyan">P</span><span style="font: 10pt serif">TOVP}<br><br>LispInit:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB{7</span><span style="font: 10pt serif; color: cyan">F</span><span style="font: 10pt serif">FF}&larr; ~1 RRot1, rBrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif; color: cyan">r</span><span style="font: 10pt serif">B{3FFF}&larr; rB RShift1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2</span><span style="font: 10pt serif; color: cyan">;</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 60{vacant},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>vacLp</span><span style="font: 10pt serif; color: cyan">:</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">MAR&larr;</span><span style="font: 10pt serif"> [rBrh{0C1}, rB+0], ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MD</span><span style="font: 10pt serif; color: cyan">R</span><span style="font: 10pt serif">&larr;</span><span style="font: 10pt serif; color: cyan"> </span><span style="font: 10pt serif">rC{vacant}, </span><span style="font: 10pt serif; color: cyan">r</span><span style="font: 10pt serif">B&larr; rB-1, NibCar</span><span style="font: 10pt serif; color: cyan">r</span><span style="font: 10pt serif">yBr, BRANCH[$, vDone],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2</span><span style="font: 10pt serif; color: cyan">;</span><span style="font: 10pt serif"><br>vac3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, BRANCH[$, vacLp]{match to vacRef+1},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>vacRef:</span><span class="tab" val="79"></span><span style="font: 10pt serif">{Refresh,}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Xbus &larr; 1, XDisp, GOTO[vac3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>vDone: Noop, CANCELBR[$, 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{update Interface page and interpret FPTOVP}<br><br>{Map[InterfacePageVp] &larr; 3}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acRrh &larr; 26&rsquo;b{INTERFACEspace}, CANCELBR[$, 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 20&rsquo;b{INTERFACEbase=10000&rsquo;b},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 3{real interface page},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB{300} &larr; rB LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; rB + 03{B}0{dirty},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Map{161000} &larr; [acRrh,acR],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; rB{3B0},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 0C{(NRealPages{3072})/256},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 15&rsquo;b{MachineType} + 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; 6{\DANDELION},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{C00} &larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; topPage{virtual},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; Q + 40,{ map not included}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q{NRealPages} &larr; Q + {02}{0A8}{-56 mp301}0FF{+1}{bank 0 was not incl but},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 70&rsquo;b{NRealPages} + 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; Q{NRealPages} {&larr; topPage}{rC{C00}},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{%% no segment crossing of FPTOVP[i-1] ptr ??? }<br><br>{interpret FPTOVP setup}<br>{for i{acR} &larr; 501&rsquo;b to MaxRealPage{rC}</span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{</span><span class="tab" val="79"></span><span style="font: 10pt serif">unless FPTOVP[i-1]=none{-1}</span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{</span><span class="tab" val="79"></span><span style="font: 10pt serif">do MAP[FPTOVP[i-1]]:vp &larr; i</span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, 73&rsquo;b{FPTOVPStart} + 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR{F2Vpage} &larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR{F2VrealPage+1} &larr; acR + 2{file1=real2}{+1},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acRrh &larr; acR &larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR and ~0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR{F2V+500b} &larr; acR + 40,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{501b} &larr; rC + 41,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{interpret FPTOVP Loop </span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{acR:</span><span class="tab" val="79"></span><span style="font: 10pt serif">FPTOVP[i-1] ptr </span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{rB:</span><span class="tab" val="79"></span><span style="font: 10pt serif">FPTOVP[i-1]:vp</span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{rC:</span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; 501b</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{Q:</span><span class="tab" val="79"></span><span style="font: 10pt serif">NRealPages= C00</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br>{rBrh:</span><span class="tab" val="79"></span><span style="font: 10pt serif">10000{Map}</span><span class="tab" val="79"></span><span style="font: 10pt serif">}<br><br>{spin2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[spin2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;}{%%%}<br><br>f2vLp:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; acR &larr; [acRrh, acR + 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB{7FFF} &larr; (rB xor ~rB) RShift1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB{vp} &larr; MD and rB{7FFF},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rB + rB, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot8, XRefBr, BRANCH[$, none],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rC + 0F, NibCarryBr{nondisplay bank?}, BRANCH[$, fvMod],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh{1}, rB + 0], BRANCH[fvNo, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; rC{i}, GOTO[none],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>fvNo:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, GOTO[none],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>fvMod:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh{1}, rB + 0], BRANCH[fvMNo, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; rC{i} + 70{move over flags to "dp" bit}, GOTO[none],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>fvMNo:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, GOTO[none],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>none:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot8, CANCELBR[$, 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rC xor Q{NRealPages}, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; acR + 1, BRANCH[f2vLp, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{spin3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[spin3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;}{%%%}<br><br>{done with interpret FPTOVP}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 40,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{4000} &larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{Map[IOPageVp=0FF] &larr; {140}500&rsquo;b}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR{100FF}&larr; [rBrh{1}, rB + 0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR{4001} &larr; rC{4000} + 1,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rC{100} &larr; 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rC{200} &larr; rC</span><span style="font: 10pt serif"> + rC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{400} &larr; rC + rC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uBootStart&larr; rC{400}, {GOTO[StartNewInit],}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>bankTest: Q &larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Bank &larr; rB &larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>btLoop: rC &larr; ~ PPort, BRANCH[$, {GOTO[}MultiBank],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>btLL: rC &larr; (rC LRot8) xor Q,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rC and 3, NZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; Q + {0FF +} 1, BRANCH[$, GoNewInit{UniBank}],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Bank &larr; rB +4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; rB +4, NibCarryBr,{}{%}</span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[btLoop],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>MultiBank:        rB&larr; 4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh{0} &larr; rB{400h}&larr; rB LRot8, c2; {boot file starts at 200}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 3{2nd .db},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{400q}{100} &larr; 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC+rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uBootStart&larr; rC{400},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>        Noop,GOTO[GoNewInit],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>GoNewInit:</span><span class="tab" val="79"></span><span style="font: 10pt serif">{copy data diverted from newIOPage to oldIOPage back to newIOPage}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 40,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; rB LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 0FF + 1, L0&larr; 0D,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh &larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{BLT cnt/acR:100 from/rB:14000 to/rC:20000}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{clear oldIOPage to zeros}</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0D{free?}, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 40,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; rB LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{Initialize uIOPage register}</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rB or 1, c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uIOPage &larr; rC{4001},  c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>ioclp:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rBrh{14000}, rB+0], BRANCH[$, ioclrDone],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; acR and ~acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; rB +1, PgCarryBr, GOTO[ioclp],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>ioclrDone:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[StartNewInit],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>BackFromNewInit:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> TOS{8002h} &larr; RRot1 5,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MCtl &larr; TOS{8002h}, GOTO[exitToEmulator],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{hard microcode (quick exit), get diagnostic table entry from first page of boot file}<br>doDiag:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 055{Mesa}, GOTO[doDiag2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>notLisp:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 055{Mesa}, GOTO[doDiag2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>doDiag2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">uLispBootMsg &larr; rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {boot file starts at 200}<br><br>{{topPage &larr; MIN[topPage, AC0]}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; 0AC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; rB{topPage} - rC{AC0}, CarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 2, BRANCH[$, trim1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {boot file starts at 200}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; topPage, GOTO[mbjoin1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>trim1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">topPage &larr; rC, GOTO[mbjoin1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>}<br>mbjoin1: <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; uDiagnostic,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC{uDiagnostic=1}+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{400q}{100} &larr; 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{**}{</span><span class="tab" val="79"></span><span style="font: 10pt serif">rC{1000q}{200} &larr; rC+rC{rC&larr; MD},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC+rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uBootStart&larr; rC{400},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MCtl&larr; 0, GOTO[exitToEmulator],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;{%mesa small mem}<br><br><br>{read the germ}<br>readGerm:</span><span class="tab" val="79"></span><span style="font: 10pt serif">germStart&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; germFileID,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; bootFileID, L0&larr; 9,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; DiskFileIDSize, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">L2&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[9, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CALL[readBoot3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{<br><br>We now have the germ in real memory.  Restore the map for pages 0-255.  Then move the germ to MDS 0, starting at page 1.  Initialize the Request in the germ&rsquo;s SD.<br>}<br>RestoreMap:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[1,10,readBootRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 0, L0&larr; 5,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0FF+1, CALL[BLT3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{vacate the pages just used to restore the low ones}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; topPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[5, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 20{0FF+1},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; vacant, L0&larr; 0B,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8{acR-1}, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{Move germ to MDS 0, page 1}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; germStart,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0B, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; rC LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; nextPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; rD - rC, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">transferCount &larr; rD, BRANCH[moveGerm1, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {number pages in germ}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootNullGerm, GOTOABS[Maintenance2Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br>moveGerm1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">germStart&larr; acR xor ~acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rFrh &larr; germPageHigh, rF &larr; 0 + germPageLow,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rF &larr; rF LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>mg2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Map &larr; [rFrh, rF],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rCrh &larr; rC &larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC and ~0FF, L0 &larr; 0C,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rF &larr; rF + 0FF + 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0C, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; rD - 1, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE &larr; LShift1 0FF, SE &larr; 1, BRANCH[mg2, InitRequest],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br><br>{Initialize Request in germ&rsquo;s SD}<br><br>InitRequest: </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">{rE has 1FF = start of SD -1}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequestHigh,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; rC LRot8,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;  {Constants use an 8-bit data path.}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE &larr; rE + rC + 1,  {correct page}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Map &larr; rF &larr; [rFrh, rE + 0],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequestLow,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; MD,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br>{InitRequest:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Map &larr; rF &larr; [rFrh, rE + 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC &larr; sFirstGermRequest,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rBrh &larr; rB &larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>}<br><br>ZeroReq:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rBrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; rD, rC &larr; rC + 1, PgCarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {rD zero from above}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[ZeroReq, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; RequestVersionHigh,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; rD LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rD &larr; rD or RequestVersionLow,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.version+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; rD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.action+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; bootPhysicalVolume,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR &larr; [rBrh, SD.Request.location.deviceType+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR &larr; germPilotDisk,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>doneReq:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MCtl &larr; 0, GOTO[exitToEmulator],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br><br>{Read the first page of the bootFile.  Calculate the proper label by reading the label from the disk and filing in the correct fileID and page number}<br>readBoot3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>readBoot:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rD+headerAddr, L0&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {disk address of boot}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 2, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{block transfer, takes count in acR, from in rB, and to in rC, returns first word past from block in rE}<br>{*4}</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[1, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rD or 80{uLinkPtr}{+{1}headerAddr}, L0&larr; 0E{*free?},</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {save for lisp}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 2, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB &larr; 82,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[0E{*free?}, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">uLinkPtr &larr; rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {nil disk address?}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[$, nilBootFile],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; nextPage, L1&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVrr2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {read 1 starting at page 2}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR and uBadBits, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[1, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rD+labelAddr, BRANCH[$, here2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {write fileID into label}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceE</span><span style="font: 10pt serif; color: cyan">rror, GOTOAB</span><span style="font: 10pt serif">S[Maintenance1Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>here2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; bootFileID, L0&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">acR&larr; 6, CALL</span><span style="font: 10pt serif">[BLT2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {+low 16 bits of page #}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE </span><span style="font: 10pt serif; color: cyan">and 7F</span><span style="font: 10pt serif">,</span><span class="tab" val="79"></span><span style="font: 10pt serif; color: cyan">c1, at[2, </span><span style="font: 10pt serif">10, sub</span><span style="font: 10pt serif; color: cyan">rRet];<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">rE&larr; </span><span style="font: 10pt serif">rE LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c</span><span style="font: 10pt serif; color: cyan">2; {rE&larr; </span><span style="font: 10pt serif"> high bits of page#}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; LShift</span><span style="font: 10pt serif; color: cyan">1 rE,</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c3</span><span style="font: 10pt serif">;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rC</span><span style="font: 10pt serif; color: cyan">rh, </span><span style="font: 10pt serif">rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr;  7,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD</span><span style="font: 10pt serif; color: cyan"> and acR,</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c3;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">MAR&larr; [rCrh, rC+0],</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c1;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">MDR&larr; acR or rE,</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c2;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">rC&larr; rC-1,</span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">c3;<br></span><span class="tab" val="213"></span><span style="font: 10pt serif; color: cyan">MAR&larr;</span><span style="font: 10pt serif"> [rCrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {read low 16 bits of page #}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; bootDiskAddr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC+1, {reading first page is a special case}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">filePage&larr; rC,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {restore disk address}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rD+headerAddr, L0&larr; 3,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 2, CALL[BLT2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; nextPage, L1&larr; 5,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[3, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVvr3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {read 1 starting at page 2}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR and uBadBits, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[5, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; nextPage, BRANCH[$, here3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceError, GOTOABS[Maintenance1Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>here3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPage&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {label template}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; labelSize,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rD+labelAddr, L0&larr; 6,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; labelTemplate, CALL[BLT2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br>{read the rest of the file from the Pilot Volume}<br>readLoop:</span><span class="tab" val="79"></span><span style="font: 10pt serif">L1&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[6, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CALL[pagesLeftInCylinder3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">transferCount&larr; acR, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[1, 10, miscRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">L1&larr; 4, BRANCH[readRun, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{no pages left in cylinder, advance to next cylinder}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {step in one cylinder}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; 0, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {start at head 0, sector 0}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0], L1&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR+1, CALL[pagesLeftInCylinder3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[2, 10, miscRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">transferCount&larr; acR, L1&larr; 4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>readRun:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; nextPage, CALL[doVvr],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; acR and uBadBits, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[4, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; transferCount, BRANCH[readBurp, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; filePage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {next page in file}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">filePage&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; nextPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {next page in memory}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPage&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[readLoop],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{burped while reading run of pages, status in acR.  rB has number of sectors requested}<br>readBurp:</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; rE and ~verifyBit, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, vvrAddr+0], BRANCH[$, verifyError],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {get # of sectors remaining}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceError, GOTOABS[Maintenance3Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {not a verify error}<br>verifyError:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; acR LRot4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {shift field bits}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {parameter area}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+sectors],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC and 0C,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {number sectors remaining}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr;  rC xor 8, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {label verify error?}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rB-acR, BRANCH[$, verErr1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {number sectors transferred}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceError, GOTOABS[Maintenance1Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {not in label}<br>verErr1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">transferCount&larr; acR, {zero is okay}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; filePage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE+acR+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {file page for next label}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">filePage&larr; rE,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; nextPage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+acR+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {next available page for vvr}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPage&larr; rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB-1, L1&larr; 6,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {page used by vrr}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 1, CALL[doVrr3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {transfer 1 page}<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR and uBadBits, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[6, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[$, verErr3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootDeviceError, GOTOABS[Maintenance1Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>verErr3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{Copy boot link to header,  and check for end of file, FFFF in both words of boot link.}<br>{*1,2 Check for end of file before copying boot link to header}<br>{*0 stop reading after 768Kw max real memory}<br>{*0}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, labelPageLow+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{*0}</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ybus &larr; acR - 0C, {NibCarryBr{vPage&gt; 768*4},}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, BRANCH[$, endRead1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, bootLink+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*1</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, bootLink+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*2</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rB, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR or rB, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+1, BRANCH[rdBurp1, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; bootBrokenChain, GOTOABS[Maintenance3Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {boot chain link is zero}<br>rdBurp1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR or rB, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rD+labelAddr, BRANCH[rdBurp2, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  GOTO[endRead],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {found end of chain, return}<br>rdBurp2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*1}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR-1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rB-1, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{*2}</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q&larr; uLinkPtr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Temp &larr; filePage, c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rK &larr; uFirstPage, c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">, c3;<br><br>{*5}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr;  Temp - rK,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*5}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR-1, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*5}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, Q{uLinkPtr}+2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rB - 1, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q{uLinkPtr} &larr; Q +3, PgCarryBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; labelSize, BRANCH[there1, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">{Noop,} L0&larr; 7, GOTO[there2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>there1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">uLinkPtr &larr; Q{uLinkPtr+3}, L0&larr; 7,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>there2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; labelTemplate, CALL[BLT],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, labelPageLow+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[7, 10, subrRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; filePage,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[readLoop],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>endRead:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>endRead1:Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">RET[readBootRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{here if boot file pointer was zero}<br>nilBootFile:</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; uDiagnostic, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 1 {disk Boot}, BRANCH[noDiagnostics, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; germStart, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[noGerm, noEmulator],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>noEmulator:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; bootNoEmulator, GOTOABS[Maintenance2Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>noGerm:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; bootNoGerm, GOTOABS[Maintenance2Loc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br>{this code tries a disk boot if no hard microcode is installed}<br>noDiagnost</span><span style="font: 10pt serif; color: cyan">i</span><span style="font: 10pt serif">cs:</span><span class="tab" val="79"></span><span style="font: 10pt serif">uDiagnostic&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bootDevice &larr; acR {disk Boot}, GOTO[emuHard],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{subroutines}<br><br>doVvr3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>doVvr:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, vvrAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[doTransfer],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{does verify, read, read operation to the disk<br>Takes number of sectors in acR, page number in rB, and disk address in header area.<br>Returns status in acR<br>Clobbers rE}<br>doVrr2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>doVrr3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>doVrr:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, vrrAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {base of vrr parameters}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>doTransfer:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+sectors],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set up paramter area}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {sector count}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+dataPage],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rB - 1, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {first page in main storage}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rD+ transferAddr],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {base of transferIOCB}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rE, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {base of vrr parameter area}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+parameters],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {read head}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR LRot4,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR RRot1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR and headMask,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or haltBits,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rC+haltWord],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {write halt word}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or UFindSect,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rC+findWord],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {write find word}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, CANCELBR[$, 0], L0&larr; 2,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rE, CALL[seek],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR and uBadBits, ZeroBr, L0&larr; 3,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[2, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[transferError, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rC, CALL[diskOp],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>transferRet1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[3, 10, transferRet];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>transferRet2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">RET[transferRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>transferError:</span><span class="tab" val="79"></span><span style="font: 10pt serif">GOTO[transferRet1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{call with IOCB in rE, returns when disk operation complete with status in acR}<br>{diskOp1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>diskOp2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>diskOp:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; IOPageLow,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[2, 4];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [acRrh, diskCSB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;}diskOp:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acRrh &larr; IOPageHigh,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{AEF 9/14/83 - why is this instruction at[2, 4]?}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR &larr; uIOPage,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c3, at[2, 4];<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [acRrh, DiskCSBOffsetIOCB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rE,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{***<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; firmwareEnable,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*}<br>{* observe segment crossings}<br>{*}<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, statusAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set invalid status}<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; badBits,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">KCtl&larr; acR LRot0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {start the transfer}<br>{*}<br>{*}transferWait:<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; ~KStatus, BRANCH[$, trRef], </span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>{*}trWa2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR LRot8, XDisp,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {busy?}<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; Q + 1, NibCarryBr, BRANCH[trDone, transferWait, 0E],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*}<br>{*}trRef:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop, </span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">{Refresh,} GOTO[trWa2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>{*}<br>{*}trDone:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, statusAddr+0], CANCELBR[$, 1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet0, LOOPHOLE[natc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>{*}</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD, RET[transferRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {return status in acR}<br>***}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, statusAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {set invalid status}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; badBits,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; firmwareEnable,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {start the transfer}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">KCtl&larr; acR LRot0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>transferWait:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; ~KStatus, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[0F, 10, transferWait];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR LRot8, XDisp,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {test firmware busy}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, statusAddr+0], BRANCH[$, transferWait],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet0, LOOPHOLE[natc],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[0E, 10, transferWait];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD, RET[transferRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {return status in acR}<br><br>{call with current cylinder in currentCylinder, and desired cylinder in cylinder field of header}<br>seek:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; currentCylinder, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {target}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB-acR, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {delta number of cylinders}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">currentCylinder&larr; acR, BRANCH[$, noSeek],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; rB, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0, BRANCH[seekOut, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; inBit, GOTO[seek1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>seekOut:</span><span class="tab" val="79"></span><span style="font: 10pt serif">  rB&larr; -rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>seek1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR or seekMask, {enable firmware, drive select}</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, seekAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {address of seek IOCB}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+cylinders],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rB,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+stepHigh],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR or stepBit, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, rE+stepLow],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE+1, GOTO[diskOp],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>noSeek:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet0, GOTO[transferRet2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{Be careful, these routines are device dependent!  Only routines for SA1004 and SA4008 are supplied}<br><br>{Uses data left in last header to compute pages left in cylinder, returns result in acR.}<br>pagesLeftInCylinder3:  Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>pagesLeftInCylinder: Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {SA4000 or SA1000?}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Xbus&larr; KStatus, XwdDisp,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BRANCH[SA1000Left, $, 2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{SA4008, pages left in cylinder= (28-sector)+(8-head-1)*28}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[3,4,SA1000Left];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 7, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rE LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR and 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {head}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE and 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {sector}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rB-acR, NegBr, L0&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; 28&rsquo;d, BRANCH[multiply, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {off the end of the cylinder}<br>OffEnd:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet1, GOTO[pgLft1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br><br>{return from multiply}<br>divMultRet:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; Q+28&rsquo;d, pRet1, GOTO[pgLft1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2, at[0, 10, divMultRet];<br><br>{SA1004, pages left in cylinder= (16-sector)+(4-head-1)*16}<br>SA1000Left:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1, at[2,4,SA1000Left];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; uQuantumSA1000MaxHeadNum, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rE LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR and 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {head}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE and 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {sector}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rB-acR, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; acR LRot4, BRANCH[SA1000More, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2; {(4-head-1)*16}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0, GOTO[OffEnd],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3; {off the end of the cylinder}<br>SA1000More:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rB+16&rsquo;d, pRet1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>pgLft1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR-rE, RET[miscRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>{multiply, call with multiplier in rB, multiplicand in acR, uses rC, result left in Q<br>  timing:</span><span class="tab" val="79"></span><span style="font: 10pt serif">45 cycles  main loop is 3 cycles times 15 iterations<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> 4 cycles last iteration<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> 3 cycles preamble<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> 1 cycles postamble<br>  total</span><span class="tab" val="79"></span><span style="font: 10pt serif">53 cycles  (2 MOD 3}<br><br>multiply:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0&rsquo;x,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 10&rsquo;x,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>mult0:</span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; Q and 1, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC-1, ZeroBr, BRANCH[mult1, mult2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>mult1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; DARShift1 (acR+rB), BRANCH[mult0, mult3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>mult2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR DARShift1, BRANCH[mult0, mult3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>mult3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q&larr; ~Q, pRet0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">RET[divMultRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;<br><br>{divide, call with dividend in acR, divisor in rB, uses rC, result left in Q remainder in acR<br>  timing:</span><span class="tab" val="79"></span><span style="font: 10pt serif">64 cycles  main loop is 4 cycles times 16 iterations<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> 3 cycles preamble<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> 2 cycles postamble<br>  total</span><span class="tab" val="79"></span><span style="font: 10pt serif">69 cycles (0 MOD 3)}<br><br>{divide:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q&larr; acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; 10&rsquo;x,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>div0:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR DALShift1, Cin&larr; 1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;</span><span class="tab" val="79"></span><span style="font: 10pt serif">{shifts in a zero!!!!!}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR-rB, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC-1, ZeroBr, BRANCH[div1, div2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>div1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Q&larr; Q or 1, BRANCH[div0, div3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>div2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+rB, BRANCH[div0, div3],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>div3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">pRet0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">RET[divMultRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c*;}</span></div>
<div style="width: 491pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"><br>{compare two blocks of memory, takes count in acR, and addresses in rB, and rC, clobbers rE,<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">returns count in acR where compare first lost, (acR=0)=&gt; compare succeeded}<br>{compare3:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>compare:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rBrh, rB+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD, BRANCH[comp1, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  GOTO[endBLT1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br>comp1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rCrh, rC+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE xor MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; rE, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR-1, BRANCH[$, comp2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  acR&larr; acR+1, pRet0, GOTO[endBLT2],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>comp2:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rB&larr; rB+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rC&larr; rC+1, GOTO[compare],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;}<br><br>{increments header}<br>{incrHdr:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; rE and 0FF,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {sector}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; acR+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; acR-27&rsquo;d, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE and ~0FF, BRANCH[incHd, $],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1; {head}<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE or acR,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>incHdr0:</span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br>incHdr1:</span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+1],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; rE, pRet0, CANCELBR[$, 0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">RET[subrRet],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br><br>incHd:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE LRot8,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE+1,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[]&larr; rE-7, NegBr,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; rE LRot8, BRANCH[$, incHdr0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br>incCyl:</span><span class="tab" val="79"></span><span style="font: 10pt serif">rE&larr; 0,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">acR&larr; MD,</span><span class="tab" val="79"></span><span style="font: 10pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MAR&larr; [rDrh, headerAddr+0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MDR&larr; acR+1, GOTO[incHdr0],</span><span class="tab" val="79"></span><span style="font: 10pt serif">c2;}</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
