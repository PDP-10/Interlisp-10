<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>fugue.5>Sources>dlion>EtherDLion.mc!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{File name:  EtherDLion.mc<br> Description: Dandelion Ethernet Microcode,<br> Author: Sandman,<br> Created: October 23, 1980  10:42 AM,<br> Last Edited:<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Jim Frandeen, March 16, 1982  11:49 AM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Fix bug that was storing the mask into the wrong word.<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Jim Frandeen, March 5, 1982  3:01 PM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Fix bug encountered if 1st word of receive packet buffer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">lies in last word page.<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Amy Fasnacht, February 18, 1982  12:02 PM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Call EMap to restore register E after MAR on second word of input buffer<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Dan Davies, February 17, 1982  3:38 PM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Fix bug encountered if 1st word of receive packet buffer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">lies in last word of 64K space.  Also shorten code.<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Jim Frandeen, February 3, 1982  9:53 AM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">If waiting to transmit is interrupted, remember where we<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">we were so we can continue there next time.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Limit random number to 10 bits.<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">HGM, August 28, 1981  10:45 AM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Flap transmitter after sending (2000ft bug) (1mi)<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">HGM, June 25, 1981  11:30 PM,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Load host number if transmit first<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">Move Purge EStrobe to c2 for hardware InUnderOut fix (1 mi)<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">HGM, June 11, 1981  12:40 AM, Runt filter (4 mi)<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Sandman, November 12, 1980  11:42 AM<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">HGM, June 10, 1981  9:38 PM, NegBr @EDeferLoop to avoid long delays<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Garner, April 21, 1981  8:01 PM:  rhEE&larr;0 @EFullMask}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{*****************************************************************************<br>Definitions<br>*****************************************************************************}<br><br>{Offsets and Magic locations}<br>Set[IOPage.ECSB, 0C0];<br>Set[ECSB.host0, 0];<br>Set[ECSB.host1, 1];<br>Set[ECSB.host2, 2];<br>Set[ECSB.icb, 3];<br>Set[ECSB.iWakeup, 4];<br>Set[ECSB.ocb, 5];<br>Set[ECSB.oWakeup, 6];<br>Set[ECSB.lost, 7];<br>Set[IOPage.ECSB.host0, Add[IOPage.ECSB, ECSB.host0]];<br>Set[IOPage.ECSB.host1, Add[IOPage.ECSB, ECSB.host1]];<br>Set[IOPage.ECSB.host2, Add[IOPage.ECSB, ECSB.host2]];<br>Set[IOPage.ECSB.icb, Add[IOPage.ECSB, ECSB.icb]];<br>Set[IOPage.ECSB.iWakeup, Add[IOPage.ECSB, ECSB.iWakeup]];<br>Set[IOPage.ECSB.ocb, Add[IOPage.ECSB, ECSB.ocb]];<br>Set[IOPage.ECSB.oWakeup, Add[IOPage.ECSB, ECSB.oWakeup]];<br>Set[IOPage.ECSB.lost, Add[IOPage.ECSB, ECSB.lost]];<br><br>Set[IOCB.size, 0];<br>Set[IOCB.buffer, 1];<br>Set[IOCB.bufferHi, 2];<br>Set[IOCB.mask, 3];<br>Set[IOCB.used, 4];<br>Set[IOCB.completion, 5];<br>Set[IOCB.next, 6];<br>Set[IOCB.spare, 7];<br><br>Set[eEnableRcv, 1];<br>Set[eTurnOff, 2];<br>Set[eLocalLoop, 4];<br>Set[eLoopBack, 8];<br>Set[eOff, 0];<br>Set[eEnableTrn, 1];<br>Set[eLastWord, 2];<br>Set[eDefer, 4];<br>Set[eEnableTrnDefer, 5];<br>Set[eEnableTrnLastWord, 3];<br>Set[eInitialCountdown, 14]; {14X = 20D; 51.2us*20 ~ 1ms}<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">Set[L6.EReceive, 0];<br>Set[L6.EXmit, 1];<br><br>Set[L6.Host0, 2];<br>Set[L6.Host1, 3];<br>Set[L6.Host2, 4];<br>Set[L6.NoICB, 5];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">Set[L6.Remap, 1];<br>Set[L6.ERMap, 2];<br>Set[L6.ETMap, 3];<br>Set[L6.EREndMap, 4];<br>Set[L6.EXmitAbort, 5]; {1 MOD 2}<br>Set[L6.ETEndMap, 6];<br>Set[L6.ETCross, 7]; {1 MOD 2}<br>Set[L6.ERCross, 0C]; {in instruction with GOTO[ERead]}<br>Set[L6.ERCrossEnd, 9];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">SetTask[2];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">StartAddress[EColdStart];<br><br>{*****************************************************************************<br>Initial code<br>*****************************************************************************}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">EColdStart:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rhE &larr; E &larr; uIOPage, CANCELBR[$,0F],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus &larr; EStatus, XLDisp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rhEE &larr; 0, BRANCH[EHostTR, EStop, 2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{Fetch host and input IOCB from CSB}<br>EHostTR:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.host0+0], L6&larr;L6.Host0,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[2,4,EStop];<br>EHost:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uXmitInterrupt &larr; 0, L6Disp, CALL[EFetch3],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.host1+0], L6&larr;L6.Host1,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.Host0,10,EFetch];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEHost0 &larr; EE, L6Disp, CALL[EFetch3],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.host2+0], L6&larr;L6.Host2,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.Host1,10,EFetch];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEHost1 &larr; EE, L6Disp, CALL[EFetch3],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.icb+0]</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.Host2,10,EFetch];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEHost2 &larr; EE, L6&larr;L6.EReceive, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>EStart:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rhE &larr; E &larr; uIOPage, CANCELBR[$,0F],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus &larr; EStatus, XLDisp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rhEE &larr; 0, DISP2[EGo],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>ERecieve:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.icb+0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[2,4,EGo];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">L6&larr;L6.EReceive, CALL[ECBFetch],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{map input buffer}<br>ERGotIOCB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Map &larr; [rhEE, EE], CALL[EMap2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.EReceive,10,EFetch];<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE+0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.EReceive,10,EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; E &larr; EIData, L6 &larr; L6.ERMap,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEDest0 &larr; E, CALL[EMap], {to restore E only}</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {be prepared for page cross}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, EE+1], L6 &larr; L6.Remap,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ERMap, 10, EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE &larr; EIData, BRANCH[$, RemapWord2, 1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>NoWd2Remap:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uEDest1 &larr; EE, GOTO[StoreWord3],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[1,4,RemapWord2];<br><br>{Get here if the second word of the packet was on a new page.  Packets buffers begin at addresses ending in 3 MOD 4.  A page boundry can only occur after the first word.<br>uEBuffer contains the value of EE at the time of the MAR &larr; above.}<br>RemapWord2:</span><span class="tab" val="79"></span><span style="font: 8pt serif"><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEDest1 &larr; EE, </span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[3,4,NoWd2Remap];<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; 0,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,CALL[ECNextPage],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE,0+0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.Remap,10, EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE &larr; uEDest1, GOTO[NoWd2Remap],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{Get here whether or not the second word was on a new page.  Store the third packet word which is also the final destination address word.}<br>StoreWord3:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, E+1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE &larr; EIData, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">[] &larr; EE xor uEHost2, NZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {start check for correct address}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEDest1, BRANCH[$,ECheckBCast2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">[] &larr; EE xor uEHost1, NZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[0,2,ECheckBCast2];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEDest0, BRANCH[ECheckAddr0, $],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[ECheckBCast2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[1,2,ECheckAddr0];<br>ECheckAddr0:</span><span class="tab" val="79"></span><span style="font: 8pt serif">[] &larr; EE xor uEHost0, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[0,2,ECheckAddr0];<br>ECheckBCast2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; ~uEDest0, ZeroBr, BRANCH[$, MyAddr],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[1,2,ECheckBCast2];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; ~uEHost0, ZeroBr, BRANCH[ECheckAny, EInput],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0,2,MyAddr];<br>MyAddr:</span><span class="tab" val="79"></span><span style="font: 8pt serif">CANCELBR[EInput,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[1,2,MyAddr];<br><br>ECheckAny:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uESize, BRANCH[NotMeC2, EInputC2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[0,2,EInput];<br>EInput:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uESize, CANCELBR[$,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[1,2,EInput];<br>EInputC2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE-2, L6 &larr; L6.ERCross, GOTO[ERead],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[1,2,NotMeC2];<br>NotMeC2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EStrobe, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[0,2,NotMeC2]; {purge rest of<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">      packet and quit}<br>{main input loop}<br>EInLoop:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, E + 1], EtherDisp, BRANCH[$,EITooLong],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EIData, DISP4[ERead, 0C],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>ERead:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE - 1, ZeroBr, GOTO[EInLoop],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0C,10,ERead];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; uESize, GOTO[EReadEnd],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0D,10,ERead];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; EIData, uETemp2 &larr; EE, GOTO[ERCross],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0E,10,ERead];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; EIData, uETemp2 &larr; EE, L6&larr;L6.ERCrossEnd, GOTO[ERCross],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0F,10,ERead];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{remap buffer page}<br>ERCross:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uETemp &larr; E, CALL[ECMap],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, 0+0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ERCross,10,EMapRets];<br>ERCrossStore:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; uETemp, DISP4[ERead, 0C],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, 0+0], EtherDisp, GOTO[ERCrossStore],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ERCrossEnd,10,EMapRets];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{packet too big.  make it look like size was -1}<br>EITooLong:</span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; 0, CANCELBR[$,0F],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; 0, GOTO[EReadEnd],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>EReadEnd:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; E - EE - 1, rhEE &larr; 0,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE - 6,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">[] &larr; EE, NegBr,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE + 6, BRANCH[$,EReadPurgeC2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uETemp &larr; EE, L6&larr;L6.EREndMap, CALL[EMapIOCB],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{store final count, update csb, set interrupt, return to EReadPurge}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE+IOCB.used],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.EREndMap,10,EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; uETemp, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">L6&larr;L6.EReceive, CALL[EFinish],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{set purge mode, EStrobe must be in c1 or c2, for wakeup pipeline}<br>EReadPurge:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>{EStrobe in c2 means purge (rest of) input packet}<br>EReadPurgeC2: EStrobe,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EDone:</span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[EStart],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif"><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{*****************************************************************************<br>Tranmit Code<br>*****************************************************************************}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>ETransmit:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.ocb+0], L6&larr;L6.EXmit,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[0,4,EGo];<br>EXmitx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">CALL[ECBFetch],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{get backoff mask}<br>ETGotIOCB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E+IOCB.mask],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.EXmit,10,EFetch]; {save addr of<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">mask}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEBuffer &larr; EE, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD, XHDisp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E+IOCB.mask], BRANCH[$,EFullMask,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE+EE+1, CANCELBR[$,0],</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c2; {write back shifted mask}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEOldMask &larr; EE, EE &larr; EE LShift1, SE &larr; 1, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {save old mask and shift it.  If<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">it was zero, this is the first time<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">for this packet.}<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; eInitialCountdown, BRANCH[ERandom,EFirst],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1; {load time to wait before first packet<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">in case it is needed and decide.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">NOTE rhEE was loaded in ECBFetch.}<br>ERandom:</span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; uClockLow, GOTO[EHaveCntAndMsk],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[0,2,EFirst]; {load random number}<br>EFirst:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; 0FF,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[1,2,ERandom]; {Load Noop mask}<br>EHaveCntAndMsk: [] &larr; uXmitInterrupt, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3; {do we want the calculated mask<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">at all?}<br><br>EHaveCount:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrnDefer, E &larr; E and EE, BRANCH[EContinueLoop, EStartDeferLoop], c1; {start wait, finish mask<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">calculation and decide if calculated<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">mask is needed.}<br>{Come here if we are we got interrupted by a packet during the defer loop. We continue where we left off.}<br>EContinueLoop: E &larr; uXmitInterrupt, GOTO[EDeferLoopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[0,2,EStartDeferLoop];<br>EStartDeferLoop: E &larr; E and uE3FF, GOTO[EDeferLoopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[1,2,EContinueLoop]; {limit defer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">count to 10 bits.}<br>{This loop tests Attn from the previous wakeup.<br>If Attn is on, we will get another wakeup right away.<br>If the timer counts out at the wrong time we will (slowly) discover it<br>after trying to send the preamble. (The hardware will ignore that.)}<br>EDeferLoop:<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; E - 1, NegBr, BRANCH[$, ERecieveUnder,0E],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrnDefer, BRANCH[$,EStartXmit],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EDeferLoopx:<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEBuffer, EtherDisp, GOTO[EDeferLoop],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>EStartXmit:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{send preamble}<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; 3,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EPreamble:</span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; E - 1, ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOData &larr; uEPreamble, BRANCH[$, ELastPreamble],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uXmitInterrupt &larr; 0, EStrobe, GOTO[EPreamble],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br>ELastPreamble:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Map &larr; [rhEE, EE], EStrobe, L6&larr;L6.ETMap,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOData &larr; uELastPreamble, L6Disp, CALL[EMapFetch],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, EE + 0], EStrobe,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ETMap,10,EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uESize, GOTO[EXmit],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>EOutLoop:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, E + 1], EtherDisp, EStrobe,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EOutLoopx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE - 1, rhEE &larr; 0, ZeroBr, DISP4[EXmit, 0C],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EXmit:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOData &larr; MD, BRANCH[EOutLoop, EOutDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0C,10,EXmit];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus &larr; EStatus, XwdDisp, L6&larr;L6.EXmitAbort, CANCELBR[EXmitAttn,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0D,10,EXmit];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE + 1, L6&larr;L6.ETCross, CANCELBR[EXmitCross,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0E,10,EXmit];<br>EXmitQuit:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus &larr; EStatus, XwdDisp, L6&larr;L6.EXmitAbort, CANCELBR[EXmitAttn,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3, at[0F,10,EXmit];<br><br>EOutDone:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EStrobe,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrnLastWord,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EStrobe,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>EXmitEnd:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Xbus &larr; EStatus, XwdDisp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn, BRANCH[ENoColl, EColl, 1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EColl:</span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[ECollision],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br>ENoColl:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEIOCB, L6&larr;L6.ETEndMap, GOTO[EMap],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{store status, update csb, set interrupt, return to EStart}<br>EXmitEndx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE + IOCB.completion], L6&larr;L6.EXmit, CALL[EFinish2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ETEndMap,10,EMapRets];<br><br>{Turn tran off to reset transmitter, and<br>  back on for more wakeups in case there is another IOCB to process}<br>EXmitDone:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, GOTO[EXmitColl],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br>{page cross on transmit}<br>EXmitCross:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uETemp2 &larr; EE, CALL[ECMap],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, 0+0], GOTO[EOutLoopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.ETCross,10,EMapRets];<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{attention during transmit loop}<br>EXmitAttn:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, rhEE &larr; 0, DISP2[EXmitA],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EXmitA:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn, GOTO[EMapIOCB],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[0,4,EXmitA];</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn, GOTO[ENoColl],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[1,4,EXmitA];<br>EXmitColl:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[2,4,EXmitA];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eEnableTrn, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2, at[3,4,EXmitA];<br><br>{Come here if we are interrupted while waiting to transmit. Save the count so that we can continue where we left off.}<br>ERecieveUnder:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uXmitInterrupt &larr; E, CANCELBR[EXmitQuit,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>EXmitAbortx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE + IOCB.mask],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.EXmitAbort,10,EMapRets];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; uEOldMask, CANCELBR[EDone,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{backoff mask full}<br>EFullMask:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rhEE &larr; 0, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E + IOCB.mask],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE, CANCELBR[ENoColl,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>ECollision:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, GOTO[EXmitColl],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{*****************************************************************************<br>Stopping code<br>*****************************************************************************}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">EStop:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, GOTO[EStopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[3,4,EStop];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, GOTO[EStopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[1,4,EGo];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff, GOTO[EStopx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[3,4,EGo];<br>EStopx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EICtl &larr; eOff,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">GOTO[EColdStart],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{*****************************************************************************<br>Common Code<br>*****************************************************************************}</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br>{Store status, fetch next iocb}<br>EFinish:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE+IOCB.completion],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EFinish2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EStatus, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, EE+IOCB.next], L6Disp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rhE &larr; E &larr; uIOPage, BRANCH[EREnd, ETEnd, 2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EREnd:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, IOPage.ECSB.icb+0], GOTO[ECSBUpdate],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br>ETEnd:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, IOPage.ECSB.ocb+0], GOTO[ECSBUpdate],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br>ECSBUpdate:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E+1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uWP, MesaIntRq,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; E or EE, L6Disp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uWP &larr; EE, BRANCH[EReadPurge, EXmitDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif"><br><br>{page cross map update for inner loops}<br>ECMap:</span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; 0FF,</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>ECNextPage:<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEBuffer,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">E &larr; EE + E + 1, CarryBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEBuffer &larr; E, BRANCH[$, ECrossCarry],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>ECMapx:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rhEE &larr; uEBufferHi,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Map &larr; [rhEE, E],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uETemp2, L6Disp, GOTO[EMapFetch],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>ECrossCarry:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEBufferHi,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; EE + 1,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uEBufferHi &larr; EE, GOTO[ECMapx],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br>{general mapping; don&rsquo;t care if uEBuffer smashed if mapping IOCB}<br>EMapIOCB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; uEIOCB,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>EMap:</span><span class="tab" val="79"></span><span style="font: 8pt serif">Map &larr; [rhEE, EE],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EMap2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uEBuffer &larr; EE, L6Disp,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EMapFetch:</span><span class="tab" val="79"></span><span style="font: 8pt serif">rhE &larr; E &larr; MD, RET[EMapRets],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>{IOCB fetch}<br>ECBFetch:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Map &larr; uEIOCB &larr; [rhEE, EE], ZeroBr,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">L6Disp, BRANCH[$, ENoCB],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rhE &larr; E &larr; MD, CANCELBR[$,1],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; E &larr; [rhE, EE+IOCB.size],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E+IOCB.bufferHi],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">uESize &larr; EE, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">rhEE &larr; EE &larr; MD,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, E+IOCB.buffer],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br>EFetch2:</span><span class="tab" val="79"></span><span style="font: 8pt serif">uEBufferHi &larr; EE, L6Disp, CANCELBR[$,0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br>EFetch3:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EE &larr; MD, RET[EFetch],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>ENoCB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">BRANCH[ENoICB, ENoOCB],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c3;<br><br>ENoOCB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">EOCtl &larr; eOff,</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">Noop, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">ENoICB:</span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.lost+0], L6&larr;L6.NoICB, GOTO[EFetch2],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1;<br><br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MAR &larr; [rhE, IOPage.ECSB.lost+0],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c1, at[L6.NoICB,10,EFetch];<br></span><span class="tab" val="79"></span><span style="font: 8pt serif">MDR &larr; EE + 1, EStrobe, GOTO[EDone],</span><span class="tab" val="79"></span><span style="font: 8pt serif">c2;<br><br><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 8pt serif">{END}<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
</div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
