<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>Carol>LIBRARY>SINGLEFILEINDEX.DOC!1</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: 10pt serif">Stored on: {Phylum}&lt;Lisp&gt;Library&gt;SINGLEFILEINDEX.DOC<br>Program: {Phylum}&lt;Lisp&gt;Library&gt;SINGLEFILEINDEX.DCOM<br>Documentation last revised: February 27, 1984<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: bold 12pt serif">SINGLEFILEINDEX</span><span style="font: 12pt serif"><br><br>Christopher Tong and Jon L. White</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">SINGLEFILEINDEX is a Lisp Library package for generating indexed listings for files. Its features include:</span></div>
<div style="width: 411pt; margin-left: 115pt; text-indent: -12pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">1. items that are indexed by type (e.g. FNS, VARS, etc.) and the page number on which their definitions appear in the listing;</span></div>
<div style="width: 411pt; margin-left: 115pt; text-indent: -12pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">2. the ability to define the types to be indexed, as well as the means for locating definitions of a particular type;</span></div>
<div style="width: 411pt; margin-left: 115pt; text-indent: -12pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">3. in INTERLISP-D, the listing is created in a background process;</span></div>
<div style="width: 411pt; margin-left: 115pt; text-indent: -12pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">4. the creation of an multi-type index for multiple files.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 6pt; text-align: justify">
<span style="font: bold italic 12pt serif">1. Creating indexed file listings.</span><span style="font: 12pt serif"><br><br></span><span class="tab" val="24"></span><span style="font: 12pt serif">SINGLEFILEINDEX lists a file, and producing indices for different types of items that appear on that file. These types are usually file package types, but they needn&rsquo;t be.</span><span style="font: 10pt serif; vertical-align: 4pt">1</span><span style="font: 12pt serif"> A default set of types is provided by the value of the variable, </span><span style="font: 10pt sans-serif">DEFAULTINDEXEDTYPESLST</span><span style="font: 12pt serif">:<br></span><span style="font: 10pt sans-serif"><br>   (</span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(BITMAP RPAQ TestForBitmap)<br> </span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(CLASS DEFCLASS)<br></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(INSTANCE DEFINST TestForInstance)<br></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(MACRO PUTPROPS TestForMacro)<br></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(METHOD METH TestForMethod)<br></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(RECORD</span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(RECORD TYPERECORD ASSOCRECORD PROPRECORD ARRAYRECORD<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">ATOMRECORD HASHLINK ARRAYBLOCK ACCESSFNS DATATYPE<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">BLOCKRECORD))<br></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(VAR (RPAQ ADDTOVAR)))<br></span><span style="font: 12pt serif"><br></span><span class="tab" val="24"></span><span style="font: 12pt serif">The user can specify the types he wants to index with the variable, </span><span style="font: 10pt sans-serif">INDEXEDTYPESLIST</span><span style="font: 12pt serif"> (initially </span><span style="font: 10pt sans-serif">NIL</span><span style="font: 12pt serif">). If the value of this variable is </span><span style="font: 10pt sans-serif">NIL</span><span style="font: 12pt serif">, </span><span style="font: 10pt sans-serif">DEFAULINDEXEDTTYPESLST</span><span style="font: 12pt serif"> is used instead. Functions are </span><span style="font: italic 12pt serif">always</span><span style="font: 12pt serif"> indexed, and should not be included in </span><span style="font: 10pt sans-serif">INDEXEDTYPESLIST</span><span style="font: 12pt serif">. See section 2 for more on specifying types.<br><br></span><span class="tab" val="24"></span><span style="font: 12pt serif">The two functions responsible for creating indexed listings are SINGLEFILEINDEX and MERGEDFILEINDEX.<br><br>(SINGLEFILEINDEX </span><span style="font: italic 10pt sans-serif"> FILE  OUTPUTFILE  MERGEDINDEXFLG</span><span style="font: italic 12pt serif">)</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 12pt serif">[Function]</span></div>
<div style="width: 405pt; margin-left: 121pt; margin-top: 0pt; text-align: justify">
<span style="font: italic 10pt sans-serif">FILE</span><span style="font: italic 12pt serif"> </span><span style="font: 12pt serif">is the lisp source file. </span><span style="font: italic 10pt sans-serif">OUTPUTFILE</span><span style="font: 12pt serif"> is the destination file. If </span><span style="font: italic 10pt sans-serif">OUTPUTFILE</span><span style="font: 12pt serif">=</span><span style="font: 10pt sans-serif">NIL</span><span style="font: 12pt serif">, then the value of </span><span style="font: 10pt sans-serif">PRINTER</span><span style="font: 12pt serif"> (initially </span><span style="font: 10pt sans-serif">LPT:</span><span style="font: 12pt serif">) is used. </span><span style="font: italic 10pt sans-serif">MERGEDINDEXFLG</span><span style="font: 12pt serif">=</span><span style="font: 10pt sans-serif">T</span><span style="font: 12pt serif"> means a single, alpabetically sorted index will be created for all the types (instead of a several type-specific indices). The value of </span><span style="font: 10pt sans-serif">FILELINELENGTH</span><span style="font: 12pt serif"> determines the position of the index numbers, as well as the placement of the columns. The value of </span><span style="font: 10pt sans-serif">LINESPERPAGE</span><span style="font: 12pt serif"> (initially 65 on D machines, 58 otherwise) determines the number of lines per page. <br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span class="tab" val="24"></span><span style="font: 12pt serif">SINGLEFILEINDEX first prints the file, with the filename and page number at the top of every page, as well as the name of any definition whose listing has been interrupted by the page break. After the file has been printed, the subsequent pages list the index or indices (depending on the value of </span><span style="font: italic 10pt sans-serif">MERGEDINDEXFLG</span><span style="font: 12pt serif">). The first page provides the filename, time of creation, and time of listing. If </span><span style="font: italic 10pt sans-serif">MERGEDINDEXFLG</span><span style="font: italic 12pt serif">=</span><span style="font: 10pt sans-serif">T</span><span style="font: 12pt serif">, the order in which the indices appear is determined by the order of the types in </span><span style="font: 10pt sans-serif">INDEXEDTYPESLIST</span><span style="font: 12pt serif">. If there are no items of a particular type on the file, no index is generated.</span><span style="font: 10pt serif; vertical-align: 4pt">1</span><span style="font: 12pt serif"> The index for items of a particular type provides the names of those items, as well as the page number on which their definition begins. The index is sorted by item name.<br><br></span><span class="tab" val="24"></span><span style="font: 12pt serif">When the SINGLEFILEINDEX package is first loaded, it redefines LISTFILES1 (see the INTERLISP manual) so that all files listed by LISTFILES will be listed using the function SINGLEFILEINDEX.</span><span style="font: 10pt serif; vertical-align: 4pt">2</span><span style="font: 12pt serif"> The file being indexed needn&rsquo;t be loaded, or even noticed (in the file package sense).<br><br><br>(MERGEDFILEINDEX  </span><span style="font: italic 10pt sans-serif">FILES</span><span style="font: 12pt serif">)</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 12pt serif">[Function]</span></div>
<div style="width: 405pt; margin-left: 121pt; margin-top: 0pt; text-align: justify">
<span style="font: 12pt serif">MERGEDFILEINDEX creates a single index for a set of files, </span><span style="font: italic 10pt sans-serif">FILES</span><span style="font: 12pt serif">. The index contains the name of a file item, its type, and the file on which it appears. The index is alphabetically sorted by item name. If the same item of a particular type appears on several files, a separate index entry will be generated for each occurence.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif"><br></span><span style="font: bold italic 12pt serif">2. Specifying types</span><span style="font: italic 12pt serif"><br><br></span><span style="font: 12pt serif">For the purpose of this package, a </span><span style="font: italic 12pt serif">type</span><span style="font: 12pt serif"> is defined as a triple containing:</span></div>
<div style="width: 405pt; margin-left: 121pt; margin-top: 6pt; text-align: justify">
<span style="font: 12pt serif">the name of the type (e.g. </span><span style="font: 10pt sans-serif">BITMAP</span><span style="font: 12pt serif">);<br>a candidate-generating atom or atoms (e.g. </span><span style="font: 10pt sans-serif">RPAQ</span><span style="font: 12pt serif">);<br>a function for testing whether a candidate is really an item of this type.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: 12pt serif">The type name must be recognizable by the file package if it is a file package type. The candidate-generating atom must follow a "(" or "[" at the beginning of a line on the file. If a list of atoms is provided (e.g. for </span><span style="font: 10pt sans-serif">RECORD</span><span style="font: 12pt serif">s), a match against any one of them will produce a candidate line. (Note: the candidate-generating atom will be used for partial matching; thus </span><span style="font: 10pt sans-serif">RPAQ</span><span style="font: 12pt serif"> will match </span><span style="font: 10pt sans-serif">RPAQ</span><span style="font: 12pt serif">, </span><span style="font: 10pt sans-serif">RPAQQ</span><span style="font: 12pt serif">, and </span><span style="font: 10pt sans-serif">RPAQ?</span><span style="font: 12pt serif">.) The test function has arguments: (</span><span style="font: 10pt sans-serif">string typeName</span><span style="font: 12pt serif">), and returns either </span><span style="font: 10pt sans-serif">NIL</span><span style="font: 12pt serif"> (i.e. the candidate is not legitimate) or the name of the item. SINGLEFILEINDEX reads the file, one line at a time, and compares each line against the candidate-generating atom for each type; if a candidate line is found, the test function is applied with arguments: (string typeName), where string is the substring of the current line that begins with the candidate-generating atom. <br></span><span class="tab" val="24"></span><span style="font: 12pt serif">For example, given the file line:<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(RPAQ Foo NIL)</span><span style="font: 12pt serif"><br>the </span><span style="font: 10pt sans-serif">RPAQ</span><span style="font: 12pt serif"> following an initial "(" makes this line a candidate for the beginning of a bitmap definition. However, when TestForBitmap is applied to "</span><span style="font: 10pt sans-serif">RPAQ Foo NIL)&lt;CR&gt;</span><span style="font: 12pt serif">" it rejects this candidate because the second expression after the RPAQ is not </span><span style="font: 10pt sans-serif">(READBITMAP)</span><span style="font: 12pt serif">.<br></span><span class="tab" val="24"></span><span style="font: 12pt serif">If no test function is provided, the function </span><span style="font: 10pt sans-serif">TestForType</span><span style="font: 12pt serif"> is used, which simply checks for a litatom after the candidate-generating atom; if it finds a litatom, it assumes it is the name of the item and returns it.<br></span><span class="tab" val="24"></span><span style="font: 12pt serif">Note: When the type is a legitimate file package type, it is often useful to screen candidates of a particular type against the list of all items of that type as determined by scanning the FILECOMS list. For this purpose, the variable, </span><span style="font: 10pt sans-serif">typeNames</span><span style="font: 12pt serif">, is computed, so that it can be used freely by a test function. </span><span style="font: 10pt sans-serif">typeNames</span><span style="font: 12pt serif"> is a list whose members have the form:<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt sans-serif">(typeName itemList)</span><span style="font: 12pt serif"><br></span><span style="font: 10pt sans-serif">itemList</span><span style="font: 12pt serif"> is computed using the FILECOMS list.<br><br><br></span><span style="font: italic 12pt serif">Note 1:</span><span style="font: 12pt serif"> Both SINGLEFILEINDEX and MERGEDFILEINDEX run as background processes in INTERLISP-D.<br> <br></span><span style="font: italic 12pt serif">Note 2:</span><span style="font: 12pt serif"> The files being indexed and/or listed needn&rsquo;t be loaded.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: italic 12pt serif">Note 3:</span><span style="font: 12pt serif"> The current version of the SINGLEFILEINDEX package replaces an older version which only indexed functions, used relative labels instead of absolute page numbers, and printed the function index before listing the file. Setting </span><span style="font: 10pt sans-serif">RELATIVEINDEXFLG</span><span style="font: 12pt serif"> to </span><span style="font: 10pt sans-serif">T</span><span style="font: 12pt serif"> will restore this behavior, if so desired (e.g. if you are printing on fanfold paper rather than cut sheets, you may want the index to appear before the file listing). If </span><span style="font: 10pt sans-serif">RELATIVEINDEXFLG</span><span style="font: 12pt serif"> is </span><span style="font: 10pt sans-serif">NIL</span><span style="font: 12pt serif"> (the current default), indexing will be as described above, and the indices will be printed </span><span style="font: italic 12pt serif">after</span><span style="font: 12pt serif"> the file is listed. If, for some reason, both kinds of indexing are desired, give </span><span style="font: 10pt sans-serif">RELATIVEINDEXFLG</span><span style="font: 12pt serif"> the value </span><span style="font: 10pt sans-serif">(QUOTE BOTH)</span><span style="font: 12pt serif">.<br><br></span><span style="font: italic 12pt serif">Note 4: </span><span style="font: 12pt serif">The SINGLEFILEINDEX package uses the following variables:</span></div>
<div style="width: 405pt; margin-left: 121pt; margin-top: 0pt; text-align: justify">
<span style="font: 12pt serif">FILELINELENGTH to do the right-justification and columnating;<br>PRINTER (default value is LPT:) as the file to open to print the indexed version of the file;<br>LINESPERPAGE (initially 65 on D machines, 58 otherwise) as the number of lines on the printer.  </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: 12pt serif">The default values are only used if the variables were not bound at the time SINGLEFILEINDEX was loaded.  </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 12pt serif"><br><br></span><span style="font: 10pt serif; vertical-align: 4pt">1</span><span style="font: 10pt serif">If the type is a file package type, and there are no items of that type on the file (according to the FILECOMS list), then the file is never searched for items of that type.<br></span><span style="font: 12pt serif"><br></span><span style="font: 10pt serif; vertical-align: 4pt">2</span><span style="font: 10pt serif">with </span><span style="font: italic 10pt sans-serif">OUTPUTFILE</span><span style="font: 10pt serif"> and </span><span style="font: italic 10pt sans-serif">MERGEDINDEXFLG</span><span style="font: 10pt serif"> set to </span><span style="font: 10pt sans-serif">NIL</span><span style="font: 10pt serif">.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 12pt serif"><br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
