<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>[eris]&lt;Lisp>Carol>SOURCES>LISPDMC.DM!1>LBIND.mc</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="tab" val="24"></span><span style="font: 10pt monospace">:Title[LBIND.mc, December 6, 1982  1:05 PM, Masinter];<br><br>*--------------------------------------------------------------------<br>* BIND, UNBIND, DUNBIND opcodes<br>*--------------------------------------------------------------------<br><br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">knowrbase[LTemp0];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">top level;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">InsSet[LispInsSet, 1];<br><br>*--------------------------------------------------------------------<br>opBIND:<br>*--------------------------------------------------------------------<br>* Binds n1 pvars to NIL and <br>* n2 pvars to the n2 items on the stack<br>* Last pvar stored into is N<br>* pushes binding mark [-(n1+n2)-1,, 2*N]<br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; LTEMP0&larr; Id;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* n1 (first 4 bits) #NILs<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP1&larr; Id, Cnt&larr; T;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* n2 (next 4 bits)  #values<br> </span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (Id) lsh 1;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* 2*N<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (PVAR) + (Q&larr; T);<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.endBindNils, Cnt=0&-1], LTEMP2&larr; T + 1; <br><br>.BindVarToNil:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP2&larr; (store&larr; LTEMP2) - 1, DBuf&larr; AT.NIL;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP2&larr; (store&larr; LTEMP2) - 1, DBuf&larr; 0c,</span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.BindVarToNil,Cnt#0&-1];<br><br>.endBindNils:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Cnt&larr; LTEMP1, T&larr; LTEMP1;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* #values to bind<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LEFT&larr; (LEFT) + T;<br><br>.BindVarToVal:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (TSP) - 1, branch[.EndBind, Cnt=0&-1];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">TSP&larr; (fetch&larr; T) - 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Md, (fetch&larr; TSP);<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; Md, LTEMP2&larr; (store&larr; LTEMP2) - 1, dbuf&larr; T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP2&larr; (store&larr; LTEMP2) - 1, DBuf&larr; T, branch[.BindVarToVal];<br><br>.EndBind:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (0s) - (LTEMP1);</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt monospace">* -N2<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; T - (LTEMP0) - 1, branch[PUSHTQOK];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* -N1-N2-1<br><br>IFUreg[21, 3, StackBR, 0, opBIND, noNData, 0, 1];<br><br><br>*--------------------------------------------------------------------<br>opUNBIND:<br>*--------------------------------------------------------------------<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (fetch&larr; TSP) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP0&larr; Md, T&larr; (fetch&larr; T) - 1, flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">TSP&larr; T, Q&larr; Md;<br><br>opDUNBIND:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; TSP&larr; (fetch&larr; TSP) - (2c);<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP1&larr; Md, T&larr; T + 1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[opDUNBIND, R&gt;=0], LTEMP1, LTEMP1&larr; not (LTEMP1);<br><br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">T points (relative to StackM2) to the odd word<br>*</span><span class="tab" val="24"></span><span style="font: 10pt monospace">LTEMP2 LTEMP2 has (n1+n2)<br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">flipMemBase;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">fetch&larr; T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">Cnt&larr; LTEMP1;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (PVAR) + (Md) + 1;<br><br>.unbindvar:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.unbindend, Cnt=0&-1], T&larr; T - 1;<br><br>:if[Debugging];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* check if slot was not bound<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">fetch &larr; T;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd &larr; Md;<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.+2, alu&gt;=0];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">   uCodeCheck[UnBindNotBound];<br>:endif;<br><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">T&larr; (store&larr; T) - 1, dbuf&larr; AllOnes, branch[.unbindvar];<br><br>.unbindend:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">call[FIXLEFT];<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">pd&larr; Id;</span><span class="tab" val="24"></span><span style="font: 10pt monospace"><br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[.wasUnbind, alu=0], T&larr; LTEMP0;</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* Id=0 for unbind<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">NextOpCode;<br><br>.wasUnBind:<br></span><span class="tab" val="24"></span><span style="font: 10pt monospace">branch[PUSHTQ];<br><br>regOP1[22, StackM2BR, opUNBIND, 0];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* UNBIND<br>regOP1[23, StackM2BR, opDUNBIND, 1];</span><span class="tab" val="24"></span><span style="font: 10pt monospace">* DUNBIND<br></span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
